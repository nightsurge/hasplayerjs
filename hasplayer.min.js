/*
 * The copyright in this software module is being made available under the BSD License, included below. This software module may be subject to other third party and/or contributor rights, including patent rights, and no such rights are granted under this license.
 * The whole software resulting from the execution of this software module together with its external dependent software modules from dash.js project may be subject to Orange and/or other third party rights, including patent rights, and no such rights are granted under this license.
 * 
 * Copyright (c) 2014, Orange
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 * •  Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * •  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * •  Neither the name of the Orange nor the names of its contributors may be used to endorse or promote products derived from this software module without specific prior written permission.
 * 
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/* Last build : 1.7.2015_17:24:2 / git revision : 6271a9b */
function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser)try{var c=new window.DOMParser;if(b=c.parseFromString(a,"text/xml"),b.getElementsByTagName("parsererror").length>0)throw new Error("Error parsing XML")}catch(d){return null}return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return null===b?b:this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;i<len;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}if(function(a){Q=a()}(function(){"use strict";function a(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function b(a){return"[object StopIteration]"===ga(a)||a instanceof $}function c(a,b){b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ha)&&(a.stack=d(a.stack)+"\n"+ha+"\n"+d(b.stack))}function d(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var g=b[d];f(g)||e(g)||c.push(g)}return c.join("\n")}function e(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function f(a){var b=/at .+ \((.*):(\d+):\d+\)/.exec(a);if(!b)return!1;var c=b[1],d=b[2];return c===W&&d>=Y&&la>=d}function g(){if(Error.captureStackTrace){var a,b,c=Error.prepareStackTrace;return Error.prepareStackTrace=function(c,d){a=d[1].getFileName(),b=d[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=c,W=a,b}}function h(a){return t(a)}function i(){function a(a){c&&(b=t(a),aa(c,function(a,c){X(function(){b.promiseDispatch.apply(b,c)})},void 0),c=void 0,d=void 0)}var b,c=[],d=[],e=da(i.prototype),f=da(k.prototype);return f.promiseDispatch=function(a,e,f){var g=_(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):X(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){return c?f:b=l(b)},Error.captureStackTrace&&h.longStackJumpLimit>0&&(Error.captureStackTrace(f,i),f.stack=f.stack.substring(f.stack.indexOf("\n")+1)),e.promise=f,e.resolve=a,e.fulfill=function(b){a(s(b))},e.reject=function(b){a(r(b))},e.notify=function(a){c&&aa(d,function(b,c){X(function(){c(a)})},void 0)},e}function j(a){var b=i();return F(a,b.resolve,b.reject,b.notify).fail(b.reject),b.promise}function k(a,b,c,d,e){void 0===b&&(b=function(a){return r(new Error("Promise does not support operation: "+a))});var f=da(k.prototype);return f.promiseDispatch=function(c,d,e){var g;try{g=a[d]?a[d].apply(f,e):b.call(f,d,e)}catch(h){g=r(h)}c&&c(g)},c&&(f.valueOf=c),e&&(f.exception=d),f}function l(a){return m(a)?a.valueOf():a}function m(a){return a&&"function"==typeof a.promiseDispatch}function n(a){return a&&"function"==typeof a.then}function o(a){return!p(a)&&!q(a)}function p(a){return!n(l(a))}function q(a){return a=l(a),m(a)&&"exception"in a}function r(a){var b=k({when:function(b){if(b){var c=ba(ia,this);-1!==c&&(ja.splice(c,1),ia.splice(c,1))}return b?b(a):this}},function(){return r(a)},function(){return this},a,!0);return ia.push(b),ja.push(a),b}function s(a){return k({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null==b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return fa(a)}},void 0,function(){return a})}function t(a){return m(a)?a:(a=l(a),n(a)?u(a):s(a))}function u(a){var b=i();return X(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function v(a){return k({isDef:function(){}},function(b,c){return B(a,b,c)},function(){return l(a)})}function w(a,b,d,e){function f(a){try{return"function"==typeof b?b(a):a}catch(c){return r(c)}}function g(a){if("function"==typeof d){c(a,m);try{return d(a)}catch(b){return r(b)}}return r(a)}function j(a){return"function"==typeof e?e(a):a}var k=i(),l=!1,m=t(a);return X(function(){m.promiseDispatch(function(a){l||(l=!0,k.resolve(f(a)))},"when",[function(a){l||(l=!0,k.resolve(g(a)))}])}),m.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=j(a)}catch(d){if(c=!0,!h.onerror)throw d;h.onerror(d)}c||k.notify(b)}]),k.promise}function x(a,b,c){return w(a,function(a){return H(a).then(function(a){return b.apply(void 0,a)},c)},c)}function y(a){return function(){function c(a,c){var g;try{g=d[a](c)}catch(h){return b(h)?h.value:r(h)}return w(g,e,f)}var d=a.apply(this,arguments),e=c.bind(c,"send"),f=c.bind(c,"throw");return e()}}function z(a){throw new $(a)}function A(a){return function(){return x([this,H(arguments)],function(b,c){return a.apply(b,c)})}}function B(a,b,c){var d=i();return X(function(){t(a).promiseDispatch(d.resolve,b,c)}),d.promise}function C(a){return function(b){var c=_(arguments,1);return B(b,a,c)}}function D(a,b){var c=_(arguments,2);return ka(a,b,c)}function E(a,b){return B(a,"apply",[void 0,b])}function F(a){var b=_(arguments,1);return E(a,b)}function G(a){var b=_(arguments,1);return function(){var c=b.concat(_(arguments));return B(a,"apply",[this,c])}}function H(a){return w(a,function(a){var b=a.length;if(0===b)return t(a);var c=i();return aa(a,function(d,e,f){p(e)?(a[f]=l(e),0===--b&&c.resolve(a)):w(e,function(d){a[f]=d,0===--b&&c.resolve(a)}).fail(c.reject)},void 0),c.promise})}function I(a){return w(a,function(a){return a=ca(a,t),w(H(ca(a,function(a){return w(a,Z,Z)})),function(){return a})})}function J(a,b){return w(a,void 0,b)}function K(a,b){return w(a,void 0,void 0,b)}function L(a,b){return w(a,function(a){return w(b(),function(){return a})},function(a){return w(b(),function(){return r(a)})})}function M(a,b,d,e){var f=function(b){X(function(){if(c(b,a),!h.onerror)throw b;h.onerror(b)})},g=b||d||e?w(a,b,d,e):a;"object"==typeof process&&process&&process.domain&&(f=process.domain.bind(f)),J(g,f)}function N(a,b){var c=i(),d=setTimeout(function(){c.reject(new Error("Timed out after "+b+" ms"))},b);return w(a,function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)}),c.promise}function O(a,b){void 0===b&&(b=a,a=void 0);var c=i();return setTimeout(function(){c.resolve(a)},b),c.promise}function P(a,b){var c=_(b),d=i();return c.push(d.makeNodeResolver()),E(a,c).fail(d.reject),d.promise}function Q(a){var b=_(arguments,1),c=i();return b.push(c.makeNodeResolver()),E(a,b).fail(c.reject),c.promise}function R(a){var b=_(arguments,1);return function(){var c=b.concat(_(arguments)),d=i();return c.push(d.makeNodeResolver()),E(a,c).fail(d.reject),d.promise}}function S(a){var b=_(arguments,1);return function(){function c(){return a.apply(f,arguments)}var d=b.concat(_(arguments)),e=i();d.push(e.makeNodeResolver());var f=this;return E(c,d).fail(e.reject),e.promise}}function T(a,b,c){var d=_(c||[]),e=i();return d.push(e.makeNodeResolver()),ka(a,b,d).fail(e.reject),e.promise}function U(a,b){var c=_(arguments,2),d=i();return c.push(d.makeNodeResolver()),ka(a,b,c).fail(d.reject),d.promise}function V(a,b){return b?void a.then(function(a){X(function(){b(null,a)})},function(a){X(function(){b(a)})}):a}var W,X,Y=g(),Z=function(){};"undefined"!=typeof process?X=process.nextTick:"function"==typeof setImmediate?X="undefined"!=typeof window?setImmediate.bind(window):setImmediate:!function(){function a(){if(--f,++h>=e){h=0,e*=4;for(var a=g&&Math.min(g-1,e);a>f;)++f,b()}for(;g;){--g,c=c.next;var d=c.task;c.task=void 0,d()}h=0}var b,c={task:void 0,next:null},d=c,e=2,f=0,g=0,h=0;if(X=function(a){d=d.next={task:a,next:null},f<++g&&e>f&&(++f,b())},"undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=a,b=function(){i.port2.postMessage(0)}}else b=function(){setTimeout(a,0)}}();var $,_=a(Array.prototype.slice),aa=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),ba=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),ca=a(Array.prototype.map||function(a,b){var c=this,d=[];return aa(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),da=Object.create||function(a){function b(){}return b.prototype=a,new b},ea=a(Object.prototype.hasOwnProperty),fa=Object.keys||function(a){var b=[];for(var c in a)ea(a,c)&&b.push(c);return b},ga=a(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a},h.longStackJumpLimit=1;var ha="From previous event:";h.nextTick=X,h.defer=i,i.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?_(arguments,1):c)}},h.promise=j,h.makePromise=k,k.prototype.then=function(a,b,c){return w(this,a,b,c)},k.prototype.thenResolve=function(a){return w(this,function(){return a})},aa(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(a,b){k.prototype[b]=function(){return h[b].apply(h,[this].concat(_(arguments)))}},void 0),k.prototype.toSource=function(){return this.toString()},k.prototype.toString=function(){return"[object Promise]"},h.nearer=l,h.isPromise=m,h.isPromiseAlike=n,h.isPending=o,h.isFulfilled=p,h.isRejected=q;var ia=[],ja=[];"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var a=0;a<ja.length;a++){var b=ja[a];b&&"undefined"!=typeof b.stack}}),h.reject=r,h.fulfill=s,h.resolve=t,h.master=v,h.when=w,h.spread=x,h.async=y,h["return"]=z,h.promised=A,h.dispatch=B,h.dispatcher=C,h.get=C("get"),h.set=C("set"),h["delete"]=h.del=C("delete");var ka=h.post=C("post");h.send=D,h.invoke=D,h.fapply=E,h["try"]=F,h.fcall=F,h.fbind=G,h.keys=C("keys"),h.all=H,h.allResolved=I,h["catch"]=h.fail=J,h.progress=K,h["finally"]=h.fin=L,h.done=M,h.timeout=N,h.delay=O,h.nfapply=P,h.nfcall=Q,h.nfbind=R,h.denodeify=h.nfbind,h.nbind=S,h.npost=T,h.nsend=U,h.ninvoke=h.nsend,h.nodeify=V;var la=g();return h}),function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(!c||f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),"undefined"==typeof utils)var utils={};"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(a,b){var c,d,e;return c=new goog.math.Long(0,b),d=new goog.math.Long(a,0),e=c.add(d),e.toNumber()},goog={},goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=goog.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=goog.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=goog.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)};var UTF8={};UTF8.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},UTF8.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var BASE64={};if(function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),e=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},f={};f.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},f.decode=function(){for(var b=0;b<s.length;++b)a[b]=String.fromCharCode(a[b]);return a.join("")},BASE64.decodeArray=function(a){var b=e(a);return new Uint8Array(b)},BASE64.encodeASCII=function(a){var b=f.encode(a);return c(b)},BASE64.decodeASCII=function(a){var b=e(a);return f.decode(b)},BASE64.encode=function(a){var b=UTF8.encode(a);return c(b)},BASE64.decode=function(a){var b=e(a);return UTF8.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;var mp4lib=function(){var a={boxes:{},fields:{},debug:!1,warningHandler:function(){}},b={};return a.registerTypeBoxes=function(){b.moov=a.boxes.MovieBox,b.moof=a.boxes.MovieFragmentBox,b.ftyp=a.boxes.FileTypeBox,b.mfhd=a.boxes.MovieFragmentHeaderBox,b.mfra=a.boxes.MovieFragmentRandomAccessBox,b.udta=a.boxes.UserDataBox,b.trak=a.boxes.TrackBox,b.edts=a.boxes.EditBox,b.mdia=a.boxes.MediaBox,b.minf=a.boxes.MediaInformationBox,b.dinf=a.boxes.DataInformationBox,b.stbl=a.boxes.SampleTableBox,b.mvex=a.boxes.MovieExtendsBox,b.traf=a.boxes.TrackFragmentBox,b.meta=a.boxes.MetaBox,b.mvhd=a.boxes.MovieHeaderBox,b.mdat=a.boxes.MediaDataBox,b.free=a.boxes.FreeSpaceBox,b.sidx=a.boxes.SegmentIndexBox,b.tkhd=a.boxes.TrackHeaderBox,b.mdhd=a.boxes.MediaHeaderBox,b.mehd=a.boxes.MovieExtendsHeaderBox,b.hdlr=a.boxes.HandlerBox,b.stts=a.boxes.TimeToSampleBox,b.stsc=a.boxes.SampleToChunkBox,b.stco=a.boxes.ChunkOffsetBox,b.trex=a.boxes.TrackExtendsBox,b.vmhd=a.boxes.VideoMediaHeaderBox,b.smhd=a.boxes.SoundMediaHeaderBox,b.dref=a.boxes.DataReferenceBox,b["url "]=a.boxes.DataEntryUrlBox,b["urn "]=a.boxes.DataEntryUrnBox,b.tfhd=a.boxes.TrackFragmentHeaderBox,b.tfdt=a.boxes.TrackFragmentBaseMediaDecodeTimeBox,b.trun=a.boxes.TrackFragmentRunBox,b.stsd=a.boxes.SampleDescriptionBox,b.sdtp=a.boxes.SampleDependencyTableBox,b.avc1=a.boxes.AVC1VisualSampleEntryBox,b.encv=a.boxes.EncryptedVideoBox,b.avcC=a.boxes.AVCConfigurationBox,b.pasp=a.boxes.PixelAspectRatioBox,b.mp4a=a.boxes.MP4AudioSampleEntryBox,b.enca=a.boxes.EncryptedAudioBox,b.esds=a.boxes.ESDBox,b.stsz=a.boxes.SampleSizeBox,b.pssh=a.boxes.ProtectionSystemSpecificHeaderBox,b.saiz=a.boxes.SampleAuxiliaryInformationSizesBox,b.saio=a.boxes.SampleAuxiliaryInformationOffsetsBox,b.sinf=a.boxes.ProtectionSchemeInformationBox,b.schi=a.boxes.SchemeInformationBox,b.tenc=a.boxes.TrackEncryptionBox,b.schm=a.boxes.SchemeTypeBox,b.elst=a.boxes.EditListBox,b.hmhd=a.boxes.HintMediaHeaderBox,b.nmhd=a.boxes.NullMediaHeaderBox,b.ctts=a.boxes.CompositionOffsetBox,b.cslg=a.boxes.CompositionToDecodeBox,b.stss=a.boxes.SyncSampleBox,b.tref=a.boxes.TrackReferenceBox,b.frma=a.boxes.OriginalFormatBox,b[JSON.stringify([109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178])]=a.boxes.TfxdBox,b[JSON.stringify([212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159])]=a.boxes.TfrfBox,b[JSON.stringify([208,138,79,24,16,243,74,130,182,200,50,216,171,161,131,211])]=a.boxes.PiffProtectionSystemSpecificHeaderBox,b[JSON.stringify([137,116,219,206,123,231,76,81,132,249,113,72,249,136,37,84])]=a.boxes.PiffTrackEncryptionBox,b[JSON.stringify([162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244])]=a.boxes.PiffSampleEncryptionBox},a.constructorTypeBox=function(a){var b,c;return b=Object.create(a.prototype),c=Array.prototype.slice.call(arguments,1),a.apply(b,c),b},a.searchBox=function(c,d){var e;return e=d?b[d]:b[c],e||(e=a.boxes.UnknownBox),e},a.createBox=function(b,c,d){return a.constructorTypeBox.apply(null,[a.searchBox(b,d),c])},a.deserialize=function(b){var c=new a.boxes.File;try{c.read(b)}catch(d){return a.warningHandler(d.message),null}return c},a.serialize=function(a){var b=a.getLength(),c=new Uint8Array(b);return a.write(c),c},a.ParseException=function(a){
this.message=a,this.name="ParseException"},a.DataIntegrityException=function(a){this.message=a,this.name="DataIntegrityException"},a}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=mp4lib:window.mp4lib=mp4lib,mp4lib.boxes.File=function(){this.boxes=[]},mp4lib.boxes.File.prototype.getBoxByType=function(a){for(var b=0;b<this.boxes.length;b++)if(this.boxes[b].boxtype===a)return this.boxes[b];return null},mp4lib.boxes.File.prototype.getLength=function(){var a=0,b=0;for(b=0;b<this.boxes.length;b++)this.boxes[b].computeLength(),a+=this.boxes[b].size;return a},mp4lib.boxes.File.prototype.write=function(a){for(var b=0,c=0;c<this.boxes.length;c++)b=this.boxes[c].write(a,b)},mp4lib.boxes.File.prototype.read=function(a){for(var b=0,c=null,d=0,e=null,f=0,g=a.length;g>f;){b=mp4lib.fields.FIELD_UINT32.read(a,f),c=mp4lib.fields.readString(a,f+4,4),"uuid"==c&&(d=1==b?16:8,e=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,f+d,f+d+16),e=JSON.stringify(e));var h=mp4lib.createBox(c,b,e);if("uuid"===c?(f=h.read(a,f+16*mp4lib.fields.FIELD_INT8.getLength()+8,f+b),e=null):f=h.read(a,f+8,f+b),mp4lib.debug&&(h.__sourceBuffer=a.subarray(f-h.size,f)),this.boxes.push(h),h.size<=0||null===h.size)throw new mp4lib.ParseException("Problem on size of box "+h.boxtype+", parsing stopped to avoid infinite loop");if(!h.boxtype)throw new mp4lib.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}},mp4lib.boxes.File.prototype.getBoxOffsetByType=function(a){var b=0,c=0;for(c=0;c<this.boxes.length;c++){if(this.boxes[c].boxtype===a)return b;b+=this.boxes[c].size}return-1},mp4lib.boxes.File.prototype.getBoxIndexByType=function(a){var b=0,c=0;for(c=0;c<this.boxes.length;c++){if(this.boxes[c].boxtype===a)return b;b++}return-1},mp4lib.boxes.Box=function(a,b,c,d){this.size=b||null,this.boxtype=a,1===this.size&&d&&(this.largesize=d),c&&(this.extended_type=c),this.localPos=0,this.localEnd=0},mp4lib.boxes.Box.prototype.write=function(a,b){if(this.localPos=b,this._writeData(a,mp4lib.fields.FIELD_UINT32,this.size),this.extended_type?this._writeData(a,mp4lib.fields.FIELD_ID,"uuid"):this._writeData(a,mp4lib.fields.FIELD_ID,this.boxtype),1===this.size&&this._writeData(a,mp4lib.fields.FIELD_INT64,this.largesize),this.extended_type)for(var c=0;16>c;c++)this._writeData(a,mp4lib.fields.FIELD_INT8,this.extended_type[c])},mp4lib.boxes.Box.prototype.getBoxByType=function(a){var b=0;if(this.hasOwnProperty("boxes"))for(b=0;b<this.boxes.length;b++)if(this.boxes[b].boxtype===a)return this.boxes[b];return null},mp4lib.boxes.Box.prototype.getBoxesByType=function(a){var b=[],c=0;if(this.hasOwnProperty("boxes"))for(c=0;c<this.boxes.length;c++)this.boxes[c].boxtype===a&&b.push(this.boxes[c]);return b},mp4lib.boxes.Box.prototype.removeBoxByType=function(a){if(this.hasOwnProperty("boxes"))for(var b=0;b<this.boxes.length;b++)this.boxes[b].boxtype===a&&this.boxes.splice(b,1);else mp4lib.warningHandler(""+this.boxtype+"does not have "+a+" box, impossible to remove it")},mp4lib.boxes.Box.prototype.getBoxOffsetByType=function(a){var b=8,c=0;if(this.hasOwnProperty("boxes"))for(c=0;c<this.boxes.length;c++){if(this.boxes[c].boxtype===a)return b;b+=this.boxes[c].size}return null},mp4lib.boxes.Box.prototype.getBoxIndexByType=function(a){var b=0,c=0;if(this.hasOwnProperty("boxes"))for(c=0;c<this.boxes.length;c++){if(this.boxes[c].boxtype===a)return b;b++}return null},mp4lib.boxes.Box.prototype.computeLength=function(){this.size=mp4lib.fields.FIELD_UINT32.getLength()+mp4lib.fields.FIELD_ID.getLength(),this.extended_type&&(this.size+=16*mp4lib.fields.FIELD_INT8.getLength())},mp4lib.boxes.Box.prototype._readData=function(a,b){var c=b.read(a,this.localPos,this.localEnd);return this.localPos+=b.getLength(c),c},mp4lib.boxes.Box.prototype._writeData=function(a,b,c){if(void 0===c||null===c)throw new mp4lib.ParseException("a field to write is null or undefined for box : "+this.boxtype);b.write(a,this.localPos,c),this.localPos+=b.getLength(c)},mp4lib.boxes.Box.prototype._writeBuffer=function(a,b,c){a.set(b,this.localPos),this.localPos+=c},mp4lib.boxes.Box.prototype._writeArrayData=function(a,b,c){if(void 0===c||null===c||0===c.length)throw new mp4lib.ParseException("an array to write is null, undefined or length = 0 for box : "+this.boxtype);for(var d=0;d<c.length;d++)this._writeData(a,b,c[d])},mp4lib.boxes.Box.prototype._readArrayData=function(a,b){for(var c=[],d=b.getLength(),e=(this.localEnd-this.localPos)/d,f=0;e>f;f++)c.push(b.read(a,this.localPos)),this.localPos+=d;return c},mp4lib.boxes.Box.prototype._readArrayFieldData=function(a,b,c){for(var d=-1,e=[],f=0;c>f;f++)e.push(b.read(a,this.localPos)),-1===d&&(d=b.getLength(e[f])),this.localPos+=d;return e},mp4lib.boxes.ContainerBox=function(a,b){mp4lib.boxes.Box.call(this,a,b),this.boxes=[]},mp4lib.boxes.ContainerBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.ContainerBox.prototype.constructor=mp4lib.boxes.ContainerBox,mp4lib.boxes.ContainerBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this);var a=0;for(a=0;a<this.boxes.length;a++)this.boxes[a].computeLength(),this.size+=this.boxes[a].size},mp4lib.boxes.ContainerBox.prototype.write=function(a,b){mp4lib.boxes.Box.prototype.write.call(this,a,b);for(var c=0;c<this.boxes.length;c++)this.localPos=this.boxes[c].write(a,this.localPos);return this.localPos},mp4lib.boxes.ContainerBox.prototype.read=function(a,b,c){for(var d,e=0,f=0,g=null;c>b;){e=mp4lib.fields.FIELD_UINT32.read(a,b),d=mp4lib.fields.readString(a,b+4,4),"uuid"===d&&(f=1==e?16:8,g=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,b+f,b+f+16),g=JSON.stringify(g));var h=mp4lib.createBox(d,e,g);if("uuid"===d?(b=h.read(a,b+16*mp4lib.fields.FIELD_INT8.getLength()+8,b+e),g=null):b=h.read(a,b+8,b+e),mp4lib.debug&&(h.__sourceBuffer=a.subarray(b-h.size,b)),this.boxes.push(h),h.size<=0||null===h.size)throw new mp4lib.ParseException("Problem on size of box "+h.boxtype+", parsing stopped to avoid infinite loop");if(!h.boxtype)throw new mp4lib.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return b},mp4lib.boxes.FullBox=function(a,b,c){mp4lib.boxes.Box.call(this,a,b,c),this.version=null,this.flags=null},mp4lib.boxes.FullBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.FullBox.prototype.constructor=mp4lib.boxes.FullBox,mp4lib.boxes.FullBox.prototype.read=function(a,b,c){this.localPos=b,this.localEnd=c,this.version=this._readData(a,mp4lib.fields.FIELD_INT8),this.flags=this._readData(a,mp4lib.fields.FIELD_BIT24)},mp4lib.boxes.FullBox.prototype.write=function(a,b){mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT8,this.version),this._writeData(a,mp4lib.fields.FIELD_BIT24,this.flags)},mp4lib.boxes.FullBox.prototype.getFullBoxAttributesLength=function(){this.size+=mp4lib.fields.FIELD_INT8.getLength()+mp4lib.fields.FIELD_BIT24.getLength()},mp4lib.boxes.FullBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),mp4lib.boxes.FullBox.prototype.getFullBoxAttributesLength.call(this)},mp4lib.boxes.ContainerFullBox=function(a,b){mp4lib.boxes.FullBox.call(this,a,b),this.boxes=[]},mp4lib.boxes.ContainerFullBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.ContainerFullBox.prototype.constructor=mp4lib.boxes.ContainerFullBox,mp4lib.boxes.ContainerFullBox.prototype.computeLength=function(a){mp4lib.boxes.FullBox.prototype.computeLength.call(this);var b=0;for(a&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),b=0;b<this.boxes.length;b++)this.boxes[b].computeLength(),this.size+=this.boxes[b].size},mp4lib.boxes.ContainerFullBox.prototype.read=function(a,b,c,d){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c);var e,f=0,g=0,h=null;for(d&&(this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32));this.localPos<this.localEnd;){f=mp4lib.fields.FIELD_UINT32.read(a,this.localPos),e=mp4lib.fields.readString(a,this.localPos+4,4),"uuid"==e&&(g=1==f?16:8,h=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,this.localPos+g,this.localPos+g+16),h=JSON.stringify(h));var i=mp4lib.createBox(e,f,h);if("uuid"===e?(this.localPos=i.read(a,this.localPos+16*mp4lib.fields.FIELD_INT8.getLength()+8,this.localPos+f),h=null):this.localPos=i.read(a,this.localPos+8,this.localPos+f),mp4lib.debug&&(i.__sourceBuffer=a.subarray(this.localPos-i.size,this.localPos)),this.boxes.push(i),i.size<=0||null===i.size)throw new mp4lib.ParseException("Problem on size of box "+i.boxtype+", parsing stopped to avoid infinite loop");if(!i.boxtype)throw new mp4lib.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return this.localPos},mp4lib.boxes.ContainerFullBox.prototype.write=function(a,b,c){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),c===!0&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var d=0;d<this.boxes.length;d++)this.localPos=this.boxes[d].write(a,this.localPos);return this.localPos},mp4lib.boxes.UnknownBox=function(a){mp4lib.boxes.Box.call(this,null,a)},mp4lib.boxes.UnknownBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.UnknownBox.prototype.constructor=mp4lib.boxes.UnknownBox,mp4lib.boxes.UnknownBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.unrecognized_data=a.subarray(this.localPos,this.localEnd),this.localEnd},mp4lib.boxes.UnknownBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeBuffer(a,this.unrecognized_data,this.unrecognized_data.length),this.localPos},mp4lib.boxes.UnknownBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=this.unrecognized_data.length},mp4lib.boxes.FileTypeBox=function(a){mp4lib.boxes.Box.call(this,"ftyp",a)},mp4lib.boxes.FileTypeBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.FileTypeBox.prototype.constructor=mp4lib.boxes.FileTypeBox,mp4lib.boxes.FileTypeBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_INT32.getLength()+mp4lib.fields.FIELD_INT32.getLength()*this.compatible_brands.length},mp4lib.boxes.FileTypeBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.major_brand=this._readData(a,mp4lib.fields.FIELD_INT32),this.minor_brand=this._readData(a,mp4lib.fields.FIELD_INT32),this.compatible_brands=this._readArrayData(a,mp4lib.fields.FIELD_INT32),this.localPos},mp4lib.boxes.FileTypeBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT32,this.major_brand),this._writeData(a,mp4lib.fields.FIELD_INT32,this.minor_brand),this._writeArrayData(a,mp4lib.fields.FIELD_INT32,this.compatible_brands),this.localPos},mp4lib.boxes.MovieBox=function(a){mp4lib.boxes.ContainerBox.call(this,"moov",a)},mp4lib.boxes.MovieBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MovieBox.prototype.constructor=mp4lib.boxes.MovieBox,mp4lib.boxes.MovieFragmentBox=function(a){mp4lib.boxes.ContainerBox.call(this,"moof",a)},mp4lib.boxes.MovieFragmentBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MovieFragmentBox.prototype.constructor=mp4lib.boxes.MovieFragmentBox,mp4lib.boxes.MovieFragmentRandomAccessBox=function(a){mp4lib.boxes.ContainerBox.call(this,"mfra",a)},mp4lib.boxes.MovieFragmentRandomAccessBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MovieFragmentRandomAccessBox.prototype.constructor=mp4lib.boxes.MovieFragmentRandomAccessBox,mp4lib.boxes.UserDataBox=function(a){mp4lib.boxes.ContainerBox.call(this,"udta",a)},mp4lib.boxes.UserDataBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.UserDataBox.prototype.constructor=mp4lib.boxes.UserDataBox,mp4lib.boxes.TrackBox=function(a){mp4lib.boxes.ContainerBox.call(this,"trak",a)},mp4lib.boxes.TrackBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.TrackBox.prototype.constructor=mp4lib.boxes.TrackBox,mp4lib.boxes.EditBox=function(a){mp4lib.boxes.ContainerBox.call(this,"edts",a)},mp4lib.boxes.EditBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.EditBox.prototype.constructor=mp4lib.boxes.EditBox,mp4lib.boxes.MediaBox=function(a){mp4lib.boxes.ContainerBox.call(this,"mdia",a)},mp4lib.boxes.MediaBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MediaBox.prototype.constructor=mp4lib.boxes.MediaBox,mp4lib.boxes.MediaInformationBox=function(a){mp4lib.boxes.ContainerBox.call(this,"minf",a)},mp4lib.boxes.MediaInformationBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MediaInformationBox.prototype.constructor=mp4lib.boxes.MediaInformationBox,mp4lib.boxes.DataInformationBox=function(a){mp4lib.boxes.ContainerBox.call(this,"dinf",a)},mp4lib.boxes.DataInformationBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.DataInformationBox.prototype.constructor=mp4lib.boxes.DataInformationBox,mp4lib.boxes.SampleTableBox=function(a){mp4lib.boxes.ContainerBox.call(this,"stbl",a)},mp4lib.boxes.SampleTableBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.SampleTableBox.prototype.constructor=mp4lib.boxes.SampleTableBox,mp4lib.boxes.MovieExtendsBox=function(a){mp4lib.boxes.ContainerBox.call(this,"mvex",a)},mp4lib.boxes.MovieExtendsBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.MovieExtendsBox.prototype.constructor=mp4lib.boxes.MovieExtendsBox,mp4lib.boxes.TrackFragmentBox=function(a){mp4lib.boxes.ContainerBox.call(this,"traf",a)},mp4lib.boxes.TrackFragmentBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.TrackFragmentBox.prototype.constructor=mp4lib.boxes.TrackFragmentBox,mp4lib.boxes.MetaBox=function(a){mp4lib.boxes.ContainerFullBox.call(this,"meta",a)},mp4lib.boxes.MetaBox.prototype=Object.create(mp4lib.boxes.ContainerFullBox.prototype),mp4lib.boxes.MetaBox.prototype.constructor=mp4lib.boxes.MetaBox,mp4lib.boxes.MetaBox.prototype.computeLength=function(){mp4lib.boxes.ContainerFullBox.prototype.computeLength.call(this,!1)},mp4lib.boxes.MetaBox.prototype.read=function(a,b,c){return mp4lib.boxes.ContainerFullBox.prototype.read.call(this,a,b,c,!1)},mp4lib.boxes.MetaBox.prototype.write=function(a,b){return mp4lib.boxes.ContainerFullBox.prototype.write.call(this,a,b,!1)},mp4lib.boxes.MovieHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"mvhd",a)},mp4lib.boxes.MovieHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.MovieHeaderBox.prototype.constructor=mp4lib.boxes.MovieHeaderBox,mp4lib.boxes.MovieHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_INT32.getLength()+2*mp4lib.fields.FIELD_INT16.getLength(),this.size+=2*mp4lib.fields.FIELD_INT32.getLength()+9*mp4lib.fields.FIELD_INT32.getLength(),this.size+=6*mp4lib.fields.FIELD_BIT32.getLength()+mp4lib.fields.FIELD_UINT32.getLength(),this.size+=1===this.version?3*mp4lib.fields.FIELD_UINT64.getLength()+mp4lib.fields.FIELD_UINT32.getLength():4*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.MovieHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.timescale),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.duration)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.timescale),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.duration)),this._writeData(a,mp4lib.fields.FIELD_INT32,this.rate),this._writeData(a,mp4lib.fields.FIELD_INT16,this.volume),this._writeData(a,mp4lib.fields.FIELD_INT16,this.reserved),this._writeArrayData(a,mp4lib.fields.FIELD_INT32,this.reserved_2),this._writeArrayData(a,mp4lib.fields.FIELD_INT32,this.matrix),this._writeArrayData(a,mp4lib.fields.FIELD_BIT32,this.pre_defined),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.next_track_ID),this.localPos},mp4lib.boxes.MovieHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1==this.version?(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.timescale=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT64)):(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.timescale=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.rate=this._readData(a,mp4lib.fields.FIELD_INT32),this.volume=this._readData(a,mp4lib.fields.FIELD_INT16),this.reserved=this._readData(a,mp4lib.fields.FIELD_INT16),this.reserved_2=this._readArrayFieldData(a,mp4lib.fields.FIELD_INT32,2),this.matrix=this._readArrayFieldData(a,mp4lib.fields.FIELD_INT32,9),this.pre_defined=this._readArrayFieldData(a,mp4lib.fields.FIELD_BIT32,6),this.next_track_ID=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.MediaDataBox=function(a){mp4lib.boxes.Box.call(this,"mdat",a)},mp4lib.boxes.MediaDataBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.MediaDataBox.prototype.constructor=mp4lib.boxes.MediaDataBox,mp4lib.boxes.MediaDataBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=this.data.length},mp4lib.boxes.MediaDataBox.prototype.read=function(a,b,c){return this.data=a.subarray(b,c),c},mp4lib.boxes.MediaDataBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeBuffer(a,this.data,this.data.length),this.localPos},mp4lib.boxes.FreeSpaceBox=function(a){mp4lib.boxes.Box.call(this,"free",a)},mp4lib.boxes.FreeSpaceBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.FreeSpaceBox.prototype.constructor=mp4lib.boxes.FreeSpaceBox,mp4lib.boxes.FreeSpaceBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=this.data.length},mp4lib.boxes.FreeSpaceBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.data=a.subarray(this.localPos,this.localEnd),this.localEnd},mp4lib.boxes.FreeSpaceBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeBuffer(a,this.data,this.data.length),this.localPos},mp4lib.boxes.SegmentIndexBox=function(a){mp4lib.boxes.FullBox.call(this,"sidx",a)},mp4lib.boxes.SegmentIndexBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SegmentIndexBox.prototype.constructor=mp4lib.boxes.SegmentIndexBox,mp4lib.boxes.SegmentIndexBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT32.getLength(),this.size+=1===this.version?2*mp4lib.fields.FIELD_UINT64.getLength():2*mp4lib.fields.FIELD_UINT32.getLength(),this.size+=mp4lib.fields.FIELD_UINT16.getLength(),this.size+=mp4lib.fields.FIELD_UINT16.getLength(),this.size+=(mp4lib.fields.FIELD_UINT64.getLength()+mp4lib.fields.FIELD_UINT32.getLength())*this.reference_count},mp4lib.boxes.SegmentIndexBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.reference_ID=this._readData(a,mp4lib.fields.FIELD_UINT32),this.timescale=this._readData(a,mp4lib.fields.FIELD_UINT32),1===this.version?(this.earliest_presentation_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.first_offset=this._readData(a,mp4lib.fields.FIELD_UINT64)):(this.earliest_presentation_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.first_offset=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.reserved=this._readData(a,mp4lib.fields.FIELD_UINT16),this.reference_count=this._readData(a,mp4lib.fields.FIELD_UINT16),this.references=[];for(var d=0;d<this.reference_count;d++){var e={};e.reference_info=this._readData(a,mp4lib.fields.FIELD_UINT64),e.SAP=this._readData(a,mp4lib.fields.FIELD_UINT32),this.references.push(e)}return this.localPos},mp4lib.boxes.SegmentIndexBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.reference_ID),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.timescale),1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.earliest_presentation_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.first_offset)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.earliest_presentation_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.first_offset)),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.reserved),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.reference_count);for(var c=0;c<this.reference_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT64,this.references[c].reference_info),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.references[c].SAP);return this.localPos},mp4lib.boxes.TrackHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"tkhd",a)},mp4lib.boxes.TrackHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackHeaderBox.prototype.constructor=mp4lib.boxes.TrackHeaderBox,mp4lib.boxes.TrackHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=4*mp4lib.fields.FIELD_INT16.getLength()+2*mp4lib.fields.FIELD_INT32.getLength()+2*mp4lib.fields.FIELD_UINT32.getLength()+9*mp4lib.fields.FIELD_INT32.getLength(),this.size+=1==this.version?3*mp4lib.fields.FIELD_UINT64.getLength()+2*mp4lib.fields.FIELD_UINT32.getLength():5*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.TrackHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1===this.version?(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.track_id=this._readData(a,mp4lib.fields.FIELD_UINT32),this.reserved=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT64)):(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.track_id=this._readData(a,mp4lib.fields.FIELD_UINT32),this.reserved=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.reserved_2=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,2),this.layer=this._readData(a,mp4lib.fields.FIELD_INT16),this.alternate_group=this._readData(a,mp4lib.fields.FIELD_INT16),this.volume=this._readData(a,mp4lib.fields.FIELD_INT16),this.reserved_3=this._readData(a,mp4lib.fields.FIELD_INT16),this.matrix=this._readArrayFieldData(a,mp4lib.fields.FIELD_INT32,9),this.width=this._readData(a,mp4lib.fields.FIELD_INT32),this.height=this._readData(a,mp4lib.fields.FIELD_INT32),this.localPos},mp4lib.boxes.TrackHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.track_id),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.reserved),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.duration)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.track_id),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.reserved),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.duration)),this._writeArrayData(a,mp4lib.fields.FIELD_UINT32,this.reserved_2),this._writeData(a,mp4lib.fields.FIELD_INT16,this.layer),this._writeData(a,mp4lib.fields.FIELD_INT16,this.alternate_group),this._writeData(a,mp4lib.fields.FIELD_INT16,this.volume),this._writeData(a,mp4lib.fields.FIELD_INT16,this.reserved_3),this._writeArrayData(a,mp4lib.fields.FIELD_INT32,this.matrix),this._writeData(a,mp4lib.fields.FIELD_INT32,this.width),this._writeData(a,mp4lib.fields.FIELD_INT32,this.height),this.localPos},mp4lib.boxes.MediaHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"mdhd",a)},mp4lib.boxes.MediaHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.MediaHeaderBox.prototype.constructor=mp4lib.boxes.MediaHeaderBox,mp4lib.boxes.MediaHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT16.getLength(),this.size+=1==this.version?3*mp4lib.fields.FIELD_UINT64.getLength()+mp4lib.fields.FIELD_UINT32.getLength():4*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.MediaHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1===this.version?(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.timescale=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT64)):(this.creation_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.modification_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.timescale=this._readData(a,mp4lib.fields.FIELD_UINT32),this.duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.language=this._readData(a,mp4lib.fields.FIELD_UINT16),this.pre_defined=this._readData(a,mp4lib.fields.FIELD_UINT16),this.localPos},mp4lib.boxes.MediaHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.timescale),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.duration)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.creation_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.modification_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.timescale),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.duration)),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.language),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.pre_defined),this.localPos},mp4lib.boxes.MovieExtendsHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"mehd",a)},mp4lib.boxes.MovieExtendsHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.MovieExtendsHeaderBox.prototype.constructor=mp4lib.boxes.MovieExtendsHeaderBox,mp4lib.boxes.MovieExtendsHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=1==this.version?mp4lib.fields.FIELD_UINT64.getLength():mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.MovieExtendsHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.fragment_duration=1===this.version?this._readData(a,mp4lib.fields.FIELD_UINT64):this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.MovieExtendsHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?this._writeData(a,mp4lib.fields.FIELD_UINT64,this.fragment_duration):this._writeData(a,mp4lib.fields.FIELD_UINT32,this.fragment_duration),this.localPos},mp4lib.boxes.HandlerBox=function(a){mp4lib.boxes.FullBox.call(this,"hdlr",a)},mp4lib.boxes.HandlerBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.HandlerBox.prototype.constructor=mp4lib.boxes.HandlerBox,mp4lib.boxes.HandlerBox.prototype.HANDLERTYPEVIDEO="vide",mp4lib.boxes.HandlerBox.prototype.HANDLERTYPEAUDIO="soun",mp4lib.boxes.HandlerBox.prototype.HANDLERTYPETEXT="meta",mp4lib.boxes.HandlerBox.prototype.HANDLERVIDEONAME="Video Track",mp4lib.boxes.HandlerBox.prototype.HANDLERAUDIONAME="Audio Track",mp4lib.boxes.HandlerBox.prototype.HANDLERTEXTNAME="Text Track",mp4lib.boxes.HandlerBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT32.getLength()+3*mp4lib.fields.FIELD_UINT32.getLength()+mp4lib.fields.FIELD_STRING.getLength(this.name)},mp4lib.boxes.HandlerBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.pre_defined=this._readData(a,mp4lib.fields.FIELD_UINT32),this.handler_type=this._readData(a,mp4lib.fields.FIELD_UINT32),this.reserved=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,3),this.name=this._readData(a,mp4lib.fields.FIELD_STRING),this.localPos},mp4lib.boxes.HandlerBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.pre_defined),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.handler_type),this._writeArrayData(a,mp4lib.fields.FIELD_UINT32,this.reserved),this._writeData(a,mp4lib.fields.FIELD_STRING,this.name),this.localPos},mp4lib.boxes.TimeToSampleBox=function(a){mp4lib.boxes.FullBox.call(this,"stts",a)},mp4lib.boxes.TimeToSampleBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TimeToSampleBox.prototype.constructor=mp4lib.boxes.TimeToSampleBox,mp4lib.boxes.TimeToSampleBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=2*this.entry_count*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.TimeToSampleBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entry=[];for(var d=0;d<this.entry_count;d++){var e={};e.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),e.sample_delta=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entry.push(e)}return this.localPos},mp4lib.boxes.TimeToSampleBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].sample_count),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].sample_delta);return this.localPos},mp4lib.boxes.SampleToChunkBox=function(a){mp4lib.boxes.FullBox.call(this,"stsc",a)},mp4lib.boxes.SampleToChunkBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SampleToChunkBox.prototype.constructor=mp4lib.boxes.SampleToChunkBox,mp4lib.boxes.SampleToChunkBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=3*this.entry_count*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.SampleToChunkBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entry=[];for(var d=0;d<this.entry_count;d++){var e={};e.first_chunk=this._readData(a,mp4lib.fields.FIELD_UINT32),e.samples_per_chunk=this._readData(a,mp4lib.fields.FIELD_UINT32),e.samples_description_index=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entry.push(e)}return this.localPos},mp4lib.boxes.SampleToChunkBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].first_chunk),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].samples_per_chunk),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].samples_description_index);

return this.localPos},mp4lib.boxes.ChunkOffsetBox=function(a){mp4lib.boxes.FullBox.call(this,"stco",a)},mp4lib.boxes.ChunkOffsetBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.ChunkOffsetBox.prototype.constructor=mp4lib.boxes.ChunkOffsetBox,mp4lib.boxes.ChunkOffsetBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength()+this.entry_count*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.ChunkOffsetBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32),this.chunk_offset=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,this.entry_count),this.localPos},mp4lib.boxes.ChunkOffsetBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.chunk_offset[c]);return this.localPos},mp4lib.boxes.TrackExtendsBox=function(a){mp4lib.boxes.FullBox.call(this,"trex",a)},mp4lib.boxes.TrackExtendsBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackExtendsBox.prototype.constructor=mp4lib.boxes.TrackExtendsBox,mp4lib.boxes.TrackExtendsBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=5*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.TrackExtendsBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.track_ID=this._readData(a,mp4lib.fields.FIELD_UINT32),this.default_sample_description_index=this._readData(a,mp4lib.fields.FIELD_UINT32),this.default_sample_duration=this._readData(a,mp4lib.fields.FIELD_UINT32),this.default_sample_size=this._readData(a,mp4lib.fields.FIELD_UINT32),this.default_sample_flags=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.TrackExtendsBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.track_ID),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_description_index),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_duration),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_size),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_flags),this.localPos},mp4lib.boxes.VideoMediaHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"vmhd",a)},mp4lib.boxes.VideoMediaHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.VideoMediaHeaderBox.prototype.constructor=mp4lib.boxes.VideoMediaHeaderBox,mp4lib.boxes.VideoMediaHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_INT16.getLength()+3*mp4lib.fields.FIELD_UINT16.getLength()},mp4lib.boxes.VideoMediaHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.graphicsmode=this._readData(a,mp4lib.fields.FIELD_INT16),this.opcolor=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT16,3),this.localPos},mp4lib.boxes.VideoMediaHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT16,this.graphicsmode),this._writeArrayData(a,mp4lib.fields.FIELD_UINT16,this.opcolor),this.localPos},mp4lib.boxes.SoundMediaHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"smhd",a)},mp4lib.boxes.SoundMediaHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SoundMediaHeaderBox.prototype.constructor=mp4lib.boxes.SoundMediaHeaderBox,mp4lib.boxes.SoundMediaHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_INT16.getLength()+mp4lib.fields.FIELD_UINT16.getLength()},mp4lib.boxes.SoundMediaHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.balance=this._readData(a,mp4lib.fields.FIELD_INT16),this.reserved=this._readData(a,mp4lib.fields.FIELD_UINT16),this.localPos},mp4lib.boxes.SoundMediaHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT16,this.balance),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.reserved),this.localPos},mp4lib.boxes.DataReferenceBox=function(a){mp4lib.boxes.ContainerFullBox.call(this,"dref",a)},mp4lib.boxes.DataReferenceBox.prototype=Object.create(mp4lib.boxes.ContainerFullBox.prototype),mp4lib.boxes.DataReferenceBox.prototype.constructor=mp4lib.boxes.DataReferenceBox,mp4lib.boxes.DataReferenceBox.prototype.computeLength=function(){mp4lib.boxes.ContainerFullBox.prototype.computeLength.call(this,!0)},mp4lib.boxes.DataReferenceBox.prototype.read=function(a,b,c){return mp4lib.boxes.ContainerFullBox.prototype.read.call(this,a,b,c,!0)},mp4lib.boxes.DataReferenceBox.prototype.write=function(a,b){return this.entry_count||(this.entry_count=this.boxes.length),mp4lib.boxes.ContainerFullBox.prototype.write.call(this,a,b,!0)},mp4lib.boxes.DataEntryUrlBox=function(a){mp4lib.boxes.FullBox.call(this,"url ",a)},mp4lib.boxes.DataEntryUrlBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.DataEntryUrlBox.prototype.constructor=mp4lib.boxes.DataEntryUrlBox,mp4lib.boxes.DataEntryUrlBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),void 0!==this.location&&(this.size+=mp4lib.fields.FIELD_STRING.getLength(this.location))},mp4lib.boxes.DataEntryUrlBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.flags&!1&&(this.location=this._readData(a,mp4lib.fields.FIELD_STRING)),this.localPos},mp4lib.boxes.DataEntryUrlBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),void 0!==this.location&&this._writeData(a,mp4lib.fields.FIELD_STRING,this.location),this.localPos},mp4lib.boxes.DataEntryUrnBox=function(a){mp4lib.boxes.FullBox.call(this,"urn ",a)},mp4lib.boxes.DataEntryUrnBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.DataEntryUrnBox.prototype.constructor=mp4lib.boxes.DataEntryUrnBox,mp4lib.boxes.DataEntryUrnBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.flags&!1&&(this.size+=mp4lib.fields.FIELD_STRING.getLength(this.name)+mp4lib.fields.FIELD_STRING.getLength(this.location))},mp4lib.boxes.DataEntryUrnBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.flags&!1&&(this.name=this._readData(a,mp4lib.fields.FIELD_STRING),this.location=this._readData(a,mp4lib.fields.FIELD_STRING)),this.localPos},mp4lib.boxes.DataEntryUrnBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this.flags&!1&&(this._writeData(a,mp4lib.fields.FIELD_STRING,this.name),this._writeData(a,mp4lib.fields.FIELD_STRING,this.location)),this.localPos},mp4lib.boxes.MovieFragmentHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"mfhd",a)},mp4lib.boxes.MovieFragmentHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.MovieFragmentHeaderBox.prototype.constructor=mp4lib.boxes.MovieFragmentHeaderBox,mp4lib.boxes.MovieFragmentHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.MovieFragmentHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.sequence_number=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.MovieFragmentHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sequence_number),this.localPos},mp4lib.boxes.TrackFragmentHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"tfhd",a)},mp4lib.boxes.TrackFragmentHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackFragmentHeaderBox.prototype.constructor=mp4lib.boxes.TrackFragmentHeaderBox,mp4lib.boxes.TrackFragmentHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),0!==(1&this.flags)&&void 0!==this.base_data_offset&&(this.size+=mp4lib.fields.FIELD_UINT64.getLength()),0!==(2&this.flags)&&void 0!==this.sample_description_index&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),0!==(8&this.flags)&&void 0!==this.default_sample_duration&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),0!==(16&this.flags)&&void 0!==this.default_sample_size&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),0!==(32&this.flags)&&void 0!==this.default_sample_flags&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength())},mp4lib.boxes.TrackFragmentHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.track_ID=this._readData(a,mp4lib.fields.FIELD_UINT32),0!==(1&this.flags)&&(this.base_data_offset=this._readData(a,mp4lib.fields.FIELD_UINT64)),0!==(2&this.flags)&&(this.sample_description_index=this._readData(a,mp4lib.fields.FIELD_UINT32)),0!==(8&this.flags)&&(this.default_sample_duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),0!==(16&this.flags)&&(this.default_sample_size=this._readData(a,mp4lib.fields.FIELD_UINT32)),0!==(32&this.flags)&&(this.default_sample_flags=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.localPos},mp4lib.boxes.TrackFragmentHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.track_ID),0!==(1&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT64,this.base_data_offset),0!==(2&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_description_index),0!==(8&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_duration),0!==(16&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_size),0!==(32&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.default_sample_flags),this.localPos},mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox=function(a){mp4lib.boxes.FullBox.call(this,"tfdt",a)},mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.constructor=mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox,mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=1===this.version?mp4lib.fields.FIELD_UINT64.getLength():mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.baseMediaDecodeTime=1===this.version?this._readData(a,mp4lib.fields.FIELD_UINT64):this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?this._writeData(a,mp4lib.fields.FIELD_UINT64,this.baseMediaDecodeTime):this._writeData(a,mp4lib.fields.FIELD_UINT32,this.baseMediaDecodeTime),this.localPos},mp4lib.boxes.TrackFragmentRunBox=function(a){mp4lib.boxes.FullBox.call(this,"trun",a)},mp4lib.boxes.TrackFragmentRunBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackFragmentRunBox.prototype.constructor=mp4lib.boxes.TrackFragmentRunBox,mp4lib.boxes.TrackFragmentRunBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this);var a=0;for(this.size+=mp4lib.fields.FIELD_UINT32.getLength(),0!==(1&this.flags)&&void 0!==this.data_offset&&(this.size+=mp4lib.fields.FIELD_INT32.getLength()),0!==(4&this.flags)&&void 0!==this.first_sample_flags&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),a=0;a<this.sample_count;a++)0!==(256&this.flags)&&void 0!==this.samples_table[a].sample_duration&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),0!==(512&this.flags)&&void 0!==this.samples_table[a].sample_size&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),0!==(1024&this.flags)&&void 0!==this.samples_table[a].sample_flags&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength()),1===this.version?0!==(2048&this.flags)&&void 0!==this.samples_table[a].sample_composition_time_offset&&(this.size+=mp4lib.fields.FIELD_INT32.getLength()):0!==(2048&this.flags)&&void 0!==this.samples_table[a].sample_composition_time_offset&&(this.size+=mp4lib.fields.FIELD_UINT32.getLength())},mp4lib.boxes.TrackFragmentRunBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),0!==(1&this.flags)&&(this.data_offset=this._readData(a,mp4lib.fields.FIELD_INT32)),0!==(4&this.flags)&&(this.first_sample_flags=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.samples_table=[];for(var d=0;d<this.sample_count;d++){var e={};0!==(256&this.flags)&&(e.sample_duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),0!==(512&this.flags)&&(e.sample_size=this._readData(a,mp4lib.fields.FIELD_UINT32)),0!==(1024&this.flags)&&(e.sample_flags=this._readData(a,mp4lib.fields.FIELD_UINT32)),1===this.version?0!==(2048&this.flags)&&(e.sample_composition_time_offset=this._readData(a,mp4lib.fields.FIELD_INT32)):0!==(2048&this.flags)&&(e.sample_composition_time_offset=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.samples_table.push(e)}return this.localPos},mp4lib.boxes.TrackFragmentRunBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_count),0!==(1&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_INT32,this.data_offset),0!==(4&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.first_sample_flags);for(var c=0;c<this.sample_count;c++)0!==(256&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.samples_table[c].sample_duration),0!==(512&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.samples_table[c].sample_size),0!==(1024&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.samples_table[c].sample_flags),1===this.version?0!==(2048&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_INT32,this.samples_table[c].sample_composition_time_offset):0!==(2048&this.flags)&&this._writeData(a,mp4lib.fields.FIELD_UINT32,this.samples_table[c].sample_composition_time_offset);return this.localPos},mp4lib.boxes.SampleDescriptionBox=function(a){mp4lib.boxes.ContainerFullBox.call(this,"stsd",a)},mp4lib.boxes.SampleDescriptionBox.prototype=Object.create(mp4lib.boxes.ContainerFullBox.prototype),mp4lib.boxes.SampleDescriptionBox.prototype.constructor=mp4lib.boxes.SampleDescriptionBox,mp4lib.boxes.SampleDescriptionBox.prototype.computeLength=function(){mp4lib.boxes.ContainerFullBox.prototype.computeLength.call(this,!0)},mp4lib.boxes.SampleDescriptionBox.prototype.read=function(a,b,c){return mp4lib.boxes.ContainerFullBox.prototype.read.call(this,a,b,c,!0)},mp4lib.boxes.SampleDescriptionBox.prototype.write=function(a,b){return this.entry_count=this.boxes.length,mp4lib.boxes.ContainerFullBox.prototype.write.call(this,a,b,!0)},mp4lib.boxes.SampleDependencyTableBox=function(a){mp4lib.boxes.FullBox.call(this,"sdtp",a)},mp4lib.boxes.SampleDependencyTableBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SampleDependencyTableBox.prototype.constructor=mp4lib.boxes.SampleDependencyTableBox,mp4lib.boxes.SampleDependencyTableBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT8.getLength()*this.sample_dependency_array.length},mp4lib.boxes.SampleDependencyTableBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.sample_dependency_array=this._readArrayData(a,mp4lib.fields.FIELD_UINT8),this.localPos},mp4lib.boxes.SampleDependencyTableBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeArrayData(a,mp4lib.fields.FIELD_UINT8,this.sample_dependency_array),this.localPos},mp4lib.boxes.SampleEntryBox=function(a,b){mp4lib.boxes.Box.call(this,a,b)},mp4lib.boxes.SampleEntryBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.SampleEntryBox.prototype.constructor=mp4lib.boxes.SampleEntryBox,mp4lib.boxes.SampleEntryBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT16.getLength()+6*mp4lib.fields.FIELD_UINT8.getLength()},mp4lib.boxes.SampleEntryBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.reserved=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT8,6),this.data_reference_index=this._readData(a,mp4lib.fields.FIELD_UINT16),this.localPos},mp4lib.boxes.SampleEntryBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeArrayData(a,mp4lib.fields.FIELD_UINT8,this.reserved),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.data_reference_index),this.localPos},mp4lib.boxes.VisualSampleEntryBox=function(a,b){mp4lib.boxes.SampleEntryBox.call(this,a,b)},mp4lib.boxes.VisualSampleEntryBox.prototype=Object.create(mp4lib.boxes.SampleEntryBox.prototype),mp4lib.boxes.VisualSampleEntryBox.prototype.constructor=mp4lib.boxes.VisualSampleEntryBox,mp4lib.boxes.VisualSampleEntryBox.prototype.computeLength=function(){mp4lib.boxes.SampleEntryBox.prototype.computeLength.call(this),this.size+=7*mp4lib.fields.FIELD_UINT16.getLength()+3*mp4lib.fields.FIELD_UINT32.getLength(),this.size+=3*mp4lib.fields.FIELD_UINT32.getLength(),this.size+=32},mp4lib.boxes.VisualSampleEntryBox.prototype.read=function(a,b,c){return mp4lib.boxes.SampleEntryBox.prototype.read.call(this,a,b,c),this.pre_defined=this._readData(a,mp4lib.fields.FIELD_UINT16),this.reserved_2=this._readData(a,mp4lib.fields.FIELD_UINT16),this.pre_defined_2=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,3),this.width=this._readData(a,mp4lib.fields.FIELD_UINT16),this.height=this._readData(a,mp4lib.fields.FIELD_UINT16),this.horizresolution=this._readData(a,mp4lib.fields.FIELD_UINT32),this.vertresolution=this._readData(a,mp4lib.fields.FIELD_UINT32),this.reserved_3=this._readData(a,mp4lib.fields.FIELD_UINT32),this.frame_count=this._readData(a,mp4lib.fields.FIELD_UINT16),this.compressorname=new mp4lib.fields.FixedLenStringField(32),this.compressorname=this.compressorname.read(a,this.localPos),this.localPos+=32,this.depth=this._readData(a,mp4lib.fields.FIELD_UINT16),this.pre_defined_3=this._readData(a,mp4lib.fields.FIELD_INT16),this.localPos},mp4lib.boxes.VisualSampleEntryBox.prototype.write=function(a,b){mp4lib.boxes.SampleEntryBox.prototype.write.call(this,a,b);var c=0;for(this._writeData(a,mp4lib.fields.FIELD_UINT16,this.pre_defined),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.reserved_2),this._writeArrayData(a,mp4lib.fields.FIELD_UINT32,this.pre_defined_2),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.width),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.height),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.horizresolution),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.vertresolution),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.reserved_3),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.frame_count),c=0;32>c;c++)a[this.localPos+c]=this.compressorname.charCodeAt(c);return this.localPos+=32,this._writeData(a,mp4lib.fields.FIELD_UINT16,this.depth),this._writeData(a,mp4lib.fields.FIELD_INT16,this.pre_defined_3),this.localPos},mp4lib.boxes.VisualSampleEntryContainerBox=function(a,b){mp4lib.boxes.VisualSampleEntryBox.call(this,a,b),this.boxes=[]},mp4lib.boxes.VisualSampleEntryContainerBox.prototype=Object.create(mp4lib.boxes.VisualSampleEntryBox.prototype),mp4lib.boxes.VisualSampleEntryContainerBox.prototype.constructor=mp4lib.boxes.VisualSampleEntryContainerBox,mp4lib.boxes.VisualSampleEntryContainerBox.prototype.computeLength=function(){mp4lib.boxes.VisualSampleEntryBox.prototype.computeLength.call(this);var a=0;for(a=0;a<this.boxes.length;a++)this.boxes[a].computeLength(),this.size+=this.boxes[a].size},mp4lib.boxes.VisualSampleEntryContainerBox.prototype.read=function(a,b,c){mp4lib.boxes.VisualSampleEntryBox.prototype.read.call(this,a,b,c);for(var d,e=0,f=0,g=null;this.localPos<this.localEnd;){e=mp4lib.fields.FIELD_UINT32.read(a,this.localPos),d=mp4lib.fields.readString(a,this.localPos+4,4),"uuid"==d&&(f=1==e?16:8,g=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,this.localPos+f,this.localPos+f+16),g=JSON.stringify(g));var h=mp4lib.createBox(d,e,g);if(this.localPos="uuid"===d?h.read(a,this.localPos+16*mp4lib.fields.FIELD_INT8.getLength()+8,this.localPos+e):h.read(a,this.localPos+8,this.localPos+e),mp4lib.debug&&(h.__sourceBuffer=a.subarray(this.localPos-h.size,this.localPos)),this.boxes.push(h),h.size<=0||null===h.size)throw new mp4lib.ParseException("Problem on size of box "+h.boxtype+", parsing stopped to avoid infinite loop");if(!h.boxtype)throw new mp4lib.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return this.localPos},mp4lib.boxes.VisualSampleEntryContainerBox.prototype.write=function(a,b){mp4lib.boxes.VisualSampleEntryBox.prototype.write.call(this,a,b);for(var c=0;c<this.boxes.length;c++)this.localPos=this.boxes[c].write(a,this.localPos);return this.localPos},mp4lib.boxes.AVC1VisualSampleEntryBox=function(a){mp4lib.boxes.VisualSampleEntryContainerBox.call(this,"avc1",a)},mp4lib.boxes.AVC1VisualSampleEntryBox.prototype=Object.create(mp4lib.boxes.VisualSampleEntryContainerBox.prototype),mp4lib.boxes.AVC1VisualSampleEntryBox.prototype.constructor=mp4lib.boxes.AVC1VisualSampleEntryBox,mp4lib.boxes.EncryptedVideoBox=function(a){mp4lib.boxes.VisualSampleEntryContainerBox.call(this,"encv",a)},mp4lib.boxes.EncryptedVideoBox.prototype=Object.create(mp4lib.boxes.VisualSampleEntryContainerBox.prototype),mp4lib.boxes.EncryptedVideoBox.prototype.constructor=mp4lib.boxes.EncryptedVideoBox,mp4lib.boxes.AVCConfigurationBox=function(a){mp4lib.boxes.Box.call(this,"avcC",a)},mp4lib.boxes.AVCConfigurationBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.AVCConfigurationBox.prototype.constructor=mp4lib.boxes.AVCConfigurationBox,mp4lib.boxes.AVCConfigurationBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=4*mp4lib.fields.FIELD_UINT8.getLength()+3*mp4lib.fields.FIELD_UINT8.getLength(),this.size+=this._getNALLength(this.numOfSequenceParameterSets,this.SPS_NAL),this.size+=this._getNALLength(this.numOfPictureParameterSets,this.PPS_NAL)},mp4lib.boxes.AVCConfigurationBox.prototype._getNALLength=function(a,b){for(var c=0,d=0;a>d;d++)c+=mp4lib.fields.FIELD_UINT16.getLength()+b[d].NAL_length;return c},mp4lib.boxes.AVCConfigurationBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.configurationVersion=this._readData(a,mp4lib.fields.FIELD_UINT8),this.AVCProfileIndication=this._readData(a,mp4lib.fields.FIELD_UINT8),this.profile_compatibility=this._readData(a,mp4lib.fields.FIELD_UINT8),this.AVCLevelIndication=this._readData(a,mp4lib.fields.FIELD_UINT8),this.temp=this._readData(a,mp4lib.fields.FIELD_UINT8),this.lengthSizeMinusOne=3&this.temp,this.numOfSequenceParameterSets_tmp=this._readData(a,mp4lib.fields.FIELD_UINT8),this.numOfSequenceParameterSets=31&this.numOfSequenceParameterSets_tmp,this.SPS_NAL=this._readNAL(a,this.numOfSequenceParameterSets),this.numOfPictureParameterSets=this._readData(a,mp4lib.fields.FIELD_UINT8),this.PPS_NAL=this._readNAL(a,this.numOfPictureParameterSets),this.localPos},mp4lib.boxes.AVCConfigurationBox.prototype._readNAL=function(a,b){for(var c=[],d=0;b>d;d++){var e={};e.NAL_length=this._readData(a,mp4lib.fields.FIELD_UINT16),e.NAL=a.subarray(this.localPos,this.localPos+e.NAL_length),this.localPos+=e.NAL_length,c.push(e)}return c},mp4lib.boxes.AVCConfigurationBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.configurationVersion),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.AVCProfileIndication),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.profile_compatibility),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.AVCLevelIndication),this.temp=252|this.lengthSizeMinusOne,this._writeData(a,mp4lib.fields.FIELD_UINT8,this.temp),this.numOfSequenceParameterSets=this.SPS_NAL.length,this.numOfSequenceParameterSets_tmp=224|this.numOfSequenceParameterSets,this._writeData(a,mp4lib.fields.FIELD_UINT8,this.numOfSequenceParameterSets_tmp),this._writeNAL(a,this.numOfSequenceParameterSets,this.SPS_NAL),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.numOfPictureParameterSets),this._writeNAL(a,this.numOfPictureParameterSets,this.PPS_NAL),this.localPos},mp4lib.boxes.AVCConfigurationBox.prototype._writeNAL=function(a,b,c){for(var d=0;b>d;d++)this._writeData(a,mp4lib.fields.FIELD_UINT16,c[d].NAL_length),this._writeBuffer(a,c[d].NAL,c[d].NAL_length)},mp4lib.boxes.PixelAspectRatioBox=function(a){mp4lib.boxes.Box.call(this,"pasp",a)},mp4lib.boxes.PixelAspectRatioBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.PixelAspectRatioBox.prototype.constructor=mp4lib.boxes.PixelAspectRatioBox,mp4lib.boxes.PixelAspectRatioBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_INT32.getLength()},mp4lib.boxes.PixelAspectRatioBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.hSpacing=this._readData(a,mp4lib.fields.FIELD_INT32),this.vSpacing=this._readData(a,mp4lib.fields.FIELD_INT32),this.localPos},mp4lib.boxes.PixelAspectRatioBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT32,this.hSpacing),this._writeData(a,mp4lib.fields.FIELD_INT32,this.vSpacing),this.localPos},mp4lib.boxes.AudioSampleEntryBox=function(a,b){mp4lib.boxes.SampleEntryBox.call(this,a,b)},mp4lib.boxes.AudioSampleEntryBox.prototype=Object.create(mp4lib.boxes.SampleEntryBox.prototype),mp4lib.boxes.AudioSampleEntryBox.prototype.constructor=mp4lib.boxes.AudioSampleEntryBox,mp4lib.boxes.AudioSampleEntryBox.prototype.computeLength=function(){mp4lib.boxes.SampleEntryBox.prototype.computeLength.call(this),this.size+=4*mp4lib.fields.FIELD_UINT16.getLength()+3*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.AudioSampleEntryBox.prototype.read=function(a,b,c){return mp4lib.boxes.SampleEntryBox.prototype.read.call(this,a,b,c),this.reserved_2=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,2),this.channelcount=this._readData(a,mp4lib.fields.FIELD_UINT16),this.samplesize=this._readData(a,mp4lib.fields.FIELD_UINT16),this.pre_defined=this._readData(a,mp4lib.fields.FIELD_UINT16),this.reserved_3=this._readData(a,mp4lib.fields.FIELD_UINT16),this.samplerate=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.AudioSampleEntryBox.prototype.write=function(a,b){return mp4lib.boxes.SampleEntryBox.prototype.write.call(this,a,b),this._writeArrayData(a,mp4lib.fields.FIELD_UINT32,this.reserved_2),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.channelcount),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.samplesize),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.pre_defined),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.reserved_3),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.samplerate),this.localPos},mp4lib.boxes.AudioSampleEntryContainerBox=function(a,b){mp4lib.boxes.AudioSampleEntryBox.call(this,a,b),this.boxes=[]},mp4lib.boxes.AudioSampleEntryContainerBox.prototype=Object.create(mp4lib.boxes.AudioSampleEntryBox.prototype),mp4lib.boxes.AudioSampleEntryContainerBox.prototype.constructor=mp4lib.boxes.AudioSampleEntryContainerBox,mp4lib.boxes.AudioSampleEntryContainerBox.prototype.computeLength=function(){mp4lib.boxes.AudioSampleEntryBox.prototype.computeLength.call(this);var a=0;for(a=0;a<this.boxes.length;a++)this.boxes[a].computeLength(),this.size+=this.boxes[a].size},mp4lib.boxes.AudioSampleEntryContainerBox.prototype.read=function(a,b,c){mp4lib.boxes.AudioSampleEntryBox.prototype.read.call(this,a,b,c);for(var d,e=0,f=0,g=null;this.localPos<this.localEnd;){e=mp4lib.fields.FIELD_UINT32.read(a,this.localPos),d=mp4lib.fields.readString(a,this.localPos+4,4),"uuid"==d&&(f=1==e?16:8,g=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,this.localPos+f,this.localPos+f+16),g=JSON.stringify(g));var h=mp4lib.createBox(d,e,g);if(this.localPos="uuid"===d?h.read(a,this.localPos+16*mp4lib.fields.FIELD_INT8.getLength()+8,this.localPos+e):h.read(a,this.localPos+8,this.localPos+e),mp4lib.debug&&(h.__sourceBuffer=a.subarray(this.localPos-h.size,this.localPos)),this.boxes.push(h),h.size<=0||null===h.size)throw new mp4lib.ParseException("Problem on size of box "+h.boxtype+", parsing stopped to avoid infinite loop");if(!h.boxtype)throw new mp4lib.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return this.localPos},mp4lib.boxes.AudioSampleEntryContainerBox.prototype.write=function(a,b){mp4lib.boxes.AudioSampleEntryBox.prototype.write.call(this,a,b);for(var c=0;c<this.boxes.length;c++)this.localPos=this.boxes[c].write(a,this.localPos);return this.localPos},mp4lib.boxes.MP4AudioSampleEntryBox=function(a){mp4lib.boxes.AudioSampleEntryContainerBox.call(this,"mp4a",a)},mp4lib.boxes.MP4AudioSampleEntryBox.prototype=Object.create(mp4lib.boxes.AudioSampleEntryContainerBox.prototype),mp4lib.boxes.MP4AudioSampleEntryBox.prototype.constructor=mp4lib.boxes.MP4AudioSampleEntryBox,mp4lib.boxes.EncryptedAudioBox=function(a){mp4lib.boxes.AudioSampleEntryContainerBox.call(this,"enca",a)},mp4lib.boxes.EncryptedAudioBox.prototype=Object.create(mp4lib.boxes.AudioSampleEntryContainerBox.prototype),mp4lib.boxes.EncryptedAudioBox.prototype.constructor=mp4lib.boxes.EncryptedAudioBox,mp4lib.boxes.ESDBox=function(a){mp4lib.boxes.FullBox.call(this,"esds",a)},mp4lib.boxes.ESDBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.ESDBox.prototype.constructor=mp4lib.boxes.ESDBox,mp4lib.boxes.ESDBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT8.getLength()+this.ES_length},mp4lib.boxes.ESDBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.ES_tag=this._readData(a,mp4lib.fields.FIELD_UINT8),this.ES_length=this._readData(a,mp4lib.fields.FIELD_UINT8),this.ES_data=a.subarray(this.localPos,this.localPos+this.ES_length),this.localPos+=this.ES_length,this.localPos},mp4lib.boxes.ESDBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.ES_tag),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.ES_length),this._writeBuffer(a,this.ES_data,this.ES_length),this.localPos},mp4lib.boxes.SampleSizeBox=function(a){mp4lib.boxes.FullBox.call(this,"stsz",a)},mp4lib.boxes.SampleSizeBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SampleSizeBox.prototype.constructor=mp4lib.boxes.SampleSizeBox,mp4lib.boxes.SampleSizeBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT32.getLength()+mp4lib.fields.FIELD_UINT32.getLength()*this.sample_count},mp4lib.boxes.SampleSizeBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.sample_size=this._readData(a,mp4lib.fields.FIELD_UINT32),this.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entries=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,this.sample_count),
this.localPos},mp4lib.boxes.SampleSizeBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_size),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_count);for(var c=0;c<this.sample_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c]);return this.localPos},mp4lib.boxes.ProtectionSystemSpecificHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"pssh",a)},mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype.constructor=mp4lib.boxes.ProtectionSystemSpecificHeaderBox,mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=16*mp4lib.fields.FIELD_UINT8.getLength(),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=mp4lib.fields.FIELD_UINT8.getLength()*this.DataSize},mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.SystemID=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT8,16),this.DataSize=this._readData(a,mp4lib.fields.FIELD_UINT32),this.Data=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT8,this.DataSize),this.localPos},mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b);var c=0;for(c=0;16>c;c++)this._writeData(a,mp4lib.fields.FIELD_UINT8,this.SystemID[c]);for(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.DataSize),c=0;c<this.DataSize;c++)this._writeData(a,mp4lib.fields.FIELD_UINT8,this.Data[c]);return this.localPos},mp4lib.boxes.SampleAuxiliaryInformationSizesBox=function(a){mp4lib.boxes.FullBox.call(this,"saiz",a)},mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype.constructor=mp4lib.boxes.SampleAuxiliaryInformationSizesBox,mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),1&this.flags&&(this.size+=2*mp4lib.fields.FIELD_UINT32.getLength()),this.size+=mp4lib.fields.FIELD_UINT8.getLength()+mp4lib.fields.FIELD_UINT32.getLength(),0===this.default_sample_info_size&&(this.size+=mp4lib.fields.FIELD_UINT8.getLength()*this.sample_count)},mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1&this.flags&&(this.aux_info_type=this._readData(a,mp4lib.fields.FIELD_UINT32),this.aux_info_type_parameter=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.default_sample_info_size=this._readData(a,mp4lib.fields.FIELD_UINT8),this.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),0===this.default_sample_info_size&&(this.sample_info_size=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT8,this.sample_count)),this.localPos},mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype.write=function(a,b){if(mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1&this.flags&&(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.aux_info_type),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.aux_info_type_parameter)),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.default_sample_info_size),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_count),0===this.default_sample_info_size)for(var c=0;c<this.sample_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT8,this.sample_info_size[c]);return this.localPos},mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox=function(a){mp4lib.boxes.FullBox.call(this,"saio",a)},mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.constructor=mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox,mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),1&this.flags&&(this.size+=2*mp4lib.fields.FIELD_UINT32.getLength()),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=0===this.version?mp4lib.fields.FIELD_UINT32.getLength()*this.entry_count:mp4lib.fields.FIELD_UINT64.getLength()*this.entry_count},mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1&this.flags&&(this.aux_info_type=this._readData(a,mp4lib.fields.FIELD_UINT32),this.aux_info_type_parameter=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32),this.offset=0===this.version?this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT32,this.entry_count):this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT64,this.entry_count),this.localPos},mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b);var c=0;if(1&this.flags&&(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.aux_info_type),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.aux_info_type_parameter)),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count),0===this.version)for(c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.offset[c]);else for(c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT64,this.offset[c]);return this.localPos},mp4lib.boxes.ProtectionSchemeInformationBox=function(a){mp4lib.boxes.ContainerBox.call(this,"sinf",a)},mp4lib.boxes.ProtectionSchemeInformationBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.ProtectionSchemeInformationBox.prototype.constructor=mp4lib.boxes.ProtectionSchemeInformationBox,mp4lib.boxes.SchemeInformationBox=function(a){mp4lib.boxes.ContainerBox.call(this,"schi",a)},mp4lib.boxes.SchemeInformationBox.prototype=Object.create(mp4lib.boxes.ContainerBox.prototype),mp4lib.boxes.SchemeInformationBox.prototype.constructor=mp4lib.boxes.SchemeInformationBox,mp4lib.boxes.TrackEncryptionBox=function(a){mp4lib.boxes.FullBox.call(this,"tenc",a)},mp4lib.boxes.TrackEncryptionBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackEncryptionBox.prototype.constructor=mp4lib.boxes.TrackEncryptionBox,mp4lib.boxes.TrackEncryptionBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_BIT24.getLength(),this.size+=mp4lib.fields.FIELD_UINT8.getLength(),this.size+=16*mp4lib.fields.FIELD_UINT8.getLength()},mp4lib.boxes.TrackEncryptionBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.default_IsEncrypted=this._readData(a,mp4lib.fields.FIELD_BIT24),this.default_IV_size=this._readData(a,mp4lib.fields.FIELD_UINT8),this.default_KID=this._readArrayFieldData(a,mp4lib.fields.FIELD_UINT8,16),this.localPos},mp4lib.boxes.TrackEncryptionBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_BIT24,this.default_IsEncrypted),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.default_IV_size),this._writeArrayData(a,mp4lib.fields.FIELD_UINT8,this.default_KID),this.localPos},mp4lib.boxes.SchemeTypeBox=function(a){mp4lib.boxes.FullBox.call(this,"schm",a)},mp4lib.boxes.SchemeTypeBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SchemeTypeBox.prototype.constructor=mp4lib.boxes.SchemeTypeBox,mp4lib.boxes.SchemeTypeBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT32.getLength(),1&this.flags&&(this.size+=mp4lib.fields.FIELD_STRING.getLength(this.scheme_uri))},mp4lib.boxes.SchemeTypeBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.scheme_type=this._readData(a,mp4lib.fields.FIELD_UINT32),this.scheme_version=this._readData(a,mp4lib.fields.FIELD_UINT32),1&this.flags&&(this.scheme_uri=this._readData(a,mp4lib.fields.FIELD_STRING)),this.localPos},mp4lib.boxes.SchemeTypeBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.scheme_type),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.scheme_version),1&this.flags&&this._writeData(a,mp4lib.fields.FIELD_STRING,this.scheme_uri),this.localPos},mp4lib.boxes.EditListBox=function(a){mp4lib.boxes.FullBox.call(this,"elst",a),this.entries=[]},mp4lib.boxes.EditListBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.EditListBox.prototype.constructor=mp4lib.boxes.EditListBox,mp4lib.boxes.EditListBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=1===this.version?(2*mp4lib.fields.FIELD_UINT64.getLength()+2*mp4lib.fields.FIELD_UINT16.getLength())*this.entry_count:(2*mp4lib.fields.FIELD_UINT32.getLength()+2*mp4lib.fields.FIELD_UINT16.getLength())*this.entry_count},mp4lib.boxes.EditListBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32);for(var d=0;d<this.entry_count;d++){var e={};1===this.version?(e.segment_duration=this._readData(a,mp4lib.fields.FIELD_UINT64),e.media_time=this._readData(a,mp4lib.fields.FIELD_UINT64)):(e.segment_duration=this._readData(a,mp4lib.fields.FIELD_UINT32),e.media_time=this._readData(a,mp4lib.fields.FIELD_UINT32)),e.media_rate_integer=this._readData(a,mp4lib.fields.FIELD_UINT16),e.media_rate_fraction=this._readData(a,mp4lib.fields.FIELD_UINT16),this.entries.push(e)}return this.localPos},mp4lib.boxes.EditListBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.entries[c].segment_duration),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.entries[c].media_time)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].segment_duration),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].media_time)),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.entries[c].media_rate_integer),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.entries[c].media_rate_fraction);return this.localPos},mp4lib.boxes.HintMediaHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"hmhd",a)},mp4lib.boxes.HintMediaHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.HintMediaHeaderBox.prototype.constructor=mp4lib.boxes.HintMediaHeaderBox,mp4lib.boxes.HintMediaHeaderBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*mp4lib.fields.FIELD_UINT16.getLength(),this.size+=3*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.HintMediaHeaderBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.maxPDUsize=this._readData(a,mp4lib.fields.FIELD_UINT16),this.avgPDUsize=this._readData(a,mp4lib.fields.FIELD_UINT16),this.maxbitrate=this._readData(a,mp4lib.fields.FIELD_UINT32),this.avgbitrate=this._readData(a,mp4lib.fields.FIELD_UINT32),this.reserved=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.HintMediaHeaderBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.maxPDUsize),this._writeData(a,mp4lib.fields.FIELD_UINT16,this.avgPDUsize),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.maxbitrate),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.avgbitrate),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.reserved),this.localPos},mp4lib.boxes.NullMediaHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"nmhd",a)},mp4lib.boxes.NullMediaHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.NullMediaHeaderBox.prototype.constructor=mp4lib.boxes.NullMediaHeaderBox,mp4lib.boxes.CompositionOffsetBox=function(a){mp4lib.boxes.FullBox.call(this,"ctts",a),this.entries=[]},mp4lib.boxes.CompositionOffsetBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.CompositionOffsetBox.prototype.constructor=mp4lib.boxes.CompositionOffsetBox,mp4lib.boxes.CompositionOffsetBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=0===this.version?2*mp4lib.fields.FIELD_UINT32.getLength()*this.entry_count:(mp4lib.fields.FIELD_UINT32.getLength()+mp4lib.fields.FIELD_INT32.getLength())*this.entry_count},mp4lib.boxes.CompositionOffsetBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32);for(var d=0;d<this.entry_count;d++){var e={};0===this.version?(e.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),e.sample_offset=this._readData(a,mp4lib.fields.FIELD_UINT32)):(e.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),e.sample_offset=this._readData(a,mp4lib.fields.FIELD_INT32)),this.entries.push(e)}return this.localPos},mp4lib.boxes.CompositionOffsetBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)0===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].sample_count),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].sample_offset)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].sample_count),this._writeData(a,mp4lib.fields.FIELD_INT32,this.entries[c].sample_offset));return this.localPos},mp4lib.boxes.CompositionToDecodeBox=function(a){mp4lib.boxes.FullBox.call(this,"cslg",a)},mp4lib.boxes.CompositionToDecodeBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.CompositionToDecodeBox.prototype.constructor=mp4lib.boxes.CompositionToDecodeBox,mp4lib.boxes.CompositionToDecodeBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=5*mp4lib.fields.FIELD_INT32.getLength()},mp4lib.boxes.CompositionToDecodeBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.compositionToDTSShift=this._readData(a,mp4lib.fields.FIELD_INT32),this.leastDecodeToDisplayDelta=this._readData(a,mp4lib.fields.FIELD_INT32),this.greatestDecodeToDisplayDelta=this._readData(a,mp4lib.fields.FIELD_INT32),this.compositionStartTime=this._readData(a,mp4lib.fields.FIELD_INT32),this.compositionEndTime=this._readData(a,mp4lib.fields.FIELD_INT32),this.localPos},mp4lib.boxes.CompositionToDecodeBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_INT32,this.compositionToDTSShift),this._writeData(a,mp4lib.fields.FIELD_INT32,this.leastDecodeToDisplayDelta),this._writeData(a,mp4lib.fields.FIELD_INT32,this.greatestDecodeToDisplayDelta),this._writeData(a,mp4lib.fields.FIELD_INT32,this.compositionStartTime),this._writeData(a,mp4lib.fields.FIELD_INT32,this.compositionEndTime),this.localPos},mp4lib.boxes.SyncSampleBox=function(a){mp4lib.boxes.FullBox.call(this,"stss",a),this.entries=[]},mp4lib.boxes.SyncSampleBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.SyncSampleBox.prototype.constructor=mp4lib.boxes.SyncSampleBox,mp4lib.boxes.SyncSampleBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength(),this.size+=mp4lib.fields.FIELD_UINT32.getLength()*this.entry_count},mp4lib.boxes.SyncSampleBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.entry_count=this._readData(a,mp4lib.fields.FIELD_UINT32);for(var d=0;d<this.entry_count;d++){var e={};e.sample_number=this._readData(a,mp4lib.fields.FIELD_UINT32),this.entries.push(e)}return this.localPos},mp4lib.boxes.SyncSampleBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry_count);for(var c=0;c<this.entry_count;c++)this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entries[c].sample_number);return this.localPos},mp4lib.boxes.TrackReferenceBox=function(a){mp4lib.boxes.FullBox.call(this,"tref",a)},mp4lib.boxes.TrackReferenceBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TrackReferenceBox.prototype.constructor=mp4lib.boxes.TrackReferenceBox,mp4lib.boxes.TrackReferenceBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength()*this.track_IDs.length},mp4lib.boxes.TrackReferenceBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.track_IDs=this._readArrayData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.TrackReferenceBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeArrayData(a,mp4lib.fields.FIELD_UINT32,this.track_IDs),this.localPos},mp4lib.boxes.OriginalFormatBox=function(a){mp4lib.boxes.Box.call(this,"frma",a)},mp4lib.boxes.OriginalFormatBox.prototype=Object.create(mp4lib.boxes.Box.prototype),mp4lib.boxes.OriginalFormatBox.prototype.constructor=mp4lib.boxes.OriginalFormatBox,mp4lib.boxes.OriginalFormatBox.prototype.computeLength=function(){mp4lib.boxes.Box.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.OriginalFormatBox.prototype.read=function(a,b,c){return this.localPos=b,this.localEnd=c,this.data_format=this._readData(a,mp4lib.fields.FIELD_UINT32),this.localPos},mp4lib.boxes.OriginalFormatBox.prototype.write=function(a,b){return mp4lib.boxes.Box.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.data_format),this.localPos},mp4lib.boxes.PiffSampleEncryptionBox=function(a){mp4lib.boxes.FullBox.call(this,"sepiff",a,[162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244])},mp4lib.boxes.PiffSampleEncryptionBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.PiffSampleEncryptionBox.prototype.constructor=mp4lib.boxes.PiffSampleEncryptionBox,mp4lib.boxes.PiffSampleEncryptionBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this);var a=0,b=0;for(this.size+=mp4lib.fields.FIELD_UINT32.getLength(),1&this.flags&&(this.size+=mp4lib.fields.FIELD_UINT8.getLength()),a=0;a<this.sample_count;a++)if(this.size+=8,2&this.flags)for(this.size+=mp4lib.fields.FIELD_UINT16.getLength(),b=0;b<this.entry[a].NumberOfEntries;b++)this.size+=mp4lib.fields.FIELD_UINT16.getLength(),this.size+=mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.PiffSampleEncryptionBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.sample_count),1&this.flags&&this._writeData(a,mp4lib.fields.FIELD_UINT8,this.IV_size);for(var c=0;c<this.sample_count;c++)if(this._writeBuffer(a,this.entry[c].InitializationVector,8),2&this.flags){this._writeData(a,mp4lib.fields.FIELD_UINT16,this.entry[c].NumberOfEntries);for(var d=0;d<this.entry[c].NumberOfEntries;d++)this._writeData(a,mp4lib.fields.FIELD_UINT16,this.entry[c].clearAndCryptedData[d].BytesOfClearData),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].clearAndCryptedData[d].BytesOfEncryptedData)}return this.localPos},mp4lib.boxes.PiffSampleEncryptionBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.sample_count=this._readData(a,mp4lib.fields.FIELD_UINT32),1&this.flags&&(this.IV_size=this._readData(a,mp4lib.fields.FIELD_UINT8)),this.entry=[];for(var d=0;d<this.sample_count;d++){var e={};if(e.InitializationVector=a.subarray(this.localPos,this.localPos+8),this.localPos+=8,2&this.flags){e.NumberOfEntries=this._readData(a,mp4lib.fields.FIELD_UINT16),e.clearAndCryptedData=[];for(var f=0;f<e.NumberOfEntries;f++){var g={};g.BytesOfClearData=this._readData(a,mp4lib.fields.FIELD_UINT16),g.BytesOfEncryptedData=this._readData(a,mp4lib.fields.FIELD_UINT32),e.clearAndCryptedData.push(g)}}this.entry.push(e)}return this.localPos},mp4lib.boxes.PiffTrackEncryptionBox=function(a){mp4lib.boxes.FullBox.call(this,"tepiff",a,[137,116,219,206,123,231,76,81,132,249,113,72,249,136,37,84])},mp4lib.boxes.PiffTrackEncryptionBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.PiffTrackEncryptionBox.prototype.constructor=mp4lib.boxes.PiffTrackEncryptionBox,mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox=function(a){mp4lib.boxes.FullBox.call(this,"psshpiff",a,[208,138,79,24,16,243,74,130,182,200,50,216,171,161,131,211])},mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox.prototype.constructor=mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox,mp4lib.boxes.TfxdBox=function(a){mp4lib.boxes.FullBox.call(this,"tfxd",a,[109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178])},mp4lib.boxes.TfxdBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TfxdBox.prototype.constructor=mp4lib.boxes.TfxdBox,mp4lib.boxes.TfxdBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=1===this.version?2*mp4lib.fields.FIELD_UINT64.getLength():2*mp4lib.fields.FIELD_UINT32.getLength()},mp4lib.boxes.TfxdBox.prototype.write=function(a,b){return mp4lib.boxes.FullBox.prototype.write.call(this,a,b),1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.fragment_absolute_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.fragment_duration)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.fragment_absolute_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.fragment_duration)),this.localPos},mp4lib.boxes.TfxdBox.prototype.read=function(a,b,c){return mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),1===this.version?(this.fragment_absolute_time=this._readData(a,mp4lib.fields.FIELD_UINT64),this.fragment_duration=this._readData(a,mp4lib.fields.FIELD_UINT64)):(this.fragment_absolute_time=this._readData(a,mp4lib.fields.FIELD_UINT32),this.fragment_duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.localPos},mp4lib.boxes.TfrfBox=function(a){mp4lib.boxes.FullBox.call(this,"tfrf",a,[212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159])},mp4lib.boxes.TfrfBox.prototype=Object.create(mp4lib.boxes.FullBox.prototype),mp4lib.boxes.TfrfBox.prototype.constructor=mp4lib.boxes.TfrfBox,mp4lib.boxes.TfrfBox.prototype.computeLength=function(){mp4lib.boxes.FullBox.prototype.computeLength.call(this),this.size+=mp4lib.fields.FIELD_UINT8.getLength(),this.size+=1===this.version?2*mp4lib.fields.FIELD_UINT64.getLength()*this.fragment_count:2*mp4lib.fields.FIELD_UINT32.getLength()*this.fragment_count},mp4lib.boxes.TfrfBox.prototype.write=function(a,b){mp4lib.boxes.FullBox.prototype.write.call(this,a,b),this._writeData(a,mp4lib.fields.FIELD_UINT8,this.fragment_count);for(var c=0;c<this.fragment_count;c++)1===this.version?(this._writeData(a,mp4lib.fields.FIELD_UINT64,this.entry[c].fragment_absolute_time),this._writeData(a,mp4lib.fields.FIELD_UINT64,this.entry[c].fragment_duration)):(this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].fragment_absolute_time),this._writeData(a,mp4lib.fields.FIELD_UINT32,this.entry[c].fragment_duration));return this.localPos},mp4lib.boxes.TfrfBox.prototype.read=function(a,b,c){mp4lib.boxes.FullBox.prototype.read.call(this,a,b,c),this.fragment_count=this._readData(a,mp4lib.fields.FIELD_UINT8),this.entry=[];for(var d=0;d<this.fragment_count;d++){var e={};1===this.version?(e.fragment_absolute_time=this._readData(a,mp4lib.fields.FIELD_UINT64),e.fragment_duration=this._readData(a,mp4lib.fields.FIELD_UINT64)):(e.fragment_absolute_time=this._readData(a,mp4lib.fields.FIELD_UINT32),e.fragment_duration=this._readData(a,mp4lib.fields.FIELD_UINT32)),this.entry.push(e)}return this.localPos},mp4lib.registerTypeBoxes(),mp4lib.fields.readBytes=function(a,b,c){for(var d=0,e=0;c>e;e++)d<<=8,d+=a[b],b++;return d},mp4lib.fields.writeBytes=function(a,b,c,d){for(var e=0;c>e;e++)a[b+c-e-1]=255&d,d>>=8},mp4lib.fields.readString=function(a,b,c){for(var d="",e=b;b+c>e;e++)d+=String.fromCharCode(a[e]);return d},mp4lib.fields.NumberField=function(a,b){this.bits=a,this.signed=b},mp4lib.fields.NumberField.prototype.read=function(a,b){return mp4lib.fields.readBytes(a,b,this.bits/8)},mp4lib.fields.NumberField.prototype.write=function(a,b,c){mp4lib.fields.writeBytes(a,b,this.bits/8,c)},mp4lib.fields.NumberField.prototype.getLength=function(){return this.bits/8},mp4lib.fields.LongNumberField=function(){},mp4lib.fields.LongNumberField.prototype.read=function(a,b){var c=mp4lib.fields.readBytes(a,b,4),d=mp4lib.fields.readBytes(a,b+4,4);return goog.math.Long.fromBits(d,c).toNumber()},mp4lib.fields.LongNumberField.prototype.write=function(a,b,c){var d=goog.math.Long.fromNumber(c),e=d.getLowBits(),f=d.getHighBits();mp4lib.fields.writeBytes(a,b,4,f),mp4lib.fields.writeBytes(a,b+4,4,e)},mp4lib.fields.LongNumberField.prototype.getLength=function(){return 8},mp4lib.fields.FixedLenStringField=function(a){this.size=a},mp4lib.fields.FixedLenStringField.prototype.read=function(a,b){for(var c="",d=0;d<this.size;d++)c+=String.fromCharCode(a[b+d]);return c},mp4lib.fields.FixedLenStringField.prototype.write=function(a,b,c){for(var d=0;d<this.size;d++)a[b+d]=c.charCodeAt(d)},mp4lib.fields.FixedLenStringField.prototype.getLength=function(){return this.size},mp4lib.fields.BoxTypeField=function(){},mp4lib.fields.BoxTypeField.prototype.read=function(a,b){for(var c="",d=0;4>d;d++)c+=String.fromCharCode(a[b+d]);return c},mp4lib.fields.BoxTypeField.prototype.write=function(a,b,c){for(var d=0;4>d;d++)a[b+d]=c.charCodeAt(d)},mp4lib.fields.BoxTypeField.prototype.getLength=function(){return 4},mp4lib.fields.StringField=function(){},mp4lib.fields.StringField.prototype.read=function(a,b,c){for(var d="",e=b;c>e;e++)if(d+=String.fromCharCode(a[e]),0===a[e])return d;if(255>c-b&&a[0]==String.fromCharCode(c-b))return d=d.substr(1,c-b),mp4lib.warningHandler('null-terminated string expected, but found a string "'+d+'", which seems to be length-prefixed instead. Conversion done.'),d;throw new mp4lib.ParseException('expected null-terminated string, but end of field reached without termination. Read so far:"'+d+'"')},mp4lib.fields.StringField.prototype.write=function(a,b,c){for(var d=0;d<c.length;d++)a[b+d]=c.charCodeAt(d);a[b+c.length]=0},mp4lib.fields.StringField.prototype.getLength=function(a){return a.length},mp4lib.fields.ArrayField=function(a,b){this.innerField=a,this.size=b},mp4lib.fields.ArrayField.prototype.read=function(a,b){for(var c=-1,d=[],e=0;e<this.size;e++)d.push(this.innerField.read(a,b)),-1==c&&(c=this.innerField.getLength(d[e])),b+=c;return d},mp4lib.fields.FIELD_INT8=new mp4lib.fields.NumberField(8,!0),mp4lib.fields.FIELD_INT16=new mp4lib.fields.NumberField(16,!0),mp4lib.fields.FIELD_INT32=new mp4lib.fields.NumberField(32,!0),mp4lib.fields.FIELD_INT64=new mp4lib.fields.LongNumberField,mp4lib.fields.FIELD_UINT8=new mp4lib.fields.NumberField(8,!1),mp4lib.fields.FIELD_UINT16=new mp4lib.fields.NumberField(16,!1),mp4lib.fields.FIELD_UINT32=new mp4lib.fields.NumberField(32,!1),mp4lib.fields.FIELD_UINT64=new mp4lib.fields.LongNumberField,mp4lib.fields.FIELD_BIT8=new mp4lib.fields.NumberField(8,!1),mp4lib.fields.FIELD_BIT16=new mp4lib.fields.NumberField(16,!1),mp4lib.fields.FIELD_BIT24=new mp4lib.fields.NumberField(24,!1),mp4lib.fields.FIELD_BIT32=new mp4lib.fields.NumberField(32,!1),mp4lib.fields.FIELD_ID=new mp4lib.fields.BoxTypeField(4),mp4lib.fields.FIELD_STRING=new mp4lib.fields.StringField;var mpegts=function(){return{pes:{},si:{},binary:{},ts:{},Pts:{},aac:{},h264:{}}}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=mpegts:window.mpegts=mpegts,mpegts.ts.TsPacket=function(){this.m_cSync=null,this.m_bTransportError=null,this.m_bPUSI=null,this.m_bTransportPriority=null,this.m_nPID=null,this.m_cTransportScramblingCtrl=null,this.m_cAdaptationFieldCtrl=null,this.m_cContinuityCounter=null,this.m_pAdaptationField=null,this.m_payloadArray=null,this.m_cPayloadLength=null,this.m_bDirty=null,this.m_time=null,this.m_arrivalTime=null,this.m_bIgnored=null},mpegts.ts.TsPacket.prototype.parse=function(a){var b=0;if(this.m_cSync=a[b],this.m_cSync===this.SYNC_WORD){if(b++,this.m_bTransportError=mpegts.binary.getBitFromByte(a[b],0),this.m_bPUSI=mpegts.binary.getBitFromByte(a[b],1),this.m_bTransportPriority=mpegts.binary.getBitFromByte(a[b],2),this.m_nPID=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2),3,13),b+=2,this.m_cTransportScramblingCtrl=mpegts.binary.getValueFromByte(a[b],0,2),this.m_cAdaptationFieldCtrl=mpegts.binary.getValueFromByte(a[b],2,2),this.m_cContinuityCounter=mpegts.binary.getValueFromByte(a[b],4,4),b++,2&this.m_cAdaptationFieldCtrl){var c=a[b];if(c+b>=this.TS_PACKET_SIZE)return;this.m_pAdaptationField=new mpegts.ts.AdaptationField,this.m_pAdaptationField.parse(a.subarray(b)),b+=this.m_pAdaptationField.getLength()}0!==this.m_cAdaptationFieldCtrl&&1&this.m_cAdaptationFieldCtrl&&(this.m_cPayloadLength=this.TS_PACKET_SIZE-b,this.m_payloadArray=a.subarray(b,b+this.m_cPayloadLength))}},mpegts.ts.TsPacket.prototype.getPid=function(){return this.m_nPID},mpegts.ts.TsPacket.prototype.getPayload=function(){return this.m_payloadArray},mpegts.ts.TsPacket.prototype.getPayloadLength=function(){return this.m_cPayloadLength},mpegts.ts.TsPacket.prototype.getPusi=function(){return this.m_bPUSI},mpegts.ts.TsPacket.prototype.hasAdaptationFieldOnly=function(){return 2===this.m_cAdaptationFieldCtrl},mpegts.ts.TsPacket.prototype.SYNC_WORD=71,mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE=188,mpegts.ts.TsPacket.prototype.UNDEFINED_PID=65535,mpegts.ts.TsPacket.prototype.PAT_PID=0,mpegts.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_MAP=188,mpegts.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM=190,mpegts.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM=190,mpegts.ts.TsPacket.prototype.STREAM_ID_PRIVATE_STREAM_2=191,mpegts.ts.TsPacket.prototype.STREAM_ID_ECM_STREAM=240,mpegts.ts.TsPacket.prototype.STREAM_ID_EMM_STREAM=241,mpegts.ts.TsPacket.prototype.STREAM_ID_DSMCC_STREAM=242,mpegts.ts.TsPacket.prototype.STREAM_ID_H2221_TYPE_E_STREAM=248,mpegts.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_DIRECTORY=255,mpegts.binary.readBytes=function(a,b,c){for(var d=0,e=0;c>e;e++)d<<=8,d+=a[b],b++;return d},mpegts.binary.getBitFromByte=function(a,b){var c=0;return c+=1<<7-b,0!==(a&c)},mpegts.binary.getValueFrom3Bytes=function(a,b,c){"undefined"==typeof c&&(c=-1),"undefined"==typeof b&&(b=0);var d=-1==c?-1:c-(16-b),e=-1==c?0:8-d,f=mpegts.binary.getValueFromByte(a[0],b),g=mpegts.binary.getValueFromByte(a[1]),h=mpegts.binary.getValueFromByte(a[2],0,d,!1);return(f<<16&16711680|g<<8&65280|255&h)>>e},mpegts.binary.getValueFrom2Bytes=function(a,b,c){"undefined"==typeof c&&(c=-1),"undefined"==typeof b&&(b=0);var d=-1==c?-1:c-(8-b),e=-1==c?0:8-d,f=mpegts.binary.getValueFromByte(a[0],b),g=mpegts.binary.getValueFromByte(a[1],0,d,!1);return(f<<8&65280|255&g)>>e},mpegts.binary.getValueFromByte=function(a,b,c,d){var e=0,f=0;"undefined"==typeof c&&(c=-1),"undefined"==typeof b&&(b=0);var g=-1==c?7:b+c-1;for(f=b;g>=f;f++)e+=1<<7-f;var h=a&e;return(d||"undefined"==typeof d)&&(h>>=7-g),h},mpegts.pes.PesPacket=function(){this.m_cStreamID=null,this.m_nPESPacketLength=null,this.m_cPESScramblingCtrl=null,this.m_bPESpriority=null,this.m_bDataAlignement=null,this.m_bCopyright=null,this.m_bOriginalOrCopy=null,this.m_cPES_header_data_length=null,this.m_cPTS_DTS_flags=null,this.m_bESCR_flag=null,this.m_bES_rate_flag=null,this.m_bDSM_trick_mode_flag=null,this.m_bAdditional_copy_info_flag=null,
this.m_bPES_CRC_flag=null,this.m_bPES_extension_flag=null,this.m_pPTS=null,this.m_pDTS=null,this.m_pESCR=null,this.m_ES_rate=null,this.m_DSM_trick_mode=null,this.m_Additional_copy_info=null,this.m_PES_CRC=null,this.m_cNbStuffingBytes=null,this.m_pPESExtension=null,this.m_pPrivateData=null,this.m_payloadArray=null,this.m_nPayloadLength=null,this.m_bDirty=null,this.m_bValid=!1},mpegts.pes.PesPacket.prototype.parse=function(a){var b=0;this.m_nLength=a.length;var c=mpegts.binary.getValueFrom3Bytes(a.subarray(b,b+3));if(c===this.START_CODE_PREFIX){if(b=3,this.m_cStreamID=a[b],b++,this.m_nPESPacketLength=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2)),b+=2,this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM)return void(this.m_bValid=!0);if(!this.hasOptionalPESHeader())return this.m_payloadArray=a.subarray(b+mpegts.pes.PesPacket.prototype.FIXED_HEADER_LENGTH),this.m_nPayloadLength=this.m_nLength-mpegts.pes.PesPacket.prototype.FIXED_HEADER_LENGTH,void(this.m_bValid=!0);var d=mpegts.binary.getValueFromByte(a[b],0,2);if(2==d){this.m_cPESScramblingCtrl=mpegts.binary.getValueFromByte(a[b],2,2),this.m_bPESpriority=mpegts.binary.getBitFromByte(a[b],4),this.m_bDataAlignement=mpegts.binary.getBitFromByte(a[b],5),this.m_bCopyright=mpegts.binary.getBitFromByte(a[b],6),this.m_bOriginalOrCopy=mpegts.binary.getBitFromByte(a[b],7),b++,this.m_cPTS_DTS_flags=mpegts.binary.getValueFromByte(a[b],0,2),this.m_bESCR_flag=mpegts.binary.getBitFromByte(a[b],2),this.m_bES_rate_flag=mpegts.binary.getBitFromByte(a[b],3),this.m_bDSM_trick_mode_flag=mpegts.binary.getBitFromByte(a[b],4),this.m_bAdditional_copy_info_flag=mpegts.binary.getBitFromByte(a[b],5),this.m_bPES_CRC_flag=mpegts.binary.getBitFromByte(a[b],6),this.m_bPES_extension_flag=mpegts.binary.getBitFromByte(a[b],7),b++,this.m_cPES_header_data_length=255&a[b],b++,(this.m_cPTS_DTS_flags&mpegts.pes.PesPacket.prototype.FLAG_PTS)==mpegts.pes.PesPacket.prototype.FLAG_PTS&&(this.m_pPTS=new mpegts.Pts(a.subarray(b,b+5)),b+=5),(this.m_cPTS_DTS_flags&mpegts.pes.PesPacket.prototype.FLAG_DTS)==mpegts.pes.PesPacket.prototype.FLAG_DTS&&(this.m_pDTS=new mpegts.Pts(a.subarray(b,b+5)),b+=5),this.m_bESCR_flag&&(b+=6),this.m_bES_rate_flag&&(this.m_ES_rate=mpegts.binary.getValueFrom3Bytes(a.subarray(b,b+3),1,22),b+=3),this.m_bDSM_trick_mode_flag&&(this.m_DSM_trick_mode=a[b],b++),this.m_bAdditional_copy_info_flag&&(this.m_Additional_copy_info=a[b],b++),this.m_bPES_CRC_flag&&(this.m_PES_CRC=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2)),b+=2),this.m_bPES_extension_flag;var e=mpegts.pes.PesPacket.prototype.FIXED_HEADER_LENGTH+mpegts.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH+this.m_cPES_header_data_length;this.m_cNbStuffingBytes=e-b,b+=this.m_cNbStuffingBytes,this.m_nPayloadLength=this.m_nLength-e,this.m_payloadArray=a.subarray(e,e+this.m_nPayloadLength),this.m_bValid=!0}}},mpegts.pes.PesPacket.prototype.hasOptionalPESHeader=function(){return this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_MAP||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_PRIVATE_STREAM_2||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_ECM_STREAM||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_EMM_STREAM||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_DIRECTORY||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_DSMCC_STREAM||this.m_cStreamID===mpegts.ts.TsPacket.prototype.STREAM_ID_H2221_TYPE_E_STREAM?!1:!0},mpegts.pes.PesPacket.prototype.getHeaderLength=function(){return mpegts.pes.PesPacket.prototype.FIXED_HEADER_LENGTH+mpegts.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH+this.m_cPES_header_data_length},mpegts.pes.PesPacket.prototype.getPayload=function(){return this.m_payloadArray},mpegts.pes.PesPacket.prototype.getPts=function(){return this.m_pPTS},mpegts.pes.PesPacket.prototype.getDts=function(){return this.m_pDTS},mpegts.pes.PesPacket.prototype.START_CODE_PREFIX=1,mpegts.pes.PesPacket.prototype.FIXED_HEADER_LENGTH=6,mpegts.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH=3,mpegts.pes.PesPacket.prototype.FLAG_DTS=1,mpegts.pes.PesPacket.prototype.FLAG_PTS=2,mpegts.si.PSISection=function(a){this.m_table_id=a,this.m_section_syntax_indicator=1,this.m_section_length=mpegts.si.PSISection.prototype.SECTION_LENGTH,this.m_transport_stream_id=0,this.m_version_number=0,this.m_current_next_indicator=!0,this.m_section_number=0,this.m_last_section_number=0,this.m_bValid=null},mpegts.si.PSISection.prototype.parse=function(a){this.m_bValid=!1;var b=0,c=a[b];return b=0===c?b+1:b+c,this.m_table_id=a[b],b++,this.m_section_syntax_indicator=mpegts.binary.getBitFromByte(a[b],0),this.m_section_length=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2),4),b+=2,this.m_transport_stream_id=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2)),b+=2,this.m_version_number=mpegts.binary.getValueFromByte(a[b],2,5),this.m_current_next_indicator=mpegts.binary.getBitFromByte(a[b],7),b++,this.m_section_number=a[b],b++,this.m_last_section_number=a[b],this.m_bValid=!0,b},mpegts.si.PSISection.prototype.getSectionLength=function(){return this.m_section_length},mpegts.si.PSISection.prototype.SECTION_LENGTH=9,mpegts.si.PSISection.prototype.HEADER_LENGTH=8,mpegts.ts.AdaptationField=function(){this.m_cAFLength=null,this.m_bDiscontinuityInd=null,this.m_bRAI=null,this.m_bESPriority=null,this.m_bPCRFlag=null,this.m_bOPCRFlag=null,this.m_bSplicingPointFlag=null,this.m_bPrivateDataFlag=null,this.m_bAdaptationFieldExtFlag=null},mpegts.ts.AdaptationField.prototype.getLength=function(){return this.m_cAFLength+1},mpegts.ts.AdaptationField.prototype.parse=function(a){if(this.m_cAFLength=a[0],0!==this.m_cAFLength){var b=1;this.m_bDiscontinuityInd=mpegts.binary.getBitFromByte(a[b],0),this.m_bRAI=mpegts.binary.getBitFromByte(a[b],1),this.m_bESPriority=mpegts.binary.getBitFromByte(a[b],2),this.m_bPCRFlag=mpegts.binary.getBitFromByte(a[b],3),this.m_bOPCRFlag=mpegts.binary.getBitFromByte(a[b],4),this.m_bSplicingPointFlag=mpegts.binary.getBitFromByte(a[b],5),this.m_bPrivateDataFlag=mpegts.binary.getBitFromByte(a[b],6),this.m_bAdaptationFieldExtFlag=mpegts.binary.getBitFromByte(a[b],7)}},mpegts.Pts=function(a){var b,c,d=a[0]>>1&7;c=d>>2,b=(3&d)<<30>>>0;var e=a[1];b=(b|e<<22)>>>0;var f=a[2]>>1;b=(b|f<<15)>>>0;var g=a[3];b=(b|g<<7)>>>0;var h=a[4]>>1;b=(b|h)>>>0,this.m_lPTS=goog.math.Long.fromBits(b,c).toNumber(),this.m_fPTS=this.m_lPTS/mpegts.Pts.prototype.SYSTEM_CLOCK_FREQUENCY},mpegts.Pts.prototype.getValue=function(){return this.m_lPTS},mpegts.Pts.prototype.getValueInSeconds=function(){return this.m_fPTS},mpegts.Pts.prototype.SYSTEM_CLOCK_FREQUENCY=9e4,mpegts.si.PAT=function(){mpegts.si.PSISection.call(this,mpegts.si.PAT.prototype.TABLE_ID),this.m_listOfProgramAssociation=[],this.m_network_pid=null},mpegts.si.PAT.prototype=Object.create(mpegts.si.PSISection.prototype),mpegts.si.PAT.prototype.constructor=mpegts.si.PAT,mpegts.si.PAT.prototype.parse=function(a){var b=mpegts.si.PSISection.prototype.parse.call(this,a);if(b++,this.m_bValid&&(this.m_bValid=!1,this.m_table_id==this.TABLE_ID)){for(var c=this.getSectionLength()-this.SECTION_LENGTH;c>=4;){var d=new mpegts.si.ProgramAssociation(a.subarray(b,b+4));0===d.getProgramNumber()?this.m_network_pid=d.getProgramMapPid():this.m_listOfProgramAssociation.push(d),c-=4,b+=4}this.m_bValid=!0}},mpegts.si.PAT.prototype.getPmtPid=function(){var a=mpegts.ts.TsPacket.prototype.UNDEFINED_PID;if(this.m_listOfProgramAssociation.length>=1){var b=this.m_listOfProgramAssociation[0];a=b.getProgramMapPid()}return a},mpegts.si.PAT.prototype.TABLE_ID=0,mpegts.si.PAT.prototype.PID=0,mpegts.si.ProgramAssociation=function(a){this.m_program_number=0,this.m_program_map_pid=0,this.parse(a)},mpegts.si.ProgramAssociation.prototype.getProgramNumber=function(){return this.m_program_number},mpegts.si.ProgramAssociation.prototype.getProgramMapPid=function(){return this.m_program_map_pid},mpegts.si.ProgramAssociation.prototype.getLength=function(){return 4},mpegts.si.ProgramAssociation.prototype.parse=function(a){this.m_program_number=mpegts.binary.getValueFrom2Bytes(a.subarray(0,2)),this.m_program_map_pid=mpegts.binary.getValueFrom2Bytes(a.subarray(2,4),3,13)},mpegts.si.PMT=function(){mpegts.si.PSISection.call(this,mpegts.si.PMT.prototype.TABLE_ID),this.m_listOfComponents=[],this.m_PCR_PID=null,this.m_program_info_length=null},mpegts.si.PMT.prototype=Object.create(mpegts.si.PSISection.prototype),mpegts.si.PMT.prototype.constructor=mpegts.si.PMT,mpegts.si.PMT.prototype.parse=function(a){var b=mpegts.si.PSISection.prototype.parse.call(this,a);if(b++,this.m_bValid&&(this.m_bValid=!1,this.m_table_id==this.TABLE_ID)){var c=this.getSectionLength()-this.SECTION_LENGTH;if(!(4>c)){this.m_PCR_PID=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2),3),b+=2,this.m_program_info_length=mpegts.binary.getValueFrom2Bytes(a.subarray(b,b+2),4),b+=2,b+=this.m_program_info_length,c=this.m_section_length-this.SECTION_LENGTH-4-this.m_program_info_length;for(var d=null;c>0;)d=new mpegts.si.ESDescription(a.subarray(b,b+c)),this.m_listOfComponents.push(d),c-=d.getLength(),b+=d.getLength();this.m_bValid=!0}}},mpegts.si.PMT.prototype.TABLE_ID=2,mpegts.si.PMT.prototype.gStreamTypes=[{name:"Reserved",value:0,desc:"ITU-T | ISO/IEC Reserved"},{name:"MPEG1-Video",value:224,desc:"ISO/IEC 11172-2 Video"},{name:"MPEG2-Video",value:224,desc:"ITU-T Rec. H.262 | ISO/IEC 13818-2 Video or ISO/IEC 11172-2 constrained parameter video stream"},{name:"MPEG1-Audio",value:192,desc:"ISO/IEC 11172-3 Audio"},{name:"MPEG2-Audio",value:192,desc:"ISO/IEC 13818-3 Audio"},{name:"PRIVATE_SECTIONS",value:189,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 private_sections"},{name:"PRIVATE",value:189,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 PES packets containing private data"},{name:"MHEG",value:243,desc:"ISO/IEC 13522 MHEG"},{name:"MPEG1-DSM-CC",value:242,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 Annex A DSM-CC"},{name:"H.222.1",value:244,desc:"ITU-T Rec. H.222.1"},{name:"DSM-CC_A",value:244,desc:"ISO/IEC 13818-6 type A"},{name:"DSM-CC_B",value:245,desc:"ISO/IEC 13818-6 type B"},{name:"DSM-CC_C",value:246,desc:"ISO/IEC 13818-6 type C"},{name:"DSM-CC_D",value:247,desc:"ISO/IEC 13818-6 type D"},{name:"Auxiliary",value:0,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 auxiliary"},{name:"MPEG2-AAC-ADTS",value:192,desc:"ISO/IEC 13818-7 Audio with ADTS transport syntax"},{name:"MPEG4-Video",value:224,desc:"ISO/IEC 14496-2 Visual"},{name:"MPEG4-AAC-LATM",value:192,desc:"ISO/IEC 14496-3 Audio with the LATM transport syntax as defined in ISO/IEC 14496-3/AMD-1"},{name:"MPEG4-SL",value:250,desc:"ISO/IEC 14496-1 SL-packetized stream or FlexMux stream carried in PES packets"},{name:"MPEG4-SL",value:250,desc:"ISO/IEC 14496-1 SL-packetized stream or FlexMux stream carried in ISO/IEC14496_sections"},{name:"DSM-CC_SDP",value:0,desc:"ISO/IEC 13818-6 Synchronized Download Protocol"},{name:"META_PES",value:252,desc:"Metadata carried in PES packets"},{name:"META_SECTIONS",value:252,desc:"Metadata carried in metadata_sections"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Data Carousel"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Object Carousel"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Synchronized Download Protocol"},{name:"MPEG2-IPMP",value:0,desc:"IPMP stream (defined in ISO/IEC 13818-11, MPEG-2 IPMP)"},{name:"H.264",value:224,desc:"AVC video stream as defined in ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"MPEG4AAC",value:192,desc:"ISO/IEC 14496-3 Audio, without using any additional transport syntax, such as DST, ALS and SLS"},{name:"MPEG4Text",value:0,desc:"ISO/IEC 14496-17 Text"},{name:"Aux. Video (23002-3)",value:30,desc:"Auxiliary video stream as defined in ISO/IEC 23002-3"},{name:"H.264-SVC",value:224,desc:"SVC video sub-bitstream of a video stream as defined in the Annex G of ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"H.264-MVC",value:224,desc:"MVC video sub-bitstream of a video stream as defined in the Annex H of ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"Reserved1",value:0,desc:"TBC Reserved"},{name:"Reserved2",value:0,desc:"TBC Reserved"},{name:"Reserved3",value:0,desc:"TBC Reserved"},{name:"HEVC",value:224,desc:"ITU.-T Rec H.26x | ISO/IEC 23008-2 video stream"}],mpegts.si.PMT.prototype.MPEG2_VIDEO_STREAM_TYPE=2,mpegts.si.PMT.prototype.AVC_VIDEO_STREAM_TYPE=27,mpegts.si.PMT.prototype.MPEG1_AUDIO_STREAM_TYPE=3,mpegts.si.PMT.prototype.MPEG2_AUDIO_STREAM_TYPE=4,mpegts.si.PMT.prototype.AAC_AUDIO_STREAM_TYPE=17,mpegts.si.PMT.prototype.AC3_AUDIO_STREAM_TYPE=6,mpegts.si.PMT.prototype.SUB_STREAM_TYPE=6,mpegts.si.PMT.prototype.STREAM_TYPE_MP1V=1,mpegts.si.PMT.prototype.STREAM_TYPE_MP2V=2,mpegts.si.PMT.prototype.STREAM_TYPE_MP1A=3,mpegts.si.PMT.prototype.STREAM_TYPE_MP2A=4,mpegts.si.PMT.prototype.STREAM_TYPE_PRIVATE=6,mpegts.si.PMT.prototype.STREAM_TYPE_TELETEXT=6,mpegts.si.PMT.prototype.STREAM_TYPE_DVBSUBTITLE=6,mpegts.si.PMT.prototype.STREAM_TYPE_AC3=6,mpegts.si.PMT.prototype.STREAM_TYPE_MP2AAC_ADTS=15,mpegts.si.PMT.prototype.STREAM_TYPE_MP4AAC_LATM=17,mpegts.si.PMT.prototype.STREAM_TYPE_H264=27,mpegts.si.PMT.prototype.STREAM_TYPE_MP4AAC=28,mpegts.si.PMT.prototype.STREAM_TYPE_AUX_23002_3=30,mpegts.si.PMT.prototype.STREAM_TYPE_SVC=31,mpegts.si.PMT.prototype.STREAM_TYPE_MVC=32,mpegts.si.PMT.prototype.STREAM_TYPE_HEVC=36,mpegts.si.ESDescription=function(a){this.m_stream_type=null,this.m_elementary_PID=null,this.m_ES_info_length=null,this.parse(a)},mpegts.si.ESDescription.prototype.getStreamType=function(){return this.m_stream_type},mpegts.si.ESDescription.prototype.getPID=function(){return this.m_elementary_PID},mpegts.si.ESDescription.prototype.getLength=function(){return 5+this.m_ES_info_length},mpegts.si.ESDescription.prototype.parse=function(a){this.m_stream_type=a[0],this.m_elementary_PID=mpegts.binary.getValueFrom2Bytes(a.subarray(1,3),3),this.m_ES_info_length=mpegts.binary.getValueFrom2Bytes(a.subarray(3,5),4)},mpegts.aac.SAMPLING_FREQUENCY=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],mpegts.aac.getAudioSpecificConfig=function(a){var b=mpegts.binary.getValueFromByte(a[2],0,2),c=mpegts.binary.getValueFromByte(a[2],2,4),d=mpegts.binary.getValueFrom2Bytes(a.subarray(2,5),7,3),e=new Uint8Array(2);return e[0]=b+1<<3,e[0]|=(14&c)>>1,e[1]|=(1&c)<<7,e[1]|=d<<3,e},mpegts.aac.parseADTS=function(a){for(var b,c,d=[],e={},f=0;f<a.length;)c=f,e.syncword=(a[f]<<4)+((240&a[f+1])>>4),e.protection_absent=1&a[f+1],e.sampling_frequency_index=(60&a[f+2])>>2,e.channel_configuration=((1&a[f+2])<<1)+((192&a[f+3])>>6),e.aac_frame_length=((3&a[f+3])<<11)+(a[f+4]<<3)+((224&a[f+5])>>5),e.number_of_raw_data_blocks_in_frame=(3&a[f+6])>>2,f+=7,0===e.number_of_raw_data_blocks_in_frame&&(0===e.protection_absent&&(f+=2),b={},b.offset=f,b.length=e.aac_frame_length-(f-c),d.push(b),f+=b.length);return d},mpegts.h264.getSequenceHeader=function(a){for(var b,c=-1,d=-1,e=0,f=null,g=0,h=0;e<a.length;)if(0===a[e]&&0===a[e+1]&&0===a[e+2]&&1===a[e+3]){if(b=31&a[e+4],b>=mpegts.h264.NALUTYPE_SPS&&b<=mpegts.h264.NALUTYPE_PPS){if(-1===c&&(c=e),b===mpegts.h264.NALUTYPE_SPS){var i=mpegts.h264.parseSPS(a.subarray(e+5));g=i.pic_width_in_mbs_minus1+1<<4,h=i.pic_height_in_map_units_minus1+1<<4}}else c>0&&(d=e-c);if(b===mpegts.h264.NALUTYPE_IDR||b===mpegts.h264.NALUTYPE_NONIDR)break;e+=4}else{if(0===a[e]&&0===a[e+1]&&1===a[e+2]){c>0&&(d=e-c);break}e++}return-1===c||-1===d?null:(f=new Uint8Array(d),f.set(a.subarray(c,c+d)),{bytes:f,width:g,height:h})},mpegts.h264.read_ue=function(a,b){var c=1,d=0,e=0;for(b._bit=b._byte>>b._bitPos&1,b._bitPos--,b._bitPos<0&&(b._byte=a[b._bytePos],b._bytePos++,b._bitPos=7);0===b._bit;)e++,c<<=1,b._bit=b._byte>>b._bitPos&1,b._bitPos--,b._bitPos<0&&(b._byte=a[b._bytePos],b._bytePos++,b._bitPos=7);if(c-=1,d=0,e)for(;e>0;)b._bit=b._byte>>b._bitPos&1,b._bitPos--,d=(d<<1)+b._bit,e--,b._bitPos<0&&(b._byte=a[b._bytePos],b._bytePos++,b._bitPos=7);return c+=d},mpegts.h264.read_flag=function(a,b){var c=0;return b._bit=b._byte>>b._bitPos&1,b._bitPos--,b._bitPos<0&&(b._byte=a[b._bytePos],b._bytePos++,b._bitPos=7),c=b._bit},mpegts.h264.parseSPS=function(a){var b={profile_idc:0,constraint_set0_flag:0,constraint_set1_flag:0,constraint_set2_flag:0,constraint_set3_flag:0,level_idc:0,seq_parameter_set_id:0,chroma_format_idc:0,separate_colour_plane_flag:0,bit_depth_luma_minus8:0,bit_depth_chroma_minus8:0,qpprime_y_zero_transform_bypass_flag:0,seq_scaling_matrix_present_flag:0,log2_max_frame_num_minus4:0,pic_order_cnt_type:0,log2_max_pic_order_cnt_lsb_minus4:0,num_ref_frames:0,gaps_in_frame_num_value_allowed_flag:0,pic_width_in_mbs_minus1:0,pic_height_in_map_units_minus1:0},c={_byte:0,_bit:0,_bytePos:0,_bitPos:0};return c._bytePos=c._bitPos=0,c._byte=a[c._bytePos],c._bytePos++,b.profile_idc=c._byte,c._byte=a[c._bytePos],c._bytePos++,b.constraint_set0_flag=(128&c._byte)>>7,b.constraint_set1_flag=(64&c._byte)>>6,b.constraint_set2_flag=(32&c._byte)>>5,b.constraint_set3_flag=(16&c._byte)>>4,c._byte=a[c._bytePos],c._bytePos++,b.level_idc=c._byte,c._bitPos=7,b.seq_parameter_set_id=mpegts.h264.read_ue(a,c),(100==b.profileIdc||110==b.profileIdc||122==b.profileIdc||244==b.profileIdc||44==b.profileIdc||83==b.profileIdc||86==b.profileIdc)&&(b.chroma_format_idc=mpegts.h264.read_ue(a,c),3===b.chroma_format_idc&&(b.separate_colour_plane_flag=mpegts.h264.read_flag(a,c)),b.bit_depth_luma_minus8=mpegts.h264.read_ue(a,c),b.bit_depth_chroma_minus8=mpegts.h264.read_ue(a,c),b.qpprime_y_zero_transform_bypass_flag=mpegts.h264.read_flag(a,c),b.seq_scaling_matrix_present_flag=mpegts.h264.read_flag(a,c),1===b.seq_scaling_matrix_present_flag),b.log2_max_frame_num_minus4=mpegts.h264.read_ue(a,c),b.pic_order_cnt_type=mpegts.h264.read_ue(a,c),0===b.pic_order_cnt_type?b.log2_max_pic_order_cnt_lsb_minus4=mpegts.h264.read_ue(a,c):1===b.pic_order_cnt_type,b.num_ref_frames=mpegts.h264.read_ue(a,c),b.gaps_in_frame_num_value_allowed_flag=mpegts.h264.read_flag(a,c),b.pic_width_in_mbs_minus1=mpegts.h264.read_ue(a,c),b.pic_height_in_map_units_minus1=mpegts.h264.read_ue(a,c),b},mpegts.h264.bytestreamToMp4=function(a){for(var b=0,c=a.length,d=-1,e=0;c>b;)0===a[b]&&0===a[b+1]&&0===a[b+2]&&1===a[b+3]?(d>=0&&(e=b-d-4,a[d]=(4278190080&e)>>24,a[d+1]=(16711680&e)>>16,a[d+2]=(65280&e)>>8,a[d+3]=255&e),d=b,b+=4):b++;e=b-d-4,a[d]=(4278190080&e)>>24,a[d+1]=(16711680&e)>>16,a[d+2]=(65280&e)>>8,a[d+3]=255&e},mpegts.h264.NALUTYPE_NONIDR=1,mpegts.h264.NALUTYPE_IDR=5,mpegts.h264.NALUTYPE_SEI=6,mpegts.h264.NALUTYPE_SPS=7,mpegts.h264.NALUTYPE_PPS=8,mpegts.h264.NALUTYPE_AU_DELIMITER=9,MediaPlayer=function(a){"use strict";var b,c,d,e,f,g="1.2.0",h="1.2.0",i="6271a9b",j="1.7.2015_17:24:2",k=a,l=null,m=!1,n=!1,o=!0,p=!1,q=MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED,r=function(){return!!c&&!!d},s=function(){return m?this.capabilities.supportsMediaSource()?c&&d?(n=!0,e||(e=b.getObject("streamController"),e.setVideoModel(f),e.setAutoPlay(o)),e.load(d,l),b.mapValue("scheduleWhilePaused",p),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","bufferController"),b.mapValue("bufferMax",q),void b.injectInto(this.bufferExt,"bufferMax")):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR,"Missing view or source."):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIASOURCE):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR,"MediaPlayer not initialized!")},t=function(){r()&&s.call(this)},u=function(){var a=this.metricsModel.getReadOnlyMetricsFor("video")||this.metricsModel.getReadOnlyMetricsFor("audio");return this.metricsExt.getCurrentDVRInfo(a)},v=function(){return u.call(this).mpd.timeShiftBufferDepth},w=function(a){var b=u.call(this),c=b.range.start+parseInt(a,10);return c>b.range.end&&(c=b.range.end),c},x=function(a){f.getElement().currentTime=this.getDVRSeekOffset(a)},y=function(){var a=u.call(this);return null===a?0:Math.round(this.duration()-(a.range.end-a.time))},z=function(){var a,b=u.call(this);return null===b?0:(a=b.range.end-b.range.start,Math.round(a<b.mpd.timeShiftBufferDepth?a:b.mpd.timeShiftBufferDepth))},A=function(){var a,b,c=u.call(this);return null===c?0:(a=c.mpd.availabilityStartTime.getTime()/1e3,b=this.time()+(a+c.range.start),Math.round(b))},B=function(){var a,b,c=u.call(this);return null===c?0:(a=c.mpd.availabilityStartTime.getTime()/1e3,b=a+c.range.start+this.duration(),Math.round(b))},C=function(a,b,c){var d=new Date(1e3*a),e=d.toLocaleDateString(b),f=d.toLocaleTimeString(b,{hour12:c});return f+" "+e},D=function(a){a=Math.max(a,0);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b.toString()+":":b.toString()+":")+(10>c?"0"+c.toString():c.toString())+":"+(10>d?"0"+d.toString():d.toString())};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(k),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,abrController:void 0,metricsModel:void 0,metricsExt:void 0,bufferExt:void 0,errHandler:void 0,tokenAuthentication:void 0,uriQueryFragModel:void 0,config:void 0,addEventListener:function(a,b,c){if(!m)throw"MediaPlayer not initialized!";this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return g},getVersionHAS:function(){return h},getVersionFull:function(){return-1===i.indexOf("@@")?h+"_"+i:h},getBuildDate:function(){return-1===j.indexOf("@@")?j:"Not a builded version"},startup:function(){m||(b.injectInto(this),m=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return f},setAutoPlay:function(a){o=a},getAutoPlay:function(){return o},setScheduleWhilePaused:function(a){p=a},getScheduleWhilePaused:function(){return p},setTokenAuthentication:function(a,b){this.tokenAuthentication.setTokenAuthentication({name:a,type:b})},setBufferMax:function(a){q=a},getBufferMax:function(){return q},getMetricsExt:function(){return this.metricsExt},getMetricsFor:function(a){var b=this.metricsModel.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return this.abrController.getQualityFor(a)},setQualityFor:function(a,b){this.abrController.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return this.abrController.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){this.abrController.setAutoSwitchBitrate(a)},setConfig:function(a){this.config&&a&&(this.config.setParams(a),this.debug.setLevel(this.config.getParam("Debug.level","number",this.debug.ALL)))},setAudioTrack:function(a){e.setAudioTrack(a)},getAudioTracks:function(){return e.getAudioTracks()},setSubtitleTrack:function(a){e.setSubtitleTrack(a)},getSubtitleTracks:function(){return e.getSubtitleTracks()},attachView:function(a){return m?(c=a,f=null,c&&(f=b.getObject("videoModel"),f.setElement(c)),n&&e&&(e.reset(),n=!1),void(r.call(this)&&t.call(this))):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR,"MediaPlayer not initialized!")},attachSource:function(a,b){var c,f;return m?(f=this.getVideoModel())?(c=f.getElement().loop,this.metricsModel.addSession(null,a,c,null,"HasPlayer.js_"+this.getVersionHAS()),this.uriQueryFragModel.reset(),d=a?this.uriQueryFragModel.parseURI(a):null,l=b,n&&e&&(e.reset(),n=!1),void(r.call(this)&&t.call(this))):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR,"videoModel not initialized"):void this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR,"MediaPlayer not initialized!")},reset:function(){this.attachSource(null),l=null},play:s,isReady:r,seek:x,time:y,duration:z,timeAsUTC:A,durationAsUTC:B,getDVRWindowSize:v,getDVRSeekOffset:w,formatUTC:C,convertToTimeCode:D}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.dependencies.protection={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.modules={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.vo.protection={},MediaPlayer.rules={},MediaPlayer.rules.o={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";var a=function(){var a=document.createElement("video"),b=this.system.getObject("debug");MediaPlayer.models.ProtectionModel_21Jan2015.detect(a)?(this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015),b.log("Load ProtectionModel 21Jan2015")):MediaPlayer.models.ProtectionModel_3Feb2014.detect(a)?(this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014),b.log("Load ProtectionModel 3Feb2014")):MediaPlayer.models.ProtectionModel_01b.detect(a)?(this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b),b.log("Load ProtectionModel 01b")):(b.log("No supported version of EME detected on this user agent!"),b.log("Attempts to play encrypted content will fail!"))};return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("tokenAuthentication",MediaPlayer.utils.TokenAuthentication),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady),this.system.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine),this.system.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("textTTMLXMLMP4SourceBuffer",MediaPlayer.dependencies.TextTTMLXMLMP4SourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("bufferExt",MediaPlayer.dependencies.BufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),a.call(this),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapClass("abrRulesCollection",MediaPlayer.rules.BaseRulesCollection),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("requestScheduler",MediaPlayer.dependencies.RequestScheduler),this.system.mapSingleton("schedulerExt",MediaPlayer.dependencies.SchedulerExtensions),this.system.mapClass("schedulerModel",MediaPlayer.dependencies.SchedulerModel),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapClass("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapClass("parser",MediaPlayer.dependencies.Parser),this.system.mapClass("dashParser",Dash.dependencies.DashParser),this.system.mapClass("mssParser",Mss.dependencies.MssParser),this.system.mapClass("hlsParser",Hls.dependencies.HlsParser),this.system.mapClass("hlsDemux",Hls.dependencies.HlsDemux),this.system.mapSingleton("contextManager",MediaPlayer.modules.ContextManager),this.system.mapSingleton("metricsExt",MediaPlayer.dependencies.MetricsExtensions),this.system.mapSingleton("config",MediaPlayer.utils.Config),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.o.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.o.InsufficientBufferRule),this.system.mapHandler("setContext","contextManager","setContext")}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,sendError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",event:{code:a,message:b,data:c}})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.dependencies.ErrorHandler.prototype.HASPLAYER_INIT_ERROR="HASPLAYER_INIT_ERROR",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_ABORTED="MEDIA_ERR_ABORTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_NETWORK="MEDIA_ERR_NETWORK",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_DECODE="MEDIA_ERR_DECODE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED="MEDIA_ERR_SRC_NOT_SUPPORTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED="MEDIA_ERR_ENCRYPTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_REMOVE_SOURCEBUFFER="MEDIA_ERR_REMOVE_SOURCEBUFFER",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER="MEDIA_ERR_CREATE_SOURCEBUFFER",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_APPEND_SOURCEBUFFER="MEDIA_ERR_APPEND_SOURCEBUFFER",MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_CODEC="MANIFEST_ERR_CODEC",MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE="MANIFEST_ERR_PARSE",MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NOSTREAM="MANIFEST_ERR_NOSTREAM",MediaPlayer.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIASOURCE="CAPABILITY_ERR_MEDIASOURCE",MediaPlayer.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIAKEYS="CAPABILITY_ERR_MEDIAKEYS",MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST="DOWNLOAD_ERR_MANIFEST",MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX="DOWNLOAD_ERR_SIDX",MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT="DOWNLOAD_ERR_CONTENT",MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_INIT="DOWNLOAD_ERR_INIT",MediaPlayer.dependencies.ErrorHandler.prototype.CC_ERR_PARSE="CC_ERR_PARSE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR="MEDIA_KEYERR",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN="MEDIA_KEYERR_UNKNOWN",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_CLIENT="MEDIA_KEYERR_CLIENT",
MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVICE="MEDIA_KEYERR_SERVICE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT="MEDIA_KEYERR_OUTPUT",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_HARDWARECHANGE="MEDIA_KEYERR_HARDWARECHANGE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_DOMAIN="MEDIA_KEYERR_DOMAIN",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_UNSUPPORTED="MEDIA_KEYSYSERR_UNSUPPORTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED="MEDIA_KEYSYSERR_ACCESS_DENIED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_UPDATE_CERTIFICATE_IMPOSSIBLE="MEDIA_KEYSYSERR_UPDATE_CERTIFICATE_IMPOSSIBLE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR="MEDIA_KEYMESSERR",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_INVALID_HEADER="MEDIA_KEYMESSERR_INVALID_HEADER",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN="MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NOCHALLENGE="MEDIA_KEYMESSERR_NOCHALLENGE",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ABORTED="MEDIA_KEYMESSERR_XHR_ABORTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR="MEDIA_KEYMESSERR_XHR_ERROR",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_KEY_UNKNOWN="MEDIA_KEYMESSERR_KEY_UNKNOWN",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_MULTIKEYS_UNSUPPORTED="MEDIA_KEYMESSERR_MULTIKEYS_UNSUPPORTED",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION="MEDIA_KEYMESSERR_NO_SESSION",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_REMOVE_SESSION="MEDIA_KEYMESSERR_NO_REMOVE_SESSION",MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_CLOSE_SESSION="MEDIA_KEYMESSERR_NO_CLOSE_SESSION",MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INDEX_SIZE=1,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_HIERARCHY_REQUEST=3,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_WRONG_DOCUMENT=4,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_CHARACTER=5,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_NO_MODIFICATION_ALLOWED=7,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_NOT_FOUND=8,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_NOT_SUPPORTED=9,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_STATE=11,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_SYNTAX=12,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_MODIFICATION=13,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_NAMESPACE=14,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_ACCESS=15,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_SECURITY=18,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_NETWORK=19,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_ABORT=20,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_URL_MISMATCH=21,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_QUOTA_EXCEEDED=22,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_TIMEOUT=23,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_NODE_TYPE=24,MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_DATA_CLONE=25,MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,system:void 0,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var c=a.canPlayType(b);return"probably"===c||"maybe"===c}},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.utils.Debug=function(){"use strict";Date.prototype.HHMMSSmmm=function(){var a=this.getHours().toString(),b=this.getMinutes().toString(),c=this.getSeconds().toString(),d=this.getMilliseconds().toString(),e=a[1]?a:"0"+a[0],f=b[1]?b:"0"+b[0],g=c[1]?c:"0"+c[0],h=d[2]?d:"0"+(d[1]?d:"0"+d[0]);return e+":"+f+":"+g+"."+h},Date.prototype.MMSSmmm=function(){var a=this.getMinutes().toString(),b=this.getSeconds().toString(),c=this.getMilliseconds().toString(),d=a[1]?a:"0"+a[0],e=b[1]?b:"0"+b[0],f=c[2]?c:"0"+(c[1]?c:"0"+c[0]);return d+":"+e+"."+f};var a=!0,b=0,c=1,d=2,e=3,f=4,g=4,h=4,i=!0,j=!1,k=new Date,l=function(a,b){var g=this;if(m()&&a<=n()){var h=o(),l="",p=null;switch((void 0===h||null===h)&&(h=console),i&&(p=new Date,l+="["+p.HHMMSSmmm()+"]"),j&&(l+="["+new Date(p-k).MMSSmmm()+"]"),Array.apply(null,b).forEach(function(a){l+=a+" "}),a){case c:h.error(l);break;case d:h.warn(l);break;case e:h.info(l);break;case f:h.debug(l)}}g.eventBus.dispatchEvent({type:"log",message:arguments[0]})},m=function(){return a},n=function(){return h},o=function(){var a=null;if(a&&!a.initialized){var b=new log4javascript.PopUpAppender,c=new log4javascript.PatternLayout("%d{HH:mm:ss.SSS} %-5p - %m%n");b.setLayout(c),a.addAppender(b),a.setLevel(log4javascript.Level.ALL),a.initialized=!0}return a};return{eventBus:void 0,NONE:b,ERROR:c,WARN:d,INFO:e,DEBUG:f,ALL:g,getLevel:n,getLogToBrowserConsole:m,getLogger:o,setLogToBrowserConsole:function(b){a=b},setLevel:function(a){h=a},error:function(){l.call(this,c,arguments)},warn:function(){l.call(this,d,arguments)},info:function(){l.call(this,e,arguments)},log:function(){l.call(this,f,arguments)}}},MediaPlayer.utils.Config=function(){"use strict";var a=["video","audio"],b={"BufferController.minBufferTimeForPlaying":-1,"BufferController.minBufferTime":-1,"ABR.minBandwidth":-1,"ABR.maxBandwidth":-1,"ABR.minQuality":-1,"ABR.maxQuality":-1,"ABR.switchUpIncrementally":!1,"ABR.switchUpRatioSafetyFactor":-1,"ABR.latencyInBandwidth":!0,"ABR.switchDownBufferTime":-1,"ABR.switchDownBufferRatio":-1,video:{},audio:{}},c=function(c){var d,e,f;for(d in c)if(-1===d.indexOf("//"))if(a.indexOf(d)>-1){e=c[d];for(f in e)b[d][f]=c[d][f]}else b[d]=c[d]},d=function(a,b,c,d){var e=a[b];if(void 0===e||-1===e)return d;if(void 0!==c&&typeof e!==c)switch(c){case"number":e=Number(e);break;case"boolean":e="true"===e||"1"===e||1===e}return e},e=function(a,c,e){return d(b,a,c,e)},f=function(a,c,e,f){var g=b[a];return void 0!==g&&void 0!==g[c]?d(g,c,e,f):d(b,c,e,f)};return{debug:void 0,setup:function(){},setParams:function(a){c(a)},getParam:function(a,b,c){return e(a,b,c)},getParamFor:function(a,b,c,d){return f(a,b,c,d)}}},MediaPlayer.utils.Config.prototype={constructor:MediaPlayer.utils.Config},MediaPlayer.utils.TokenAuthentication=function(){"use strict";var a={type:MediaPlayer.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return a},setTokenAuthentication:function(b){a=b},checkRequestHeaderForToken:function(b){void 0!==a.name&&null!==b.getResponseHeader(a.name)&&(a.token=b.getResponseHeader(a.name))},addTokenAsQueryArg:function(b){if(void 0!==a.name&&void 0!==a.token&&a.type===MediaPlayer.utils.TokenAuthentication.TYPE_QUERY){var c=-1===b.indexOf("?")?"?":"&";b+=c+a.name+"="+a.token}return b},setTokenInRequestHeader:function(b){return a.type===MediaPlayer.utils.TokenAuthentication.TYPE_HEADER&&b.setRequestHeader(a.name,a.token),b}}},MediaPlayer.utils.TokenAuthentication.TYPE_QUERY="query",MediaPlayer.utils.TokenAuthentication.TYPE_HEADER="header",MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)};return{system:void 0,setup:function(){},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},isSeeking:function(){return a.seeking},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},listenOnParent:function(b,c){a.parentElement.addEventListener(b,c,!1)},unlistenOnParent:function(b,c){a.parentElement.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b},isStalled:function(){return 0===a.playbackRate},stallStream:f}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.vo.SegmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.streamType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.deferred=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.SegmentRequest.prototype={constructor:MediaPlayer.vo.SegmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=null,d=function(a){var b=null;return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},e=function(a,f){var g=d(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=null,m=null,n=this;l=function(){h.status<200||h.status>299||(h.responseURL&&(g=d(h.responseURL)),k=!1,j=new Date,n.tokenAuthentication.checkRequestHeaderForToken(h),n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),n.parser.parse(h.responseText,g).then(function(b){b.mpdUrl=a,b.mpdLoadedTime=j,n.metricsModel.addManifestUpdate("stream",b.type,i,j,b.availabilityStartTime),c.resolve(b)},function(b){var d={};d.mpdUrl=a,n.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE,"parsing the manifest failed : "+b,d),c.reject(h)}))},m=function(){if(k)if(k=!1,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),f>0)f--,setTimeout(function(){e.call(n,a,f)},b);else{var d={},g="Failed loading manifest: "+a+" no retry attempts left";d.url=a,d.request=h,n.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST,g,d),c.reject(h)}};try{h.onload=l,h.onloadend=m,h.onerror=m,h.open("GET",a,!0),h.send()}catch(o){h.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,tokenAuthentication:void 0,load:function(b){return c=Q.defer(),e.call(this,b,a),c.promise}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a,b=0/0,c=null,d=!1,e=function(){null!==c&&(clearInterval(c),c=null)},f=function(){e.call(this),isNaN(b)||(c=setTimeout(h.bind(this),Math.min(1e3*b,Math.pow(2,31)-1),this))},g=function(){var a,c=this,d=c.manifestModel.getValue();void 0!==d&&null!==d&&c.manifestExt.getRefreshDelay(d).then(function(e){a=((new Date).getTime()-d.mpdLoadedTime.getTime())/1e3,b=Math.max(e-a,0),f.call(c)})},h=function(){var b,c,e=this;Q.when(a?a.promise:!0).then(function(){a=Q.defer(),b=e.manifestModel.getValue(),c=b.mpdUrl,b.hasOwnProperty("Location")&&(c=b.Location),e.manifestLoader.load(c).then(function(a){e.manifestModel.setValue(a),d||g.call(e)})})},i=function(){a&&a.resolve()};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){g.call(this),this.system.mapHandler("streamsComposed",void 0,i.bind(this))},start:function(){d=!1,g.call(this)},stop:function(){d=!0,e.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,getValue:function(){return a},setValue:function(b){a=b,this.system.notify("manifestUpdated"),null!==a&&this.eventBus.dispatchEvent({type:"manifestLoaded",data:b})}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?Q.when(new MediaSource):a?Q.when(new WebKitMediaSource):null},attachMediaSource:function(a,b){"use strict";return b.setSource(window.URL.createObjectURL(a)),Q.when(!0)},detachMediaSource:function(a){"use strict";return a.setSource(""),Q.when(!0)},setDuration:function(a,b){"use strict";return a.duration=b,Q.when(a.duration)},signalEndOfStream:function(a){"use strict";return a.endOfStream(),Q.when(!0)}},MediaPlayer.dependencies.MetricsExtensions=function(){"use strict";var a={42:"Baseline","4D":"Main",58:"Extended",64:"High"},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){var c=!1;return"video"===b?(this.manifestExt.getIsVideo(a),"video"===a.type&&(c=!0)):"audio"===b?(this.manifestExt.getIsAudio(a),"audio"===a.type&&(c=!0)):c=!1,c},d=MediaPlayer.utils.copyMethods(Dash.dependencies.DashMetricsExtensions);return d.getDuration=function(){var a=this,b=a.manifestModel.getValue(),c=b.Period.duration;return c!==1/0?c:-1},d.getFormatForType=function(a){for(var b=this,c=b.manifestModel.getValue(),d=0;d<c.Period.AdaptationSet.length;d++){var e=c.Period.AdaptationSet[d];if(e.type===a)return e.mimeType}return null},d.getCodecForType=function(a){for(var b=this,c=b.manifestModel.getValue(),d=0;d<c.Period.AdaptationSet.length;d++){var e=c.Period.AdaptationSet[d];if(e.type===a||e.contentType===a)return e.Representation[0].codecs}return null},d.getVideoWidthForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.width},d.getVideoHeightForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.height},d.getCodecsForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.codecs},d.getH264ProfileLevel=function(b){if(b.indexOf("avc1")<0)return"";var c=a[b.substr(5,2)],d=parseInt(b.substr(9,2),16)/10;return c+"@"+d.toString()},d.getBitratesForType=function(a){var b,d,e,f,g,h,i,j,k,l=this,m=l.manifestModel.getValue(),n=[];if(null===m||void 0===m)return null;for(b=m.Period_asArray,e=0;e<b.length;e+=1)for(d=b[e],g=d.AdaptationSet_asArray,j=0;j<g.length;j+=1)if(f=g[j],c.call(l,f,a)){for(f=l.manifestExt.processAdaptation(f),i=f.Representation_asArray,k=0;k<i.length;k+=1)h=i[k],n.push(h.bandwidth);return n}return n},d.getCurrentRepresentationBoundaries=function(a){if(null===a)return null;var b=a.RepBoundariesList;return null===b||b.length<=0?null:b[b.length-1]},d.getCurrentBandwidthBoundaries=function(a){if(null===a)return null;var b=a.BandwidthBoundariesList;return null===b||b.length<=0?null:b[b.length-1]},d},MediaPlayer.dependencies.MetricsExtensions.prototype={constructor:MediaPlayer.dependencies.MetricsExtensions},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.manifestExt=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=Q.defer(),d=this;try{c.resolve(a.addSourceBuffer(b))}catch(e){d.manifestExt.getIsTextTrack(b)?"text/vtt"===b||"text/ttml"===b?c.resolve(d.system.getObject("textSourceBuffer")):"application/ttml+xml+mp4"===b?c.resolve(d.system.getObject("textTTMLXMLMP4SourceBuffer")):c.reject():c.reject(e.description)}return c.promise},removeSourceBuffer:function(a,b){"use strict";var c=Q.defer();try{c.resolve(a.removeSourceBuffer(b))}catch(d){b&&"function"==typeof b.getTextTrackExtensions?c.resolve():c.reject(d.description)}return c.promise},getBufferRange:function(a,b,c){var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return null}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i){if(k=Math.abs(g-b),b>=g&&h>b){i=g,j=h;continue}if(l>=k){i=g,j=h;continue}}else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){var b=null;try{return b=a.buffered}catch(c){return null}},getBufferLength:function(a,b,c){"use strict";var d,e,f=this;return d=f.getBufferRange(a,b,c),e=null===d?0:d.end-b},waitForUpdateEnd:function(a){"use strict";var b,c=Q.defer(),d=50,e=function(){a.updating||(clearInterval(b),c.resolve(!0))},f=function(){a.updating||(a.removeEventListener("updateend",f,!1),c.resolve(!0))};if("function"==typeof a.addEventListener)try{a.addEventListener("updateend",f,!1)}catch(g){b=setInterval(e,d)}else b=setInterval(e,d);return c.promise},append:function(a,b,c){var d=Q.defer();try{"append"in a?a.append(b):"appendBuffer"in a&&a.appendBuffer(b),c?d.resolve():this.waitForUpdateEnd(a).then(function(){d.resolve()})}catch(e){d.reject({err:e,data:b})}return d.promise},remove:function(a,b,c,d,e,f){var g=Q.defer();try{b>=0&&d>b&&c>b&&"ended"!==e.readyState&&a.remove(b,c),f?g.resolve():this.waitForUpdateEnd(a).then(function(){g.resolve()})}catch(h){g.reject(h)}return g.promise},abort:function(a,b){"use strict";var c=Q.defer();try{"open"===a.readyState&&b.abort(),c.resolve()}catch(d){c.reject(d.description)}return c.promise}},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date,totalVideoFrames:a.webkitDecodedFrameCount}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.dependencies.BufferExtensions=function(){"use strict";var a,b,c=0,d=0,e=null,f=null,g=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},h=function(){var a,b,g,h=this;return a=e?h.abrController.getQualityFor("audio"):c,b=f?h.abrController.getQualityFor("video"):d,g=a===c&&b===d};return{system:void 0,videoModel:void 0,manifestExt:void 0,metricsExt:void 0,metricsModel:void 0,abrController:void 0,bufferMax:void 0,updateData:function(a,b){var g=a.Representation_asArray.length-1;"audio"===b?(c=g,e=a):"video"===b&&(d=g,f=a)},getTopQualityIndex:function(a){var b=null;return"audio"===a?b=c:"video"===a&&(b=d),b},decideBufferLength:function(b,c){return a=isNaN(c)||MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME<c&&c>b?Math.max(MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,b):b>=c?Math.min(c,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME):Math.min(c,b),Q.when(a)},getLeastBufferLevel:function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},getRequiredBufferLength:function(c,d,e,f){var i,j=this,k=j.metricsModel.getReadOnlyMetricsFor("video"),l=j.metricsModel.getReadOnlyMetricsFor("audio"),m=f>=MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD,n=Q.defer(),o=!1;return j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN?(i=a,n.resolve(i)):j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY?(i=f,n.resolve(i)):j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED?(b=a,e||c||(o=h.call(j)),o&&(b=m?MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY),i=b+d+Math.max(g.call(j,k),g.call(j,l)),n.resolve(i)):n.reject("invalid bufferMax value: "+j.bufferMax),n.promise},getBufferTarget:function(){return void 0===b?a:b}}},MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_STARTUP=1,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME=16,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferExtensions.prototype.constructor=MediaPlayer.dependencies.BufferExtensions,MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},c=function(){for(var b=!0,c=a.length,d=0;c>d;d++)if(!a[d].isReady()){b=!1;break}return b},d=function(){for(var b=0;b<a.length;b++)a[b].executeCurrentRequest()};return{system:void 0,debug:void 0,fragmentLoader:void 0,process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),Q.when(b)},attachBufferController:function(c){if(!c)return null;var d=b(c);return d||(d=this.system.getObject("fragmentModel"),d.setContext(c),a.push(d)),d},detachBufferController:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},onBufferControllerStateChange:function(){c()&&d.call(this)},isFragmentLoadedOrPending:function(a,c){var d,e=b(a);return e?d=e.isFragmentLoadedOrPending(c):!1},getPendingRequests:function(a){var c=b(a);return c?c.getPendingRequests():null},getLoadingRequests:function(a){var c=b(a);return c?c.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&"initialization segment"===a.type.toLowerCase()},getLoadingTime:function(a){var c=b(a);return c?c.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests()},isFragmentExists:function(a){var b=Q.defer();return this.fragmentLoader.checkForExistence(a).then(function(){b.resolve(!0)},function(){b.resolve(!1)}),b.promise},prepareFragmentForLoading:function(a,c,d,e,f,g){var h=b(a);return h&&c?(h.addRequest(c),h.setCallbacks(d,e,f,g),Q.when(!0)):Q.when(null)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},e=function(a,c){b[a]=c},f=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},g=function(a,b){c[a]=b},h=function(a,b){var c,d=this,e=Q.defer(),f=d.config.getParamFor(a,"ABR.minQuality","number",-1),g=d.config.getParamFor(a,"ABR.maxQuality","number",-1),h=d.config.getParamFor(a,"ABR.minBandwidth","number",-1),i=d.config.getParamFor(a,"ABR.maxBandwidth","number",-1),j=[];return d.manifestExt.getRepresentationCount(b).then(function(a){if(-1!==h||-1!==i){for(c=0;a>c;c+=1)j.push(d.manifestExt.getRepresentationBandwidth(b,c));Q.all(j).then(function(b){if(-1!==h)for(c=0;a>c;c+=1)if(b[c]>=h){f=-1===f?c:Math.max(c,f);break}if(-1!==i)for(c=a-1;c>=0;c-=1)if(b[c]<=i){g=-1===g?c:Math.min(c,g);break}})}f=f>=a?a-1:f,g=g>=a?a-1:g,e.resolve({min:f,max:g})}),e.promise};return{debug:void 0,abrRulesCollection:void 0,manifestExt:void 0,metricsModel:void 0,config:void 0,getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getMetricsFor:function(a){var b=Q.defer(),c=this;return c.manifestExt.getIsVideo(a).then(function(d){d?b.resolve(c.metricsModel.getMetricsFor("video")):c.manifestExt.getIsAudio(a).then(function(a){b.resolve(a?c.metricsModel.getMetricsFor("audio"):c.metricsModel.getMetricsFor("stream"))})}),b.promise},_getPlaybackQuality:function(b,c){var h,i,j,k,l,m,n=this,o=Q.defer(),p=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,q=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,r=[];return l=d(b),m=f(b),a?n.getMetricsFor(c).then(function(a){n.abrRulesCollection.getRules().then(function(d){for(h=0,i=d.length;i>h;h+=1)r.push(d[h].checkIndex(l,a,c));Q.all(r).then(function(a){for(k={},k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,h=0,i=a.length;i>h;h+=1)j=a[h],j.quality!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(k[j.priority]=Math.min(k[j.priority],j.quality));k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.WEAK,p=k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,p=k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.STRONG,p=k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),p!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==p&&(l=p),q!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==q&&(m=q),n.manifestExt.getRepresentationCount(c).then(function(a){0>l&&(l=0),l>=a&&(l=a-1),m!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&m!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(m=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),e(b,l),g(b,m),o.resolve({quality:l,confidence:m})})})})}):o.resolve({quality:l,confidence:m}),o.promise},getPlaybackQuality:function(a,b){var c,d=this,e=Q.defer(),f=d.getQualityFor(a),g=-1,i=-1,j=d.config.getParamFor(a,"ABR.switchUpIncrementally","boolean",!1);return d._getPlaybackQuality(a,b).then(function(k){c=k.quality,d.getAutoSwitchBitrate()?(j&&c>f&&(c=f+1),h.call(d,a,b).then(function(b){g=b.min,i=b.max,-1!==g&&g>c&&(c=g),-1!==i&&c>i&&(c=i),d.setPlaybackQuality.call(d,a,c),e.resolve({quality:c,confidence:k.confidence})})):e.resolve({quality:c,confidence:k.confidence})}),e.promise},setPlaybackQuality:function(a,b){var c=d(a);b!==c&&e(a,b)},getQualityFor:function(a){return d(a)}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=!1,d=0,e=[],f=function(a){var b=new XMLHttpRequest,c=!1;b.open("HEAD",a.url,!0),b.onload=function(){b.status<200||b.status>299||(c=!0,a.deferred.resolve(a))},b.onloadend=b.onerror=function(){c||a.deferred.reject(b)},b.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,tokenAuthentication:void 0,doLoad:function(a,b){var c=Q.defer(),d=new XMLHttpRequest,f=null,g=!0,h=!0,i=null,j=this;return e.push(d),a.requestStartDate=new Date,f=j.metricsModel.addHttpRequest(a.streamType,null,a.type,a.url,null,a.range,a.requestStartDate,null,null,null,null,a.duration,a.startTime,a.quality),j.metricsModel.appendHttpTrace(f,a.requestStartDate,a.requestStartDate.getTime()-a.requestStartDate.getTime(),[0]),i=a.requestStartDate,d.open("GET",j.tokenAuthentication.addTokenAsQueryArg(a.url),!0),d.responseType="arraybuffer",d=j.tokenAuthentication.setTokenInRequestHeader(d),b&&d.setRequestHeader("Range",b),d.onprogress=function(b){var c=new Date;g&&(g=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c,f.tresponse=c)),j.metricsModel.appendHttpTrace(f,c,c.getTime()-i.getTime(),[d.response?d.response.byteLength:0]),(i.getTime()-a.requestStartDate.getTime())/1e3>2*f.mediaduration,i=c},d.onload=function(){if(!(d.status<200||d.status>299)){h=!1;var b,e,g=new Date,k=d.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=g,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),e=a.requestEndDate.getTime()-a.firstByteDate.getTime(),f.tresponse=a.firstByteDate,f.tfinish=a.requestEndDate,f.responsecode=d.status,f.bytesLength=k?k.byteLength:0,j.metricsModel.appendHttpTrace(f,g,g.getTime()-i.getTime(),[k?k.byteLength:0]),i=g,c.resolve({data:k,request:a})}},d.onloadend=d.onerror=function(){if(-1!==e.indexOf(d)&&(e.splice(e.indexOf(d),1),h)){h=!1;var b,g,k=new Date,l=d.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=k,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),g=a.requestEndDate.getTime()-a.firstByteDate.getTime(),f.tresponse=a.firstByteDate,f.tfinish=a.requestEndDate,f.responsecode=d.status,j.metricsModel.appendHttpTrace(f,k,k.getTime()-i.getTime(),[l?l.byteLength:0]),i=k,c.reject(d)}},d.send(),c.promise},getBytesLength:function(a){var b=Q.defer(),c=new XMLHttpRequest;return c.open("HEAD",a.url),c.onreadystatechange=function(){c.status<200||c.status>299?b.reject():c.getResponseHeader("Content-Length")?b.resolve(c.getResponseHeader("Content-Length")):b.reject()},c.send(),b.promise},planRequests:function(b){if(!b)return Q.when(null);var d=this,e=Q.defer();return c?this.getBytesLength(b).then(function(a){c=!0,d.loadRequests(a,b).then(function(a){var c=a[0].data,d=a[1].data,f=new Uint8Array(c.byteLength+d.byteLength);f.set(new Uint8Array(c),0),f.set(new Uint8Array(d),c.byteLength),e.resolve({data:f.buffer,request:b})})},function(){c=!1,e.resolve(d.doLoad(b,a))}):d.doLoad(b).then(function(a){e.resolve(a)},function(){d.retry(b,e,d)}),e.promise},retry:function(c,e,f){setTimeout(function(){f.doLoad(c).then(function(a){d=0,e.resolve(a)},function(b){d++,a>d?f.retry(c,e,f):(d=0,e.reject(b))})},b)},loadRequests:function(b,c){var d=Math.floor(b/2),e="bytes=0-"+(d-1),f="bytes="+d+"-"+b;return Q.all([this.doLoad(c,a,e),this.doLoad(c,a,f)])},load:function(a){var b=Q.defer();return"Initialization Segment"==a.type&&a.data?b.resolve(a,{data:a.data}):this.planRequests(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},abort:function(){var a,b,c=e.length;for(a=0;c>a;a+=1)b=e[a],b.abort(),b=null;e.length=0,e=[]},checkForExistence:function(a){return a?(a.deferred=Q.defer(),f.call(this,a),a.deferred.promise):Q.when(null)}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b,c,d,e,f=[],g=[],h=[],i=2,j=function(e){var g,i,j=this;b.call(a,e),g=function(b,d){h.splice(h.indexOf(b),1),f.push(b),c.call(a,b,d),b.deferred=null},i=function(b){h.splice(h.indexOf(b),1),d.call(a,b),b.deferred=null;

},j.fragmentLoader.load(e).then(g.bind(a,e),i.bind(a,e))},k=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},l=function(a){var b=f.indexOf(a);-1!==b&&f.splice(b,1)};return{system:void 0,debug:void 0,fragmentLoader:void 0,setContext:function(b){a=b},getContext:function(){return a},addRequest:function(a){if(a){if(this.isFragmentLoadedOrPending(a))return;g.push(a),k.call(this,g,"index")}},setCallbacks:function(a,f,g,h){b=a,e=h,d=g,c=f},isFragmentLoadedOrPending:function(a){for(var b,c=!1,d=f.length,e=0;d>e;e++)if(b=f[e],a.startTime===b.startTime||"complete"===b.action&&a.action===b.action){if(a.url===b.url){c=!0;break}l(a)}if(!c)for(e=0,d=g.length;d>e;e+=1)b=g[e],a.url===b.url&&a.startTime===b.startTime&&(c=!0);if(!c)for(e=0,d=h.length;d>e;e+=1)b=h[e],a.url===b.url&&a.startTime===b.startTime&&(c=!0);return c},isReady:function(){return a.isReady()},getPendingRequests:function(){return g},getLoadingRequests:function(){return h},getLoadingTime:function(){var a,b,c=0;for(b=f.length-1;b>=0;b-=1)if(a=f[b],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){c=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return c},getExecutedRequestForTime:function(a){var b,c=f.length-1,d=0/0,e=0/0,g=null;for(b=c;b>=0;b-=1)if(g=f[b],d=g.startTime,e=d+g.duration,!isNaN(d)&&!isNaN(e)&&a>d&&e>a)return g;return null},getExecutedRequestForQualityAndIndex:function(a,b){var c,d=f.length-1,e=null;for(c=d;c>=0;c-=1)if(e=f[c],e.quality===a&&e.index===b)return e;return null},removeExecutedRequest:function(a){l.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var b,c=f.length-1,d=0/0,e=null;for(b=c;b>=0;b-=1)e=f[b],d=e.startTime,!isNaN(d)&&a>d&&l.call(this,e)},cancelPendingRequests:function(){g=[]},abortRequests:function(){this.fragmentLoader.abort(),h=[]},executeCurrentRequest:function(){var b,c=this;if(0!==g.length&&!(h.length>=i))switch(b=g.shift(),b.action){case"complete":f.push(b),e.call(a,b);break;case"download":h.push(b),j.call(c,b);break;default:b.deferred?(b.deferred.reject(),b.deferred=null):d.call(a,b)}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b,c,d,e,f,g,h,i,j=[],k=6,l=.2,m=!0,n=!1,o=function(){a.play()},p=function(){a.pause()},q=function(b){a.seek(b)},r=function(a,b){var c=a.getElement(),d=b.getElement();return d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",u(c,d),t.call(this,a),s.call(this,b),Q.when(!0)},s=function(a){a.listen("seeking",c),a.listen("progress",d),a.listen("timeupdate",b),a.listen("pause",e),a.listen("play",f)},t=function(a){a.unlisten("seeking",c),a.unlisten("progress",d),a.unlisten("timeupdate",b),a.unlisten("pause",e),a.unlisten("play",f)},u=function(a,b){["controls","loop","muted","playbackRate","volume"].forEach(function(c){b[c]=a[c]})},v=function(){var b=a.getVideoModel().getElement().buffered;if(b.length){var c=b.length-1,e=b.end(c),f=a.getStartTime()+a.getDuration()-e;k>f&&(a.getVideoModel().unlisten("progress",d),B())}},w=function(){this.reset.call(this),this.load.call(this,this.currentURL)},x=function(){var b=a.getStartTime()+a.getDuration(),c=a.getVideoModel().getCurrentTime(),d=this,e=a.getVideoModel().getElement(),f=d.videoExt.getPlaybackQuality(e),g=((new Date).getTime()-d.startPlayingTime)/1e3;d.metricsModel.addCondition(null,null,e.videoWidth,e.videoHeight,f.droppedVideoFrames,f.totalVideoFrames/g),C()&&(a.getVideoModel().getElement().seeking||l>b-c&&G.call(this,a,C()))},y=function(){var b=a.getVideoModel().getCurrentTime(),c=D(b);this.metricsModel.addState("video","seeking",a.getVideoModel().getCurrentTime()),c&&c!==a&&G.call(this,a,c,b)},z=function(){this.manifestUpdater.stop(),this.metricsModel.addState("video","paused",a.getVideoModel().getCurrentTime())},A=function(){this.manifestUpdater.start(),void 0===this.startPlayingTime&&(this.startPlayingTime=(new Date).getTime());var b=a.getVideoModel().getElement();this.metricsModel.addCondition(null,0,b.videoWidth,b.videoHeight)},B=function(){var a=C();a&&a.seek(a.getStartTime())},C=function(){var b=a.getPeriodIndex()+1;return b<j.length?j[b]:null},D=function(a){var b=0,c=null,d=j.length;d>0&&(b+=j[0].getStartTime());for(var e=0;d>e;e++)if(c=j[e],b+=c.getDuration(),b>a)return c},E=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},F=function(a){a.parentNode&&a.parentNode.removeChild(a)},G=function(b,c,d){!n&&b&&c&&b!==c&&(n=!0,b.pause(),a=c,r.call(this,b.getVideoModel(),c.getVideoModel()),q(d?b.getVideoModel().getCurrentTime():c.getStartTime()),o(),b.resetEventController(),a.startEventController(),n=!1)},H=function(){var b,c,d,e,f,g,h,i=this,k=i.manifestModel.getValue(),l=i.metricsModel.getMetricsFor("stream"),n=i.metricsExt.getCurrentManifestUpdate(l),o=Q.defer(),p=[];return i.startPlayingTime=void 0,k?(i.manifestExt.getMpd(k).then(function(l){a&&(b=a.getPeriodInfo(),l.isClientServerTimeSyncCompleted=b.mpd.isClientServerTimeSyncCompleted,l.clientServerTimeShift=b.mpd.clientServerTimeShift),i.manifestExt.getRegularPeriods(k,l).then(function(b){if(0===b.length)return o.reject("There are no regular periods");for(i.metricsModel.updateManifestUpdateInfo(n,{currentTime:i.videoModel.getCurrentTime(),buffered:i.videoModel.getElement().buffered,presentationStartTime:b[0].start,clientTimeOffset:l.clientServerTimeShift}),e=0,c=b.length;c>e;e+=1){for(g=b[e],f=0,d=j.length;d>f;f+=1)j[f].getId()===g.id&&(h=j[f],p.push(h.updateData(g)));h||(h=i.system.getObject("stream"),h.setVideoModel(0===e?i.videoModel:E.call(i)),h.initProtection(i.protectionData),h.setAutoPlay(m),h.load(k,g),j.push(h)),i.metricsModel.addManifestUpdatePeriodInfo(n,g.id,g.index,g.start,g.duration),h=null}a||(a=j[0],s.call(i,a.getVideoModel())),Q.all(p).then(function(){o.resolve()})})}),o.promise):Q.when(!1)},I=function(){if(a){var b=this;b.manifestExt.getAudioDatas(b.manifestModel.getValue(),a.getPeriodIndex()).then(function(a){g=a,b.system.notify("audioTracksUpdated")})}},J=function(){if(a){var b=this;b.manifestExt.getTextDatas(b.manifestModel.getValue(),a.getPeriodIndex()).then(function(a){h=a,b.system.notify("subtitleTracksUpdated")})}},K=function(){var a=this;H.call(a).then(function(){I.call(a),J.call(a),a.system.notify("streamsComposed")},function(b){a.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NOSTREAM,b,a.manifestModel.getValue()),a.reset()})};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,bufferExt:void 0,manifestExt:void 0,fragmentController:void 0,abrController:void 0,fragmentExt:void 0,capabilities:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,errHandler:void 0,startTime:void 0,startPlayingTime:void 0,currentURL:void 0,setup:function(){this.system.mapHandler("manifestUpdated",void 0,K.bind(this)),b=x.bind(this),d=v.bind(this),c=y.bind(this),e=z.bind(this),f=A.bind(this),this.system.mapHandler("reloadManifest",void 0,w.bind(this))},getManifestExt:function(){return a.getManifestExt()},setAutoPlay:function(a){m=a},getAutoPlay:function(){return m},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getAudioTracks:function(){return g},setAudioTrack:function(b){a&&a.setAudioTrack(b)},getSubtitleTracks:function(){return h},setSubtitleTrack:function(b){a&&a.setSubtitleTrack(b)},load:function(a,b){var c=this;c.currentURL=a,b&&(c.protectionData=b),c.manifestLoader.load(a).then(function(a){c.manifestModel.setValue(a),c.metricsModel.addMetaData(),c.manifestUpdater.start()},function(){})},reset:function(){a&&t.call(this,a.getVideoModel());for(var b=0,c=j.length;c>b;b++){var d=j[b];d.reset(),d!==a&&F(d.getVideoModel().getElement())}j=[],this.manifestUpdater.stop(),this.manifestModel.setValue(null),this.metricsModel.clearAllCurrentMetrics(),n=!1,a=null,i=null},play:o,seek:q,pause:p}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.RequestScheduler=function(){"use strict";var a=[],b=null,c=null,d=!1,e=0,f=1,g=2,h=function(a,b,c){if(a&&b){var e;e=w.call(this,a,g),e.setScheduledTask(b),e.setIsScheduled(!0),e.setExecuteTime(c),d||i.call(this)}},i=function(){var a=this.videoModel.getElement();this.schedulerExt.attachScheduleListener(a,j.bind(this)),this.schedulerExt.attachUpdateScheduleListener(a,m.bind(this)),d=!0},j=function(){var a,b,c,d=x.call(this,g),e=d.length,f=this.videoModel.getCurrentTime();for(c=0;e>c;c+=1)a=d[c],b=a.getExecuteTime(),a.getIsScheduled()&&f>b&&(a.executeScheduledTask(),a.setIsScheduled(!1))},k=function(a){var b,c=z(a,g);c&&(y(c),b=x.call(this,g),0===b.length&&l.call(this))},l=function(){var a=this.videoModel.getElement();this.schedulerExt.detachScheduleListener(a,j.bind(this)),this.schedulerExt.detachUpdateScheduleListener(a,m.bind(this)),d=!1},m=function(){n.call(this),j.call(this)},n=function(){var a,b=x.call(this,g),c=b.length;for(a=0;c>a;a+=1)b[a].setIsScheduled(!0)},o=function(a,b,c){if(a&&b){var d,e,g=c.getTime()-(new Date).getTime();e=w.call(this,a,f),e.setScheduledTask(b),d=setTimeout(function(){e.executeScheduledTask(),y(e)},g),e.setExecuteId(d)}},p=function(a){var b=z(a,f);b&&(clearTimeout(b.getExecuteId()),y(b))},q=function(a,b){if(a&&b){var c=z(a,e);c||(c=w.call(this,a,e)),c.setIsScheduled(!0),c.setScheduledTask(b),t.call(this),b.call(a)}},r=function(){s.call(this)},s=function(){var a,b,c=this,d=x.call(c,e),f=d.length;for(b=0;f>b;b+=1)a=d[b],a.getIsScheduled()&&a.executeScheduledTask()},t=function(){null===c&&(this.adjustExecuteInterval(),c=setInterval(r.bind(this),b))},u=function(a){var b=z(a,e),c=x.call(this,e);b&&(y(b),0===c.length&&v.call(this))},v=function(){clearInterval(c),c=null},w=function(b,c){if(!b)return null;var d=this.system.getObject("schedulerModel");return d.setContext(b),d.setType(c),a.push(d),d},x=function(b){var c,d,e=[];for(d=0;d<a.length;d+=1)c=a[d],c.getType()===b&&e.push(c);return e},y=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},z=function(b,c){for(var d=0;d<a.length;d++)if(a[d].getContext()===b&&a[d].getType()===c)return a[d];return null};return{system:void 0,videoModel:void 0,debug:void 0,schedulerExt:void 0,isScheduled:function(a){var b=z(a,e);return!!b&&b.getIsScheduled()},getExecuteInterval:function(){return b},adjustExecuteInterval:function(){if(!(a.length<1)){var d=this.schedulerExt.getExecuteInterval(a[0].getContext());b!==d&&(b=d,null!==c&&(clearInterval(c),c=setInterval(r.bind(this),b)))}},startScheduling:q,stopScheduling:u,setTriggerForVideoTime:h,setTriggerForWallTime:o,removeTriggerForVideoTime:k,removeTriggerForWallTime:p}},MediaPlayer.dependencies.RequestScheduler.prototype={constructor:MediaPlayer.dependencies.RequestScheduler},MediaPlayer.dependencies.SchedulerExtensions=function(){"use strict"},MediaPlayer.dependencies.SchedulerExtensions.prototype={constructor:MediaPlayer.dependencies.SchedulerExtensions,getExecuteInterval:function(a){var b=1e3;return"undefined"!=typeof a.getMinBufferTime&&(b=1e3*a.getMinBufferTime()/4,b=Math.max(b,1e3)),b},attachScheduleListener:function(a,b){a.addEventListener("timeupdate",b)},detachScheduleListener:function(a,b){a.removeEventListener("timeupdate",b)},attachUpdateScheduleListener:function(a,b){a.addEventListener("seeking",b)},detachUpdateScheduleListener:function(a,b){a.removeEventListener("seeking",b)}},MediaPlayer.dependencies.SchedulerModel=function(){"use strict";var a,b,c,d,e,f=!1;return{system:void 0,debug:void 0,schedulerExt:void 0,setContext:function(b){a=b},getContext:function(){return a},setScheduledTask:function(a){b=a},executeScheduledTask:function(){b.call(a)},setExecuteTime:function(a){d=a},getExecuteTime:function(){return d},setExecuteId:function(a){e=a},getExecuteId:function(){return e},setType:function(a){c=a},getType:function(){return c},setIsScheduled:function(a){f=a},getIsScheduled:function(){return f}}},MediaPlayer.dependencies.SchedulerModel.prototype={constructor:MediaPlayer.dependencies.SchedulerModel},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=null,w=null,x=null,y=null,z=-1,A=null,B=-1,C=null,D=-1,E=!0,F=!1,G=!1,H=null,I=[],J=null,K=!1,L=!1,M=null,N=function(a){this.errHandler.sendError(a.data.code,a.data.message,a.data.data),this.reset()},O=function(){F&&this.videoModel.play()},P=function(){this.videoModel.pause()},R=function(a){F&&(this.system.notify("setCurrentTime"),this.videoModel.setCurrentTime(a),la.call(this).then(function(){ma(a)}))},S=function(a){var b=Q.defer(),c=this,d=function(){a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b.resolve(a)};return a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel),b.promise},T=function(){var c=this;y&&y.reset(G),A&&A.reset(G),C&&C.reset(G),M&&M.reset(),b&&c.mediaSourceExt.detachMediaSource(c.videoModel),F=!1,H=null,I=[],x=null,y=null,A=null,C=null,v=null,w=null,b=null,a=null},U=function(b,c,d,e){if(b&&c&&d)if(null===y&&null===A&&null===C){var f="No streams to play.";this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NOSTREAM,f,a),e.reject()}else e.resolve(!0)},V=function(){var c=Q.defer(),d=!1,e=!1,f=!1,g=this;return M=g.system.getObject("eventController"),M.initialize(g.videoModel),g.manifestExt.getDuration(a,J).then(function(){g.manifestExt.getVideoData(a,J.index).then(function(h){return null!==h?(g.manifestExt.getDataIndex(h,a,J.index).then(function(a){z=a}),g.manifestExt.getCodec(h).then(function(c){return v=c,g.manifestExt.getContentProtectionData(h).then(function(d){if(d&&!g.capabilities.supportsMediaKeys())return g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIAKEYS),Q.when(null);if(x=d,!g.capabilities.supportsCodec(g.videoModel.getElement(),c)){var e="Video Codec ("+c+") is not supported.";return g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_CODEC,e,a),Q.when(null)}return g.sourceBufferExt.createSourceBuffer(b,c)})}).then(function(a){null===a||(y=g.system.getObject("bufferController"),y.initialize("video",J,h,a,g.videoModel,g.requestScheduler,g.fragmentController,b,M)),d=!0,U.call(g,d,e,f,c)},function(){g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER,"Error creating video source buffer."),d=!0,U.call(g,d,e,f,c)})):(d=!0,U.call(g,d,e,f,c)),g.manifestExt.getAudioDatas(a,J.index)}).then(function(h){return null!==h&&h.length>0?g.manifestExt.getPrimaryAudioData(a,J.index).then(function(h){g.manifestExt.getDataIndex(h,a,J.index).then(function(a){B=a}),g.manifestExt.getCodec(h).then(function(c){return w=c,g.manifestExt.getContentProtectionData(h).then(function(d){if(d&&!g.capabilities.supportsMediaKeys())return g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIAKEYS),Q.when(null);if(x=d,!g.capabilities.supportsCodec(g.videoModel.getElement(),c)){var e="Audio Codec ("+c+") is not supported.";return g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_CODEC,e,a),Q.when(null)}return g.sourceBufferExt.createSourceBuffer(b,c)})}).then(function(a){null===a||(A=g.system.getObject("bufferController"),A.initialize("audio",J,h,a,g.videoModel,g.requestScheduler,g.fragmentController,b,M)),e=!0,U.call(g,d,e,f,c)},function(){g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER,"Error creating audio source buffer."),e=!0,U.call(g,d,e,f,c)})}):(e=!0,U.call(g,d,e,f,c)),g.manifestExt.getTextDatas(a,J.index)}).then(function(h){var i;return null!==h&&h.length>0?g.manifestExt.getPrimaryTextData(a,J.index).then(function(h){g.manifestExt.getDataIndex(h,a,J.index).then(function(a){D=a}),g.manifestExt.getMimeType(h).then(function(a){return i=a,g.sourceBufferExt.createSourceBuffer(b,i)}).then(function(a){null===a||(C=g.system.getObject("bufferController"),C.initialize("text",J,h,a,g.videoModel,g.requestScheduler,g.fragmentController,b),a.hasOwnProperty("initialize")&&a.initialize(i,C,h),f=!0,U.call(g,d,e,f,c))},function(a){g.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER,"Error creating text source buffer."),f=!0,U.call(g,d,e,f,c)})}):(f=!0,U.call(g,d,e,f,c)),g.manifestExt.getEventsForPeriod(a,J)}).then(function(a){M.addInlineEvents(a)})}),c.promise},W=function(){var a=this,c=Q.defer();return a.manifestExt.getDuration(a.manifestModel.getValue(),J).then(function(c){return a.mediaSourceExt.setDuration(b,c)}).then(function(){F=!0,c.resolve(!0)}),c.promise},X=function(){var a=this;t=this.timelineConverter.calcPresentationStartTime(J),t!=this.videoModel.getCurrentTime()?this.system.mapHandler("bufferUpdated",void 0,ua.bind(a)):c.resolve(null)},Y=function(){},Z=function(){},$=function(){},_=function(){},aa=function(){K&&!L&&ma(),K=!1,L=!1},ba=function(){var a=this.videoModel.getElement(),b=0;(document.webkitIsFullScreen||document.msFullscreenElement||document.mozFullScreen)&&(b=1),this.metricsModel.addCondition(null,b,a.videoWidth,a.videoHeight)},ca=function(){this.metricsModel.addState("video","stopped",this.videoModel.getCurrentTime(),1)},da=function(){K=!0,oa.call(this)},ea=function(a){var b,c=a.srcElement.error,d="<video> error event";if(-1!==c.code){switch(c.code){case 1:b=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_ABORTED;break;case 2:b=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_NETWORK;break;case 3:b=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_DECODE;break;case 4:b=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED;break;case 5:b=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED}G=!0,this.errHandler.sendError(b,d),this.reset()}},fa=function(){var a=this.videoModel.getCurrentTime();L=!0,ma(a)},ga=function(){this.videoModel.listen("seeking",j),this.videoModel.unlisten("seeked",k)},ha=function(){},ia=function(){la.call(this)},ja=function(){},ka=function(){y&&y.updateStalledState(),A&&A.updateStalledState(),C&&C.updateStalledState()},la=function(){y&&y.updateBufferState(),A&&A.updateBufferState(),C&&C.updateBufferState()},ma=function(a){y&&(void 0===a?y.start():y.seek(a)),A&&(void 0===a?A.start():A.seek(a)),C&&(void 0===a?C.start():C.seek(a))},na=function(){y&&y.stop(),A&&A.stop(),C&&C.stop()},oa=function(){(!this.scheduleWhilePaused||this.manifestExt.getIsDynamic(a))&&na.call(this),clearInterval(u)},pa=function(d){var e=this;return a=d,e.mediaSourceExt.createMediaSource().then(function(a){return S.call(e,a)}).then(function(a){return b=a,V.call(e)}).then(function(){return W.call(e)}).then(function(){return c.promise}).then(function(){0===J.index&&(M.start(),E&&O.call(e))})},qa=function(){this.videoModel.unlisten("seeking",j),this.videoModel.listen("seeked",k)},ra=function(){y&&!y.isBufferingCompleted()||A&&!A.isBufferingCompleted()||b&&this.mediaSourceExt.signalEndOfStream(b)},sa=function(){na.call(this)},ta=function(a){y&&y.seek(a),A&&A.seek(a),C&&C.seek(a)},ua=function(){var a,b,d,e=this;if(a=e.sourceBufferExt.getBufferRange(y.getBuffer(),t,2),null!==a){if(d=a.start,A){if(b=e.sourceBufferExt.getBufferRange(A.getBuffer(),t,2),null===b)return;if(b.end<d)return}e.system.unmapHandler("bufferUpdated"),e.system.notify("setCurrentTime"),e.videoModel.setCurrentTime(d),c.resolve(null)}},va=function(b){var c,d,e,f,g,h,i=this,j=Q.defer(),k=Q.defer(),l=Q.defer(),m=Q.defer(),n=Q.defer();return a=i.manifestModel.getValue(),J=b,y?(c=y.getData(),f=c&&c.hasOwnProperty("id")?i.manifestExt.getDataForId(c.id,a,J.index):i.manifestExt.getDataForIndex(z,a,J.index),f.then(function(a){y.updateData(a,J).then(function(){k.resolve()})})):k.resolve(),A?(d=A.getData(),g=i.manifestExt.getDataForIndex(B,a,J.index),g.then(function(a){A.updateData(a,J).then(function(){l.resolve()})})):l.resolve(),C&&(e=C.getData(),h=i.manifestExt.getDataForIndex(D,a,J.index),h.then(function(a){C.updateData(a,J).then(function(){m.resolve()})})),M&&i.manifestExt.getEventsForPeriod(a,J).then(function(a){M.addInlineEvents(a),n.resolve()}),Q.when(k.promise,l.promise,m.promise).then(function(){j.resolve()}),j.promise};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,bufferExt:void 0,manifestExt:void 0,fragmentController:void 0,abrController:void 0,fragmentExt:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,metricsExt:void 0,errHandler:void 0,timelineConverter:void 0,requestScheduler:void 0,scheduleWhilePaused:void 0,metricsModel:void 0,eventBus:void 0,notify:void 0,setup:function(){this.system.mapHandler("setCurrentTime",void 0,qa.bind(this)),this.system.mapHandler("bufferingCompleted",void 0,ra.bind(this)),this.system.mapHandler("segmentLoadingFailed",void 0,sa.bind(this)),this.system.mapHandler("liveEdgeFound",void 0,ta.bind(this)),this[MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR]=N.bind(this),c=Q.defer(),g=aa.bind(this),h=da.bind(this),i=ea.bind(this),j=fa.bind(this),k=ga.bind(this),n=ha.bind(this),o=ka.bind(this),l=ia.bind(this),m=ja.bind(this),f=X.bind(this),p=Y.bind(this),q=Z.bind(this),r=$.bind(this),s=_.bind(this),d=ba.bind(this),e=ca.bind(this)},load:function(a,b){J=b,pa.call(this,a)},setVideoModel:function(a){this.videoModel=a,this.videoModel.listen("play",g),this.videoModel.listen("pause",h),this.videoModel.listen("error",i),this.videoModel.listen("seeking",j),this.videoModel.listen("timeupdate",l),this.videoModel.listen("durationchange",m),this.videoModel.listen("progress",n),this.videoModel.listen("ratechange",o),this.videoModel.listen("loadedmetadata",f),this.videoModel.listen("ended",e),this.videoModel.listen("canplay",p),this.videoModel.listen("playing",q),this.videoModel.listen("loadstart",r),this.videoModel.listen("webkitfullscreenchange",d),this.videoModel.listen("fullscreenchange",d),this.videoModel.listenOnParent("fullscreenchange",d),this.videoModel.listenOnParent("webkitfullscreenchange",d),this.requestScheduler.videoModel=a},setAudioTrack:function(a){var b,c=Q.defer(),d=this.manifestModel.getValue(),e=this;return A?e.manifestExt.getDataIndex(a,d,J.index).then(function(a){B=a,b=d.mpdUrl,d.hasOwnProperty("Location")&&(b=d.Location),e.manifestLoader.load(b).then(function(a){e.manifestModel.setValue(a),c.resolve()})}):c.reject(),c.promise},setSubtitleTrack:function(a){var b,c=Q.defer(),d=this.manifestModel.getValue(),e=this;return C?e.manifestExt.getDataIndex(a,d,J.index).then(function(a){D=a,b=d.mpdUrl,d.hasOwnProperty("Location")&&(b=d.Location),e.manifestLoader.load(b).then(function(a){e.manifestModel.setValue(a),c.resolve()})}):c.reject(),c.promise},initProtection:function(a){this.capabilities.supportsEncryptedMedia()&&(this.protectionController||(this.protectionController=this.system.getObject("protectionController")),this.protectionController.subscribe(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,this),this.protectionController.setMediaElement(this.videoModel.getElement()),this.protectionController.init(this.manifestModel.getValue()),a&&this.protectionController.setProtectionData(a))},getVideoModel:function(){return this.videoModel},getManifestExt:function(){var a=this;return a.manifestExt},setAutoPlay:function(a){E=a},getAutoPlay:function(){return E},reset:function(){P.call(this),this.videoModel.unlisten("play",g),this.videoModel.unlisten("pause",h),this.videoModel.unlisten("error",i),this.videoModel.unlisten("seeking",j),this.videoModel.unlisten("timeupdate",l),this.videoModel.unlisten("durationchange",m),this.videoModel.unlisten("progress",n),this.videoModel.unlisten("ratechange",o),this.videoModel.unlisten("loadedmetadata",f),this.videoModel.unlisten("ended",e),this.videoModel.unlisten("canplay",p),this.videoModel.unlisten("playing",q),this.videoModel.unlisten("loadstart",r),this.videoModel.unlisten("webkitfullscreenchange",d),this.videoModel.unlisten("fullscreenchange",d),this.videoModel.unlistenOnParent("fullscreenchange",d),this.videoModel.unlistenOnParent("webkitfullscreenchange",d),T.call(this),this.protectionController&&(this.protectionController.unsubscribe(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,this),this.protectionController.teardown()),this.protectionController=void 0,this.fragmentController=void 0,this.requestScheduler=void 0,this.system.unmapHandler("bufferUpdated"),c=Q.defer()},getDuration:function(){return J.duration},getStartTime:function(){return J.start},getPeriodIndex:function(){return J.index},getId:function(){return J.id},getPeriodInfo:function(){return J},startEventController:function(){M.start()},resetEventController:function(){M.reset()},updateData:va,play:O,seek:R,pause:P}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e,f,g,h="READY",i=h,j=!1,k=!1,l=!1,m=!0,n=[],o=0,p=!1,q=-1,r=!0,s=-1,t=-1,u=!1,v=!1,w=!1,x=[],y=Q.defer(),z=null,A=null,B=null,C=0,D=null,E=0,F=!1,G=null,H=0,I=!1,J=null,K=null,L=null,M=null,N=!0,O=!1,P=-1,R=-1,S=null,T=!1,U=-1,V=function(){ja.call(this)&&null!==D&&this.fragmentController.onBufferControllerStateChange()},W=function(a,b){var c=0,d=null;N===!1&&(d=M.start,c=a.getTime()-d.getTime(),M.duration=c,M.stopreason=b,N=!0)},X=function(a){var b=this;u=a,b.videoModel.stallStream(d,u)},Y=function(){j&&k&&(X.call(this,!0),xa.call(this))},Z=function(){var a,b=this;k!==!0&&(p===!1&&(a=new Date,W(a,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),L=this.metricsModel.addPlayList(d,a,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),w&&(w=!1),k=!0,l=!0,Y.call(b))},$=function(a){var c=this,e=new Date;(p!==!0||q!==a)&&(k===!0&&_.call(c),L=this.metricsModel.addPlayList(d,e,q,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),p=!0,q=a,Q.when(S?S.promise:!0).then(function(){b.segments=null,Z.call(c)}))},_=function(){k&&(P=-1,clearTimeout(g),k=!1,l=!1,W(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),this.fragmentController.abortRequestsForModel(D))},aa=function(b){return a[b]},ba=function(a){},ca=function(a,b){this.fragmentController.isInitializationRequest(a)?da.call(this,a,b):ea.call(this,a,b)},da=function(a,b){var c=this,d=b.data,e=a.quality;c.fragmentController.process(d).then(function(b){null!==b?(n[e]=b,e===s&&fa.call(c,b,a.quality).then(function(){qa.call(c)})):qa.call(c)})},ea=function(b,c){var d=this,e=aa.call(d,b.quality),f=this.manifestExt.getEventStreamForAdaptationSet(d.getData()),g=this.manifestExt.getEventStreamForRepresentation(d.getData(),e);d.ChunkMissingState!==!1&&(d.ChunkMissingState=!0),H||isNaN(b.duration)||(H=b.duration),d.fragmentController.process(c.data,b,a).then(function(a){null!==a?((f.length>0||g.length>0)&&ha.call(d,a,b,f,g).then(function(a){d.eventController.addInbandEvents(a)}),ia.call(d,a).then(function(a){fa.call(d,a,b.quality,b.index).then(function(){ka.call(d),xa.call(d)})})):(ka.call(d),xa.call(d))})},fa=function(a,c,d){var f=this,g=Q.defer(),h=void 0===d,i=f.videoModel.getCurrentTime(),j=new Date;return N===!0&&(N=!1,M=f.metricsModel.appendPlayListTrace(L,b.id,null,j,i,null,1,null)),sa()?(la.call(f).then(function(){Q.when(A?A.promise:!0).then(function(){sa()&&f.sourceBufferExt.append(K,a,T).then(function(){h&&(s=c),F=!1,v?ma.call(f,-1,f.videoModel.getCurrentTime()-e).then(function(){ga.call(f),g.resolve()}):(ga.call(f),g.resolve()),f.system.notify("bufferUpdated")},function(a){var b={};b.currentTime=f.videoModel.getCurrentTime(),f.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_APPEND_SOURCEBUFFER,a.err.code+":"+a.err.message,b),a.err.code===MediaPlayer.dependencies.ErrorHandler.prototype.DOM_ERR_QUOTA_EXCEEDED&&(G={data:b,quality:c,index:d},z=g,F=!0,C=0,_.call(f))})})}),g.promise):void 0},ga=function(){var a,b,c=null;if(this.debug.getLogToBrowserConsole()){if(c=this.sourceBufferExt.getAllRanges(K),null===c||0===c.length)return;for(a=0,b=c.length;b>a;a+=1);}},ha=function(a,b,c,d){var e,f,g,h=[],i=0,j=Math.pow(256,2),k=Math.pow(256,3),l=Math.max(isNaN(b.startTime)?0:b.startTime,0),m=[];O=!1,g=c.concat(d);for(var n=0;n<g.length;n++)m[g[n].schemeIdUri]=g[n];for(;i<a.length&&(e=String.fromCharCode(a[i+4],a[i+5],a[i+6],a[i+7]),f=a[i]*k+a[i+1]*j+256*a[i+2]+1*a[i+3],"moov"!=e&&"moof"!=e);){if("emsg"==e){O=!0;for(var o=["","",0,0,0,0,""],p=0,q=i+12;f+i>q;)0===p||1==p||6==p?(0!==a[q]?o[p]+=String.fromCharCode(a[q]):p+=1,q+=1):(o[p]=a[q]*k+a[q+1]*j+256*a[q+2]+1*a[q+3],q+=4,p+=1);var r=o[0],s=o[1],t=o[2],u=o[3],v=o[4],w=o[5],x=o[6],y=l*t+u;if(m[r]){var z=new Dash.vo.Event;z.eventStream=m[r],z.eventStream.value=s,z.eventStream.timescale=t,z.duration=v,z.id=w,z.presentationTime=y,z.messageData=x,z.presentationTimeDelta=u,h.push(z)}}i+=f}return Q.when(h)},ia=function(a){if(!O)return Q.when(a);for(var b,c,d=a.length,e=0,f=0,g=Math.pow(256,2),h=Math.pow(256,3),i=new Uint8Array(a.length);d>e;){if(b=String.fromCharCode(a[e+4],a[e+5],a[e+6],a[e+7]),c=a[e]*h+a[e+1]*g+256*a[e+2]+1*a[e+3],"emsg"!=b)for(var j=e;e+c>j;j++)i[f]=a[j],f+=1;e+=c}return Q.when(i.subarray(0,f))},ja=function(){var a=this;return k?!0:(null!==S&&ka.call(a),!1)},ka=function(){S&&(S.resolve(),S=null)},la=function(){var a,b=this,c=Q.defer(),d=0;return F?(a=function(){var b,e,f=this,g=f.videoModel.getCurrentTime(),h=0;e=f.fragmentController.getExecutedRequestForTime(D,g),b=e&&!isNaN(e.startTime)?e.startTime:Math.floor(g),H=e&&!isNaN(e.duration)?e.duration:1,ma.call(f,h,b).then(function(b){d+=b,d>=H?c.resolve():setTimeout(a,1e3*H)})},a.call(b),c.promise):Q.when(!0)},ma=function(a,b){var d,e,f=this,g=Q.defer();return 0===K.buffered.length?(g.resolve(0),g.promise):(d=void 0!==a&&-1!==a?a:K.buffered.start(0),e=void 0!==b&&-1!==b?b:K.buffered.end(K.buffered.length-1),d>=e?(g.resolve(0),g.promise):(f.sourceBufferExt.waitForUpdateEnd(K).then(f.sourceBufferExt.remove(K,d,e,B.duration,c,T)).then(function(){f.fragmentController.removeExecutedRequestsBeforeTime(D,e),g.resolve(e-d)},function(){f.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_REMOVE_SOURCEBUFFER,"impossible to remove data from SourceBuffer")}),g.promise))},na=function(a){var c=(d+": Failed to load a request at startTime = "+a.startTime,{});this.ChunkMissingState===!1&&0!==a.quality&&(b=aa.call(this,0),(void 0!==b||null!==b)&&qa.call(this)),this.stallTime=a.startTime,this.ChunkMissingState=!0,c.url=a.url,c.request=a,this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,d+": Failed to load a request at startTime = "+a.startTime,c)},oa=function(){var a=this;w=!0,W(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON),ka.call(a),_.call(a),a.system.notify("bufferingCompleted")},pa=function(){var b=Q.defer(),c=this;return n[s]?(fa.call(this,n[s],s).then(function(){qa.call(c)}),b.resolve(null)):this.indexHandler.getInitRequest(a[s]).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},qa=function(){var a=this;if(ja.call(a)){var c=p?q:o,d=a.sourceBufferExt.getBufferRange(K,c),e=d?d.end:c;-1===U||p?a.indexHandler.getSegmentRequestForTime(b,e).then(ra.bind(a)):a.indexHandler.getNextSegmentRequestFromSN(b,U).then(ra.bind(a)),p===!0&&(p=!1)}},ra=function(a){var c=this,d=c.manifestModel.getValue();return null!==a&&a.action===a.ACTION_COMPLETE?void oa.call(c):void(null!==a?c.fragmentController.isFragmentLoadedOrPending(c,a)?c.indexHandler.getNextSegmentRequest(b).then(ra.bind(c)):(o=a.startTime,a.sequenceNumber&&(U=a.sequenceNumber),c.fragmentController.prepareFragmentForLoading(c,a,ba,ca,na,null).then(function(){V.call(c)})):"M3U"===d.name&&v?Aa.call(c,s).then(function(){b=aa.call(c,s),ya.call(c,0);

}):ya.call(c,0))},sa=function(){return!!J&&!!K},ta=function(){var a=this.videoModel.getCurrentTime();return B.start+B.duration-a},ua=function(){var a=-1;return a=this.videoModel.getCurrentTime()},va=function(){var a=Q.defer(),c=b.segmentAvailabilityRange.end,d=Math.max(c-e,b.segmentAvailabilityRange.start);return this.indexHandler.getSegmentRequestForTime(b,d).then(function(b){B.liveEdge=b.startTime,a.resolve(B.liveEdge)}),a.promise},wa=function(){if(sa()){var a=this,b=ua.call(a);E=a.sourceBufferExt.getBufferLength(K,b),a.metricsModel.addBufferLevel(d,new Date,E)}},xa=function(){var a=this;if(ja.call(a)){wa.call(a),u&&E>f&&X.call(a,!1);var b=ta.call(a);if(e>E&&(b>e||e>=b&&!w))za.call(a),R=E;else{var c=E-e;ya.call(a,c)}}},ya=function(a){var b=this;clearTimeout(g),g=setTimeout(function(){xa.call(b)},Math.max(1e3*a,2e3))},za=function(){var c,e=this,f=new Date,g=e.videoModel.getCurrentTime(),h=e.manifestModel.getValue(),i=null;S=Q.defer(),Ca.call(e).then(function(j){var k=j;e.abrController.getPlaybackQuality(d,J).then(function(j){c=j.quality,b=aa.call(e,c),c!==s&&(s=c,k=!0,b.segments=null,W(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON),e.metricsModel.addRepresentationSwitch(d,f,g,b.id),"M3U"!==h.name||!v&&null!==a[s].initialization||(i=Q.defer(),Aa.call(e,s).then(function(){b=aa.call(e,c),i.resolve()}))),Q.when(i?i.promise:!0).then(function(){k===!0?pa.call(e).then(function(a){null!==a&&e.fragmentController.prepareFragmentForLoading(e,a,ba,ca,na,null).then(function(){V.call(e)})},function(a){e.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_CODEC,a.name+" : "+a.message,e.manifestModel.getValue())}):qa.call(e)})})})},Aa=function(b){var c,d=this,e=Q.defer(),f=d.manifestModel.getValue();return d.manifestExt.getDataIndex(J,f,B.index).then(function(g){c=f.Period_asArray[B.index].AdaptationSet_asArray[g].Representation_asArray[b],d.parser.hlsParser.updatePlaylist(c).then(function(){Ba.call(d,J,B).then(function(b){a=b,e.resolve()})})}),e.promise},Ba=function(a,b){var c=this,d=Q.defer(),e=c.manifestModel.getValue();return c.manifestExt.getDataIndex(a,e,b.index).then(function(a){c.manifestExt.getAdaptationsForPeriod(e,b).then(function(b){c.manifestExt.getRepresentationsForAdaptation(e,b[a]).then(function(a){d.resolve(a)})})}),d.promise},Ca=function(){var b=this,c=Q.defer();return r===!1?(c.resolve(!1),c.promise):(n=[],Ba.call(b,J,B).then(function(e){a=e,b.bufferExt.updateData(J,d),r=!1,c.resolve(!0)}),c.promise)};return{videoModel:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,bufferExt:void 0,sourceBufferExt:void 0,abrController:void 0,parser:void 0,fragmentExt:void 0,indexHandler:void 0,debug:void 0,system:void 0,errHandler:void 0,scheduleWhilePaused:void 0,eventController:void 0,config:void 0,BUFFERING:0,PLAYING:1,stallTime:null,ChunkMissingState:!1,initialize:function(a,c,d,g,h,i,k,m,n){var o=this,p=o.manifestModel.getValue();-1!==navigator.userAgent.indexOf("Espial")&&(T=!0),v=o.manifestExt.getIsDynamic(p),o.setMediaSource(m),o.setVideoModel(h),o.setType(a),o.setBuffer(g),o.setScheduler(i),o.setFragmentController(k),o.setEventController(n),e=o.config.getParamFor(a,"BufferController.minBufferTime","number",-1),f=o.config.getParamFor(a,"BufferController.minBufferTimeForPlaying","number",2),J=d,B=c,r=!0,Ca.call(this).then(function(){o.abrController.getPlaybackQuality(a,J).then(function(c){t=c.quality,b=aa.call(o,c.quality),H=b.segmentDuration,o.indexHandler.setIsDynamic(v),o.bufferExt.decideBufferLength(p.minBufferTime,B.duration,l).then(function(a){e=-1===e?a:e}),v?"video"===a&&o.indexHandler.updateSegmentList(b).then(function(){va.call(o).then(function(a){o.system.notify("liveEdgeFound",a)})}):o.indexHandler.getCurrentTime(b).then(function(a){o.seek(a)})})}),j=!0},getType:function(){return d},setType:function(a){d=a,void 0!==this.indexHandler&&this.indexHandler.setType(a)},getPeriodInfo:function(){return B},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getScheduler:function(){return this.requestScheduler},setScheduler:function(a){this.requestScheduler=a},getFragmentController:function(){return this.fragmentController},setFragmentController:function(a){this.fragmentController=a,D=this.fragmentController.attachBufferController(this)},setEventController:function(a){this.eventController=a},getAutoSwitchBitrate:function(){var a=this;return a.abrController.getAutoSwitchBitrate()},setAutoSwitchBitrate:function(a){this.abrController.setAutoSwitchBitrate(a)},getData:function(){return J},updateData:function(a,b){var c=this,d=Q.defer(),e=J&&J.lang!==a.lang?!0:!1;if(J=a,B=b,r=!0,e){c.fragmentController.cancelPendingRequestsForModel(D),c.fragmentController.abortRequestsForModel(D);var f=c.getVideoModel().getCurrentTime(),g=f+3;ma.call(c,-1,f).then(function(){ma.call(c,g).then(function(){ga.call(c),$.call(c,g),d.resolve()})})}else d.resolve();return d.promise},getCurrentRepresentation:function(){return b},getBuffer:function(){return K},setBuffer:function(a){K=a},getMinBufferTime:function(){return e},setMinBufferTime:function(a){e=a},setMediaSource:function(a){c=a},isReady:function(){return i===h},isBufferingCompleted:function(){return w},clearMetrics:function(){null!==d&&""!==d&&this.metricsModel.clearCurrentMetricsForType(d)},updateManifest:function(){this.system.notify("reloadManifest")},updateBufferState:function(){if(0>=E&&P!==this.BUFFERING&&this.videoModel.isSeeking()!==!0){if(P=this.BUFFERING,this.metricsModel.addState(d,"buffering",this.videoModel.getCurrentTime()),null!==this.stallTime&&this.ChunkMissingState===!0)if(v)this.stallTime=null,setTimeout(this.updateManifest.bind(this),1e3*b.segments[b.segments.length-1].duration);else{_.call(this);var a=this.stallTime+b.segments[b.segments.length-1].duration;$.call(this,a),this.videoModel.setCurrentTime(a),this.stallTime=null}}else E>0&&P!==this.PLAYING&&(P=this.PLAYING,this.metricsModel.addState(d,"playing",this.videoModel.getCurrentTime()));F&&G&&!I?(I=!0,fa.call(this,G.data,G.quality,G.index).then(function(){I=!1})):wa.call(this)},updateStalledState:function(){u=this.videoModel.isStalled()},reset:function(a){var b=this,d=function(a){a&&(a.reject(),a=null)};_.call(b),d(z),d(A),d(S),x.forEach(d),x=[],d(y),y=Q.defer(),b.clearMetrics(),b.fragmentController.abortRequestsForModel(D),b.fragmentController.detachBufferController(D),D=null,n=[],m=!0,F=!1,G=null,I=!1,a||(b.sourceBufferExt.abort(c,K),b.sourceBufferExt.removeSourceBuffer(c,K)),J=null,K=null},start:Z,seek:$,stop:_}},MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.Parser=function(){"use strict";var a=function(a,b){var c=null;if(a.indexOf("SmoothStreamingMedia")>-1&&"undefined"!=typeof this.mssParser)this.system.notify("setContext","MSS"),c=this.mssParser;else if(a.indexOf("#EXTM3U")>-1&&"undefined"!=typeof this.hlsParser)this.system.notify("setContext","HLS"),c=this.hlsParser;else{if(!(a.indexOf("MPD")>-1&&"undefined"!=typeof this.dashParser))return Q.reject("manifest cannot be parsed, protocol is unsupported!");this.system.notify("setContext","MPD"),c=this.dashParser}return c.parse(a,b)};return{debug:void 0,system:void 0,dashParser:void 0,mssParser:void 0,hlsParser:void 0,metricsModel:void 0,parse:a}},MediaPlayer.dependencies.Parser.prototype={constructor:MediaPlayer.dependencies.Parser},MediaPlayer.modules.ContextManager=function(){"use strict";return{system:void 0,debug:void 0,setContext:function(a){this.system.autoMapOutlets=!0,"MSS"===a?(this.system.mapClass("mp4Processor",MediaPlayer.dependencies.Mp4Processor),this.system.mapClass("indexHandler",Mss.dependencies.MssHandler),this.system.mapClass("fragmentController",Mss.dependencies.MssFragmentController)):"HLS"===a?(this.system.mapClass("mp4Processor",MediaPlayer.dependencies.Mp4Processor),this.system.mapClass("fragmentController",Hls.dependencies.HlsFragmentController),this.system.mapClass("indexHandler",Hls.dependencies.HlsHandler)):(this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler))}}},MediaPlayer.modules.ContextManager.prototype={constructor:MediaPlayer.modules.ContextManager},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.quality=a,this.priority=b,void 0===this.quality&&(this.quality=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a=function(a,b,c){var d=this,e=Q.defer();return d.manifestExt.getRepresentationFor(a,c).then(function(a){d.manifestExt.getBandwidth(a).then(function(a){e.resolve(a/b)})}),e.promise};return{debug:void 0,manifestExt:void 0,metricsExt:void 0,checkIndex:function(b,c,d){var e,f,g,h,i,j,k,l,m,n=this,o=n.metricsExt.getCurrentHttpRequest(c),p=.75;return c?null===o?Q.when(new MediaPlayer.rules.SwitchRequest):(f=(o.tfinish.getTime()-o.trequest.getTime())/1e3,e=(o.tfinish.getTime()-o.tresponse.getTime())/1e3,0>=f?Q.when(new MediaPlayer.rules.SwitchRequest):null===o.mediaduration||void 0===o.mediaduration||o.mediaduration<=0||isNaN(o.mediaduration)?Q.when(new MediaPlayer.rules.SwitchRequest):(j=Q.defer(),h=o.mediaduration/f,g=o.mediaduration/e*p,isNaN(g)||isNaN(h)?Q.when(new MediaPlayer.rules.SwitchRequest):(isNaN(g)?j.resolve(new MediaPlayer.rules.SwitchRequest):4>g?b>0?n.manifestExt.getRepresentationFor(b-1,d).then(function(a){n.manifestExt.getBandwidth(a).then(function(a){n.manifestExt.getRepresentationFor(b,d).then(function(c){n.manifestExt.getBandwidth(c).then(function(c){i=a/c,j.resolve(i>g?new MediaPlayer.rules.SwitchRequest(0):new MediaPlayer.rules.SwitchRequest(b-1))})})})}):j.resolve(new MediaPlayer.rules.SwitchRequest(b)):n.manifestExt.getRepresentationCount(d).then(function(c){c-=1,c>b?n.manifestExt.getRepresentationFor(b+1,d).then(function(e){n.manifestExt.getBandwidth(e).then(function(e){n.manifestExt.getRepresentationFor(b,d).then(function(f){n.manifestExt.getBandwidth(f).then(function(f){if(i=e/f,g>=i)if(g>100)j.resolve(new MediaPlayer.rules.SwitchRequest(c-1));else if(g>10)j.resolve(new MediaPlayer.rules.SwitchRequest(b+1));else{for(l=-1,k=[];(l+=1)<c;)k.push(a.call(n,l,f,d));Q.all(k).then(function(a){for(l=0,m=a.length;m>l&&!(g<a[l]);l+=1);j.resolve(new MediaPlayer.rules.SwitchRequest(l))})}else j.resolve(new MediaPlayer.rules.SwitchRequest)})})})}):j.resolve(new MediaPlayer.rules.SwitchRequest(c))}),j.promise))):Q.when(new MediaPlayer.rules.SwitchRequest)}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,checkIndex:function(c,d){var e,f,g=!1,h=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===d.PlayList||void 0===d.PlayList||0===d.PlayList.length?Q.when(new MediaPlayer.rules.SwitchRequest):(e=d.PlayList[d.PlayList.length-1],null===e||void 0===e||0===e.trace.length?Q.when(new MediaPlayer.rules.SwitchRequest):(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?Q.when(new MediaPlayer.rules.SwitchRequest):(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(g=!0,a+=1),a>b&&(h=MediaPlayer.rules.SwitchRequest.prototype.STRONG),Q.when(g?new MediaPlayer.rules.SwitchRequest(c-1,h):a>b?new MediaPlayer.rules.SwitchRequest(c,h):new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,h)))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=10,b=2e4,c=5,d=0;return{debug:void 0,checkIndex:function(e,f){if(d>0)return d-=1,Q.when(new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var g,h,i,j=!1,k=(new Date).getTime(),l=f.RepSwitchList.length;for(i=l-1;i>=0&&(g=f.RepSwitchList[i],h=k-g.t.getTime(),!(h>=b));i-=1)if(i>=a){j=!0;break}return j?(d=c,Q.when(new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):Q.when(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.BaseRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,getRules:function(){return Q.when(a)},setup:function(){var a=this;a.getRules().then(function(b){b.push(a.downloadRatioRule),b.push(a.insufficientBufferRule)})}}},MediaPlayer.rules.BaseRulesCollection.prototype={constructor:MediaPlayer.rules.BaseRulesCollection},MediaPlayer.rules.o.DownloadRatioRule=function(){"use strict";return{debug:void 0,manifestExt:void 0,metricsExt:void 0,manifestModel:void 0,config:void 0,checkIndex:function(a,b,c){var d,e,f,g,h,i=this,j=i.metricsExt.getCurrentHttpRequest(b),k=i.metricsExt.getHttpRequests(b),l=i.config.getParamFor(c.type,"ABR.latencyInBandwidth","boolean",!0),m=i.config.getParamFor(c.type,"ABR.switchUpRatioSafetyFactor","number",1.5),n=[],o=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,p=0,q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;if(!b)return Q.when(new MediaPlayer.rules.SwitchRequest);if(null===j)return Q.when(new MediaPlayer.rules.SwitchRequest);if(e=(j.tfinish.getTime()-j.trequest.getTime())/1e3,d=(j.tfinish.getTime()-j.tresponse.getTime())/1e3,0>=e)return Q.when(new MediaPlayer.rules.SwitchRequest);if(null===j.mediaduration||void 0===j.mediaduration||j.mediaduration<=0||isNaN(j.mediaduration))return Q.when(new MediaPlayer.rules.SwitchRequest);if(g=Q.defer(),p=j.bytesLength,k.length>=3)for(h=k.length-2;h>=k.length-3;h--)p+=k[h].bytesLength,e+=(k[h].tfinish.getTime()-k[h].trequest.getTime())/1e3,d+=(k[h].tfinish.getTime()-k[h].tresponse.getTime())/1e3;return p*=8,f=l?p/e:p/d,isNaN(f)?Q.when(new MediaPlayer.rules.SwitchRequest):(i.manifestExt.getRepresentationCount(c).then(function(b){i.manifestExt.getRepresentationFor(a,c).then(function(d){i.manifestExt.getBandwidth(d).then(function(d){for(h=0;b>h;h+=1)n.push(i.manifestExt.getRepresentationBandwidth(c,h));Q.all(n).then(function(c){if(d>=f){for(h=a-1;h>0&&!(c[h]<=f);h-=1);o=h,q=MediaPlayer.rules.SwitchRequest.prototype.WEAK,g.resolve(new MediaPlayer.rules.SwitchRequest(o,q))}else{for(h=b-1;h>a&&!(f>c[h]*m);h-=1);o=h,q=MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.resolve(new MediaPlayer.rules.SwitchRequest(o,q))}})})})}),g.promise)}}},MediaPlayer.rules.o.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.o.DownloadRatioRule},MediaPlayer.rules.o.InsufficientBufferRule=function(){"use strict";return{debug:void 0,manifestExt:void 0,metricsExt:void 0,manifestModel:void 0,config:void 0,checkIndex:function(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=l.metricsExt.getCurrentBufferLevel(b),n=a,o=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===m?Q.when(new MediaPlayer.rules.SwitchRequest):(k=Q.defer(),l.manifestExt.getMpd(l.manifestModel.getValue()).then(function(b){d=l.config.getParamFor(c.type,"BufferController.minBufferTime","number",b.manifest.minBufferTime),e=l.config.getParamFor(c.type,"ABR.switchLowerBufferRatio","number",.25),f=l.config.getParamFor(c.type,"ABR.switchLowerBufferTime","number",e*d),g=l.config.getParamFor(c.type,"ABR.switchDownBufferRatio","number",.5),h=l.config.getParamFor(c.type,"ABR.switchDownBufferTime","number",g*d),i=l.config.getParamFor(c.type,"ABR.switchUpBufferRatio","number",.75),j=l.config.getParamFor(c.type,"ABR.switchUpBufferTime","number",i*d),l.manifestExt.getRepresentationCount(c).then(function(b){b-=1,m.level<=f?(n=0,o=MediaPlayer.rules.SwitchRequest.prototype.STRONG):m.level<=h&&(n=a>0?a-1:0,o=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),k.resolve(new MediaPlayer.rules.SwitchRequest(n,o))})}),k.promise)}}},MediaPlayer.rules.o.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.o.OInsufficientBufferRule},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b="observableId",c=0,d=function(){return this[b]||(c+=1,this[b]="_id_"+c),this[b]};return{system:void 0,setup:function(){a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var b=arguments[0]+d.call(this),c=new MediaPlayer.vo.Event;c.sender=this,c.type=arguments[0],c.data=arguments[1],c.error=arguments[2],c.timestamp=(new Date).getTime(),a.notify.call(a,b,c)},subscribe:function(b,c,e,f){if(!e&&c[b]&&(e=c[b]=c[b].bind(c)),!c)throw"observer object cannot be null or undefined";if(!e)throw"event handler cannot be null or undefined";b+=d.call(this),a.mapHandler(b,void 0,e,f)},unsubscribe:function(b,c,e){e=e||c[b],b+=d.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.EventController=function(){"use strict";var a=[],b=[],c=[],d=null,e=100,f=e/1e3,g="urn:mpeg:dash:event:2012",h=1,i=function(){null!==d&&(clearInterval(d),d=null),a=null,b=null,c=null},j=function(){null!==d&&(clearInterval(d),d=null)},k=function(){isNaN(e)||(d=setInterval(n.bind(this),e))},l=function(b){a=[],b&&b.length>0&&(a=b)},m=function(a){for(var c=0;c<a.length;c++){var d=a[c];b[d.id]=d}},n=function(){o.call(this,b),o.call(this,a),p.call(this)},o=function(a){var b,d=this.videoModel.getCurrentTime();if(a)for(var e=0;e<a.length;e++){var i=a[e];void 0!==i&&(b=i.presentationTime/i.eventStream.timescale,(0===b||d>=b&&b+f>d)&&(i.duration>0&&c.push(i),i.eventStream.schemeIdUri==g&&i.eventStream.value==h&&q.call(this),a.splice(e,1)))}},p=function(){if(c)for(var a=this.videoModel.getCurrentTime(),b=0;b<c.length;b++){var d=c[b];null!==d&&(d.duration+d.presentationTime)/d.eventStream.timescale<a&&(d=null,c.splice(b,1))}},q=function(){var a=this,b=a.manifestModel.getValue(),c=b.mpdUrl;b.hasOwnProperty("Location")&&(c=b.Location),a.manifestLoader.load(c).then(function(b){a.manifestModel.setValue(b)})};return{manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,debug:void 0,system:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:m,reset:i,clear:j,start:k,getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},initialize:function(a){this.setVideoModel(a)}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var a=new MediaPlayer.vo.URIFragmentData,b=[],c=function(){a=new MediaPlayer.vo.URIFragmentData,b=[]},d=function(c){function d(a,b,c,d){var e=d[0].split(/[=]/);return d.push({key:e[0],value:e[1]}),d.shift(),d}function e(a,c,d){return c>0&&(j&&0===b.length?b=d[c].split(/[&]/):k&&(g=d[c].split(/[&]/))),d}var f,g=[],h=new RegExp(/[?]/),i=new RegExp(/[#]/),j=h.test(c),k=i.test(c);return f=c.split(/[?#]/).map(e),b.length>0&&(b=b.reduce(d,null)),g.length>0&&(g=g.reduce(d,null),g.forEach(function(b){a[b.key]=b.value})),c};return{parseURI:d,reset:c,getURIFragmentData:function(){return a},getURIQueryData:b}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.Event=function(){"use strict";this.type=null,this.sender=null,this.data=null,this.error=null,this.timestamp=0/0},MediaPlayer.vo.Event.prototype={constructor:MediaPlayer.vo.Event},MediaPlayer.vo.Error=function(a,b,c){"use strict";this.code=a||null,this.message=b||null,this.data=c||null},MediaPlayer.vo.Error.prototype={constructor:MediaPlayer.vo.Error},MediaPlayer.vo.Mp4Track=function(){"use strict";this.type="und",this.trackId=0,this.timescale=0,this.duration=0,this.codecs="",this.codecPrivateData="",this.bandwidth="",this.width=0,this.height=0,this.language="und",this.channels=0,this.samplingRate=0,this.contentProtection=void 0,this.samples=[],this.data=null},MediaPlayer.vo.Mp4Track.prototype={constructor:MediaPlayer.vo.Mp4Track},MediaPlayer.vo.Mp4Track.Sample=function(){"use strict";this.dts=0,this.cts=0,this.duration=0,this.data=null,this.size=0},MediaPlayer.vo.Mp4Track.Sample.prototype={constructor:MediaPlayer.vo.Mp4Track.Sample},MediaPlayer.dependencies.Mp4Processor=function(){"use strict";var a=function(a){var b=new mp4lib.boxes.MovieHeaderBox,c=a[a.length-1];return b.version=1,b.creation_time=0,b.modification_time=0,b.timescale=c.timescale,b.duration=Math.round(c.duration*c.timescale),b.rate=65536,b.volume=256,b.reserved=0,b.reserved_2=[0,0],b.matrix=[65536,0,0,0,65536,0,0,0,1073741824],b.pre_defined=[0,0,0,0,0,0],b.next_track_ID=c.trackId+1,b.flags=0,b},b=function(a){var b,c,e;return b=new mp4lib.boxes.TrackBox,c=new mp4lib.boxes.TrackHeaderBox,c.version=1,c.flags=7,c.creation_time=0,c.modification_time=0,c.track_id=a.trackId,c.reserved=0,c.duration=Math.round(a.duration*a.timescale),c.reserved_2=[0,0],c.layer=0,c.alternate_group=0,c.volume=256,c.reserved_3=0,c.matrix=[65536,0,0,0,65536,0,0,0,1073741824],c.width=a.width<<16,c.height=a.height<<16,b.boxes.push(c),e=new mp4lib.boxes.MediaBox,e.boxes.push(d(a)),e.boxes.push(f(a)),e.boxes.push(g(a)),b.boxes.push(e),b},c=function(a){var b,c,d,e=0;return b=a.charCodeAt(0)-96<<10,c=a.charCodeAt(1)-96<<5,d=a.charCodeAt(2)-96,e=b|c|d},d=function(a){var b=new mp4lib.boxes.MediaHeaderBox;return b.flags=0,b.version=1,b.creation_time=0,b.modification_time=0,b.timescale=a.timescale,b.duration=Math.round(a.duration*a.timescale),b.pad=0,b.language=c(a.language),b.pre_defined=0,b},e=function(a){var b,c=0;for(b=0;b<a.length;b++)c|=a.charCodeAt(b)<<8*(a.length-b-1);return c},f=function(a){var b=new mp4lib.boxes.HandlerBox;switch(b.version=0,b.pre_defined=0,a.type){case"video":b.handler_type=e(b.HANDLERTYPEVIDEO),b.name=b.HANDLERVIDEONAME;break;case"audio":b.handler_type=e(b.HANDLERTYPEAUDIO),b.name=b.HANDLERAUDIONAME;break;default:b.handler_type=e(b.HANDLERTYPETEXT),b.name=b.HANDLERTEXTNAME}return b.name+="\x00",b.reserved=[0,0,0],b.flags=0,b},g=function(a){var b=new mp4lib.boxes.MediaInformationBox;switch(a.type){case"video":b.boxes.push(C(a));break;case"audio":b.boxes.push(D(a))}return b.boxes.push(h(a)),b.boxes.push(B(a)),b},h=function(){var a,b,c;return a=new mp4lib.boxes.DataInformationBox,b=new mp4lib.boxes.DataReferenceBox,b.version=0,b.entry_count=1,b.flags=0,c=new mp4lib.boxes.DataEntryUrlBox,c.location="",c.version=0,c.flags=1,b.boxes.push(c),a.boxes.push(b),a},i=function(){var a=new mp4lib.boxes.TimeToSampleBox;return a.version=0,a.entry_count=0,a.flags=0,a.entry=[],a},j=function(){var a=new mp4lib.boxes.SampleToChunkBox;return a.flags=0,a.version=0,a.entry_count=0,a.entry=[],a},k=function(){var a=new mp4lib.boxes.ChunkOffsetBox;return a.version=0,a.entry_count=0,a.flags=0,a.chunk_offset=[],a},l=function(){var a=new mp4lib.boxes.SampleSizeBox;return a.version=0,a.flags=0,a.sample_count=0,a.sample_size=0,a},m=function(a){var b,c=new Uint8Array(a.length/2);for(b=0;b<a.length/2;b++)c[b]=parseInt(""+a[2*b]+a[2*b+1],16);return c},n=function(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a,0),c.set(b,a.length),c},o=function(a){var b,c,d,e,f,g,h,i,j,k=new RegExp("^[A-Z0-9]7","gi"),l=new RegExp("^[A-Z0-9]8","gi");for(b=new mp4lib.boxes.AVCConfigurationBox,b.configurationVersion=1,b.lengthSizeMinusOne=3,b.reserved=63,b.SPS_NAL=[],b.PPS_NAL=[],c=new Uint8Array(0),d=a.codecPrivateData,e=d.split("00000001"),e.splice(0,1),f=0,g=0,h=0;h<e.length;h++)i=m(e[h]),e[h].match(k)&&(b.SPS_NAL[f++]={NAL_length:i.length,NAL:i},b.AVCProfileIndication=parseInt(e[h].substr(2,2),16),b.profile_compatibility=parseInt(e[h].substr(4,2),16),b.AVCLevelIndication=parseInt(e[h].substr(6,2),16)),e[h].match(l)&&(b.PPS_NAL[g++]={NAL_length:i.length,NAL:i}),j=new Uint8Array(i.length+4),j[3]=i.length,j.set(i,4),c=n(c,j);return b.numOfSequenceParameterSets=f,b.numOfPictureParameterSets=g,b},p=function(a){var b=null;return b=void 0!==a.contentProtection?new mp4lib.boxes.EncryptedVideoBox:new mp4lib.boxes.AVC1VisualSampleEntryBox,b.data_reference_index=1,b.compressorname="AVC Coding",b.depth=24,b.reserved=[0,0,0,0,0,0],b.reserved_2=0,b.reserved_3=0,b.pre_defined=0,b.pre_defined_2=[0,0,0],b.pre_defined_3=65535,b.frame_count=1,b.horizresolution=4718592,b.vertresolution=4718592,b.height=a.height,b.width=a.width,b.boxes.push(o(a)),void 0!==a.contentProtection&&b.boxes.push(u(a)),b},q=function(a){var b=new mp4lib.boxes.OriginalFormatBox;return b.data_format=e(a.codecs.substring(0,a.codecs.indexOf("."))),b},r=function(){var a=new mp4lib.boxes.SchemeTypeBox;return a.flags=0,a.version=0,a.scheme_type=1667591779,a.scheme_version=65536,a},s=function(a){var b=new mp4lib.boxes.SchemeInformationBox;return b.boxes.push(t(a)),b},t=function(a){var b=new mp4lib.boxes.TrackEncryptionBox;return b.flags=0,b.version=0,b.default_IsEncrypted=1,b.default_IV_size=8,b.default_KID=a.contentProtection&&a.contentProtection.length>0&&a.contentProtection[0]["cenc:default_KID"]?a.contentProtection[0]["cenc:default_KID"]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b},u=function(a){var b=new mp4lib.boxes.ProtectionSchemeInformationBox;return b.boxes.push(q(a)),b.boxes.push(r()),b.boxes.push(s(a)),b},v=function(a){var b=a.codecs.substring(0,a.codecs.indexOf("."));switch(b){case"avc1":return p(a);default:throw b+" not supported"}},w=function(a){for(var b=[];a.length>=2;)b.push(parseInt(a.substring(0,2),16)),a=a.substring(2,a.length);return b},x=function(a){var b,c,d,e,f,g,h;return b=w(a.codecPrivateData),c=b.length,d=new Uint8Array(2+c),d[0]=5,d[1]=c,d.set(b,2),e=13+d.length,f=new Uint8Array(2+e),f[0]=4,f[1]=e,f[2]=64,f[3]=20,f[3]|=0,f[3]|=1,f[4]=255,f[5]=255,f[6]=255,f[7]=(4278190080&a.bandwidth)>>24,f[8]=(16711680&a.bandwidth)>>16,f[9]=(65280&a.bandwidth)>>8,f[10]=255&a.bandwidth,f[11]=(4278190080&a.bandwidth)>>24,f[12]|=(16711680&a.bandwidth)>>16,f[13]|=(65280&a.bandwidth)>>8,f[14]|=255&a.bandwidth,f.set(d,15),g=3+f.length,h=new Uint8Array(2+g),h[0]=3,h[1]=g,h[2]=(65280&a.trackId)>>8,h[3]=255&a.trackId,h[4]=0,h.set(f,5),h},y=function(a){var b,c,d=null;return d=void 0!==a.contentProtection?new mp4lib.boxes.EncryptedAudioBox:new mp4lib.boxes.MP4AudioSampleEntryBox,d.reserved=[0,0,0,0,0,0],d.data_reference_index=1,d.reserved_2=[0,0],d.channelcount=a.channels,d.samplesize=16,d.pre_defined=0,d.reserved_3=0,d.samplerate=a.samplingRate<<16,b=new mp4lib.boxes.ESDBox,c=x(a),b.ES_tag=c[0],b.ES_length=c[1],b.ES_data=c.subarray(2,c.length),b.version=0,b.flags=0,d.boxes.push(b),void 0!==a.contentProtection&&d.boxes.push(u(a)),d},z=function(a){var b=a.codecs.substring(0,a.codecs.indexOf("."));switch(b){case"mp4a":return y(a);default:throw b+" not supported"}return null},A=function(a){var b=new mp4lib.boxes.SampleDescriptionBox;switch(b.version=0,b.flags=0,a.type){case"video":b.boxes.push(v(a));break;case"audio":b.boxes.push(z(a))}return b},B=function(a){var b=new mp4lib.boxes.SampleTableBox;return b.boxes.push(i(a)),b.boxes.push(j(a)),b.boxes.push(k(a)),b.boxes.push(l(a)),b.boxes.push(A(a)),b},C=function(){var a=new mp4lib.boxes.VideoMediaHeaderBox;return a.version=0,a.flags=1,a.graphicsmode=0,a.opcolor=[0,0,0],a},D=function(){var a=new mp4lib.boxes.SoundMediaHeaderBox;return a.version=0,a.balance=0,a.reserved=0,a.flags=1,a},E=function(){var a=new mp4lib.boxes.FileTypeBox;return a.major_brand=1769172790,a.minor_brand=1,a.compatible_brands=[],a.compatible_brands[0]=1769172845,a.compatible_brands[1]=1769172790,a.compatible_brands[2]=1836278888,a},F=function(a){var b,c,d,e=a[a.length-1];for(b=new mp4lib.boxes.MovieExtendsBox,d=0;d<a.length;d++)e=a[d],c=new mp4lib.boxes.TrackExtendsBox,c.version=0,c.flags=0,c.track_ID=e.trackId,c.default_sample_description_index=1,c.default_sample_duration=0,c.default_sample_flags=0,c.default_sample_size=0,b.boxes.push(c);return b},G=function(a){var b,c,d,e=[];for(d=0;d<a.length;d++)b=new Uint8Array(a[d].initData),c=new mp4lib.boxes.ProtectionSystemSpecificHeaderBox,c.read(b,8,b.length),e.push(c);return e},H=function(c){var d,e,f,g;for(d=new mp4lib.boxes.File,e=new mp4lib.boxes.MovieBox,e.boxes.push(a(c)),g=0;g<c.length;g++)e.boxes.push(b(c[g]));for(e.boxes.push(F(c)),g=0;g<c.length;g++)void 0!==c[g].contentProtection&&(f=this.protectionExt.getSupportedKeySystemsFromContentProtection(c[g].contentProtection),e.boxes.push.apply(e.boxes,G(f)));return d.boxes.push(E()),d.boxes.push(e),mp4lib.serialize(d)},I=function(a){var b=new mp4lib.boxes.MovieFragmentHeaderBox;return b.version=0,b.flags=0,b.sequence_number=a,b},J=function(a){var b=new mp4lib.boxes.TrackFragmentBox;return b.version=0,b.flags=0,b.boxes.push(K(a)),b.boxes.push(L(a)),b.boxes.push(M(a)),b},K=function(a){var b=new mp4lib.boxes.TrackFragmentHeaderBox;return b.version=0,b.flags=131072,b.track_ID=a.trackId,b},L=function(a){var b=new mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox;return b.version=1,b.flags=0,b.baseMediaDecodeTime=a.samples.length>0?a.samples[0].dts:0,b},M=function(a){var b,c,d,e=new mp4lib.boxes.TrackFragmentRunBox;for(c=a.samples[0].cts,d=a.samples[0].duration>0?256:0,e.version=0,e.flags=1|d|512|("video"===a.type?2048:0),e.data_offset=0,e.samples_table=[],e.sample_count=a.samples.length,b=0;b<a.samples.length;b++){var f={sample_duration:a.samples[b].duration,sample_size:a.samples[b].size,sample_composition_time_offset:a.samples[b].cts-a.samples[b].dts};f.sample_composition_time_offset<0&&(e.version=1),e.samples_table.push(f)}return e},N=function(a){var b=new mp4lib.boxes.MediaDataBox;return b.data=a.data,b},O=function(a,b){var c,d,e,f,g,h,i,j=0,k={},l=0;for(c=new mp4lib.boxes.File,d=new mp4lib.boxes.MovieFragmentBox,d.boxes.push(I(b)),e=0;e<a.length;e++)d.boxes.push(J(a[e]));for(c.boxes.push(d),f=c.getLength(),h=d.getBoxesByType("traf"),f+=8,i=[a.length],e=0;e<a.length;e++)h[e].getBoxByType("trun").data_offset=f,f+=a[e].data.length,i[e]=a[e].data,j+=i[e].length;for(k.data=new Uint8Array(j),e=0;e<i.length;e++)k.data.set(i[e],l),l+=i[e].length;return c.boxes.push(N(k)),g=mp4lib.serialize(c)};return{protectionExt:void 0,generateInitSegment:H,generateMediaSegment:O}},MediaPlayer.dependencies.Mp4Processor.prototype={constructor:MediaPlayer.dependencies.Mp4Processor},MediaPlayer.models.ProtectionModel={},MediaPlayer.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged"},MediaPlayer.models.ProtectionModel_01b=function(){var a,b=null,c=null,d=[],e=[],f=function(){var b=this;return{handleEvent:function(f){var g=null;switch(f.type){case c.needkey:b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(f.initData,"cenc"));break;case c.keyerror:if(g=h(e,f.sessionId),g||(g=h(d,f.sessionId)),g){var i="",j=null;switch(f.errorCode.code){case 1:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN,i+="An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_CLIENT,i+="The Key System could not be installed or updated.";break;case 3:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVICE,i+="The message passed into update indicated an error from the license service.";

break;case 4:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT,i+="There is no available output device with the required characteristics for the content protection system.";break;case 5:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_HARDWARECHANGE,i+="A hardware configuration change caused a content protection error.";break;case 6:j=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_DOMAIN,i+="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}var k={};k.sessionToken=g,k.systemCode=f.systemCode,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.Error(j,i,k))}else b.log("No session token found for key error");break;case c.keyadded:g=h(e,f.sessionId),g||(g=h(d,f.sessionId)),g?b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,g):b.log("No session token found for key added");break;case c.keymessage:if(a=null!==f.sessionId&&void 0!==f.sessionId)g=h(e,f.sessionId),!g&&d.length>0&&(g=d.shift(),e.push(g),g.sessionID=f.sessionId);else if(d.length>0&&(g=d.shift(),e.push(g),0!==d.length)){var k={};k.sessionToken=g,k.systemCode=null,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_MULTIKEYS_UNSUPPORTED,f.message+"Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",k))}if(g)g.keyMessage=f.message,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(g,f.message,f.defaultURL));else{var l="No session token found for key message";b.log(l),b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION,l,null))}}}}},g=null,h=function(a,b){if(b&&a){for(var c=a.length,d=0;c>d;d++)if(a[d].sessionID==b)return a[d];return null}return null},i=function(){b.removeEventListener(c.keyerror,g),b.removeEventListener(c.needkey,g),b.removeEventListener(c.keymessage,g),b.removeEventListener(c.keyadded,g)};return{system:void 0,log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){g=f.call(this)},init:function(){var a=document.createElement("video");c=MediaPlayer.models.ProtectionModel_01b.detect(a)},teardown:function(){b&&i();for(var a=0;a<e.length;a++)this.closeKeySession(e[a])},requestKeySystemAccess:function(a){var c=b;c||(c=document.createElement("video"));for(var d=!1,e=0;e<a.length;e++)for(var f=a[e].ks.systemString,g=a[e].configs,h=null,i=null,j=0;j<g.length;j++){var k=g[j].videoCapabilities;if(k&&0!==k.length){i=[];for(var l=0;l<k.length;l++)""!==c.canPlayType(k[l].contentType,f)&&i.push(k[l])}if(!(!h&&!i||h&&0===h.length||i&&0===i.length)){d=!0;var m=new MediaPlayer.vo.protection.KeySystemConfiguration(h,i),n=this.protectionExt.getKeySystemBySystemString(f),o=new MediaPlayer.vo.protection.KeySystemAccess(n,m);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,o);break}}d||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(a){this.keySystem=a.keySystem,this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(a){b&&i(),b=a,b.addEventListener(c.keyerror,g),b.addEventListener(c.needkey,g),b.addEventListener(c.keymessage,g),b.addEventListener(c.keyadded,g),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)},createKeySession:function(f){if(!this.keySystem)throw new Error("Can not create sessions until you have selected a key system");var g;for(g=0;g<e.length;g++)if(this.protectionExt.initDataEquals(f,e[g].initData))return;for(g=0;g<d.length;g++)if(this.protectionExt.initDataEquals(f,d[g].initData))return;if(a||0===e.length){var h={prototype:(new MediaPlayer.models.SessionToken).prototype,sessionID:null,initData:f,getSessionID:function(){return this.sessionID}};return d.push(h),b[c.generateKeyRequest](this.keySystem.systemString,new Uint8Array(f)),h}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(a,d){var e=a.sessionID;if(this.protectionExt.isClearKey(this.keySystem))for(var f=0;f<d.keyPairs.length;f++)b[c.addKey](this.keySystem.systemString,d.keyPairs[f].key,d.keyPairs[f].keyID,e);else b[c.addKey](this.keySystem.systemString,d,a.initData,e)},closeKeySession:function(a){b[c.cancelKeyRequest](this.keySystem.systemString,a.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_01b.prototype={constructor:MediaPlayer.models.ProtectionModel_01b},MediaPlayer.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],MediaPlayer.models.ProtectionModel_01b.detect=function(a){for(var b=MediaPlayer.models.ProtectionModel_01b.APIs,c=0;c<b.length;c++){var d=b[c];if("function"==typeof a[d.generateKeyRequest]&&"function"==typeof a[d.addKey]&&"function"==typeof a[d.cancelKeyRequest])return d}return null},MediaPlayer.models.ProtectionModel_3Feb2014=function(){var a=null,b=null,c=null,d=null,e=[],f=function(){var a=this;return{handleEvent:function(b){switch(b.type){case d.needkey:a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(b.initData,"cenc"))}}}},g=null,h=function(){var c=this,e=function(){a[d.setMediaKeys](b),c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED),a.removeEventListener("loadedmetadata",e)};a.readyState>=1?e.call(this):a.addEventListener("loadedmetadata",e)},i=function(a,b){var c=this;return{prototype:(new MediaPlayer.models.SessionToken).prototype,session:a,initData:b,handleEvent:function(a){switch(a.type){case d.error:var b="KeyError",e={};e.sessionToken=this,e.systemCode=null,c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYERR,b,e));break;case d.message:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,a.message,a.destinationURL));break;case d.ready:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case d.close:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId}}};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,debug:void 0,keySystem:null,setup:function(){g=f.call(this)},init:function(){var a=document.createElement("video");d=MediaPlayer.models.ProtectionModel_3Feb2014.detect(a)},teardown:function(){a&&a.removeEventListener(d.needkey,g);for(var b=0;b<e.length;b++)this.closeKeySession(e[b])},requestKeySystemAccess:function(a){for(var b=!1,c=0;c<a.length;c++)for(var e=a[c].ks.systemString,f=a[c].configs,g=null,h=null,i=0;i<f.length;i++){var j=f[i].audioCapabilities,k=f[i].videoCapabilities;if(j&&0!==j.length){g=[];for(var l=0;l<j.length;l++)window[d.MediaKeys].isTypeSupported(e,j[l].contentType)&&g.push(j[l])}if(k&&0!==k.length){h=[];for(var m=0;m<k.length;m++)window[d.MediaKeys].isTypeSupported(e,k[m].contentType)&&h.push(k[m])}if(!(!g&&!h||g&&0===g.length||h&&0===h.length)){b=!0;var n=new MediaPlayer.vo.protection.KeySystemConfiguration(g,h),o=this.protectionExt.getKeySystemBySystemString(e),p=new MediaPlayer.vo.protection.KeySystemAccess(o,n);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,p);break}}b||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"[DRM][3Feb2014] Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(e){try{b=e.mediaKeys=new window[d.MediaKeys](e.keySystem.systemString),this.keySystem=e.keySystem,c=e,a&&h.call(this),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(f){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(c){a&&a.removeEventListener(d.needkey,g),a=c,a.addEventListener(d.needkey,g),b&&h.call(this)},createKeySession:function(a,f,g){if(!this.keySystem||!b||!c)throw new Error("Can not create sessions until you have selected a key system");for(var h=0;h<e.length;h++)if(this.protectionExt.initDataEquals(a,e[h].initData))return;var j=c.ksConfiguration.videoCapabilities[0].contentType,k=b.createSession(j,new Uint8Array(a),g?new Uint8Array(g):null),l=i.call(this,k,a);k.addEventListener(d.error,l),k.addEventListener(d.message,l),k.addEventListener(d.ready,l),k.addEventListener(d.close,l),e.push(l),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,l)},updateKeySession:function(a,b){var c=a.session;c.update(this.protectionExt.isClearKey(this.keySystem)?new Uint8Array(b.toJWK()):b)},closeKeySession:function(a){var b=a.session;b.removeEventListener(d.error,a),b.removeEventListener(d.message,a),b.removeEventListener(d.ready,a),b.removeEventListener(d.close,a);for(var c=0;c<e.length;c++)if(e[c]===a){e.splice(c,1);break}b[d.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}],MediaPlayer.models.ProtectionModel_3Feb2014.detect=function(a){for(var b=MediaPlayer.models.ProtectionModel_3Feb2014.APIs,c=0;c<b.length;c++){var d=b[c];if("function"==typeof a[d.setMediaKeys]&&"function"==typeof window[d.MediaKeys])return d}return null},MediaPlayer.models.ProtectionModel_3Feb2014.prototype={constructor:MediaPlayer.models.ProtectionModel_3Feb2014},MediaPlayer.models.ProtectionModel_21Jan2015=function(){var a=null,b=null,c=[],d=function(a,b){var c=this;!function(b){var e=a[b].ks,f=a[b].configs;navigator.requestMediaKeySystemAccess(e.systemString,f).then(function(a){var b="function"==typeof a.getConfiguration?a.getConfiguration():null,d=new MediaPlayer.vo.protection.KeySystemAccess(e,b);d.mksa=a,c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,d)})["catch"](function(){++b<a.length?d.call(c,a,b):c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})}(b)},e=function(){var a=this;return{handleEvent:function(b){switch(b.type){case"encrypted":a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(b.initData,b.initDataType))}}}},f=null,g=function(a){for(var b=0;b<c.length;b++)if(c[b]===a){c.splice(b,1);break}},h=function(a,b){var d=this,e={prototype:(new MediaPlayer.models.SessionToken).prototype,session:a,initData:b,handleEvent:function(a){switch(a.type){case"keystatuseschange":a.target.keyStatuses.forEach(function(a,b){switch(a){case"expired":d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED,"License has expired!!!",null));break;case"usable":case"status-pending":default:d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,{status:a,keyId:b})}});break;case"message":d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,a.message,void 0,a.messageType))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},getKeyStatuses:function(){return this.session.keyStatuses}};return a.addEventListener("keystatuseschange",e),a.addEventListener("message",e),a.closed.then(function(){g(e),d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,e.getSessionID())}),c.push(e),e};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){f=e.call(this)},init:function(){},teardown:function(){a&&(a.removeEventListener("encrypted",f),a.setMediaKeys(null));for(var b=0;b<c.length;b++)this.closeKeySession(c[b])},requestKeySystemAccess:function(a){d.call(this,a,0)},selectKeySystem:function(c){var d=this;c.mksa.createMediaKeys().then(function(e){d.keySystem=c.keySystem,b=e,a&&a.setMediaKeys(b),d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)})["catch"](function(){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+c.keySystem.systemString+")! Could not create MediaKeys -- TODO")})},setMediaElement:function(c){a&&a.removeEventListener("encrypted",f),a=c,a.addEventListener("encrypted",f),b&&a.setMediaKeys(b)},setServerCertificate:function(a){if(!this.keySystem||!b)throw new Error("Can not set server certificate until you have selected a key system");var c=this;b.setServerCertificate(a).then(function(){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)})["catch"](function(a){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,null,"Error updating server certificate -- "+a.name)})},createKeySession:function(a,d){if(!this.keySystem||!b)throw new Error("Can not create sessions until you have selected a key system");for(var e=0;e<c.length;e++)if(this.protectionExt.initDataEquals(a,c[e].initData))return;var f=b.createSession(d),i=h.call(this,f,a),j=this;f.generateRequest("cenc",a).then(function(){j.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,i)})["catch"](function(a){g(i),j.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Error generating key request -- "+a.name)})},updateKeySession:function(a,b){var c=a.session,d=this;this.protectionExt.isClearKey(this.keySystem)&&(b=b.toJWK()),c.update(b)["catch"](function(b){var c={},e=-1;switch(c.sessionToken=a,c.systemCode=null,b.code){case 22:case 15:case 11:case 9:default:e=MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR}d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.Error(e,"Error sending update() message! "+b.name,c))})},loadKeySession:function(a){if(!this.keySystem||!b)throw new Error("Can not load sessions until you have selected a key system");var c=b.createSession(),d=this;c.load(a).then(function(b){if(b){var e=h.call(this,c);d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)}else d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session! Invalid Session ID ("+a+")")})["catch"](function(b){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session ("+a+")! "+b.name)})},removeKeySession:function(a){var b=a.session,c=this;b.remove().then(function(){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,a.getSessionID())})["catch"](function(b){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,null,"Error removing session ("+a.getSessionID()+"). "+b.name)})},closeKeySession:function(a){var b=a.session;b.removeEventListener("keystatuseschange",a),b.removeEventListener("message",a);var c=this;b.close()["catch"](function(b){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,null,"Error closing session ("+a.getSessionID()+") "+b.name)})}}},MediaPlayer.models.ProtectionModel_21Jan2015.detect=function(a){return void 0===a.onencrypted||void 0===a.mediaKeys?!1:void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess?!1:!0},MediaPlayer.models.ProtectionModel_21Jan2015.prototype={constructor:MediaPlayer.models.ProtectionModel_21Jan2015},MediaPlayer.vo.protection.ClearKeyKeySet=function(a,b){if(b&&"persistent"!==b&&"temporary"!==b)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=a,this.type=b,this.toJWK=function(){var a,b=this.keyPairs.length,c={};for(c.keys=[],a=0;b>a;a++){var d={kty:"oct",alg:"A128KW",kid:this.keyPairs[a].keyID,k:this.keyPairs[a].key};c.keys.push(d)}this.type&&(c.type=this.type);var e=JSON.stringify(c),f=e.length,g=new ArrayBuffer(f),h=new Uint8Array(g);for(a=0;f>a;a++)h[a]=e.charCodeAt(a);return g}},MediaPlayer.vo.protection.ClearKeyKeySet.prototype={constructor:MediaPlayer.vo.protection.ClearKeyKeySet},MediaPlayer.vo.protection.KeyPair=function(a,b){"use strict";this.keyID=a,this.key=b},MediaPlayer.vo.protection.KeyPair.prototype={constructor:MediaPlayer.vo.protection.KeyPair},MediaPlayer.models.SessionToken=function(){"use strict"},MediaPlayer.models.SessionToken.prototype={initData:null,getSessionID:function(){return""},getExpirationTime:function(){return 0/0},getKeyStatuses:function(){return null}},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a,b,c=[],d=function(a){if(a.error)this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,a.error);else{var b=a.data;this.protectionModel.keySystem.doLicenseRequest(b.message,b.defaultURL,b.sessionToken)}},e=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,a.error)},f=function(a){a.error?this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,a.error):this.updateKeySession(a.data.requestData,a.data.message)},g=function(){this.protectionModel.keySystem.subscribe(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,this),this.keySystem||(this.keySystem=this.protectionModel.keySystem);for(var a=0;a<c.length;a++)this.createKeySession(c[a]);c=[]},h=function(d){if("cenc"===d.data.initDataType){var e=d.data.initData;if(this.keySystem)this.createKeySession(e,this.keySystem.cdmData);else if(void 0===this.keySystem){this.keySystem=null,c.push(e);try{this.protectionExt.autoSelectKeySystem(this.protectionExt.getSupportedKeySystems(e),this,b,a)}catch(f){this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_UNSUPPORTED,"[DRM] Unable to select a key system from needkey initData. -- "+f.message,null))}}else c.push(e)}},i=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED,"[DRM] KeySystem Access Denied! -- "+a.error,null))},j=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_UPDATE_CERTIFICATE_IMPOSSIBLE,"[DRM] Failed to update license server certificate. -- "+a.error,null))},k=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION,"[DRM] Failed to create key session. -- "+a.error,null))},l=function(){},m=function(a){this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,a.data.error)},n=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_CLOSE_SESSION,"[DRM] Failed to close key session. -- "+a.error,null))},o=function(a){a.error&&this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_REMOVE_SESSION,"[DRM] Failed to remove key session. -- "+a.error,null))};return{system:void 0,debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:void 0,manifestExt:void 0,sessionType:"temporary",setup:function(){this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=d.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=g.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=i.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY]=h.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=j.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=l.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=m.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=k.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=n.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=o.bind(this),this[MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE]=f.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=e.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init()},init:function(a){var b=this;this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.manifestExt.getVideoData(a,0).then(function(c){b.manifestExt.getPrimaryAudioData(a,0).then(function(a){b.manifestExt.getContentProtectionData(c).then(function(d){var e=b.protectionExt.getSupportedKeySystemsFromContentProtection(d);if(e&&e.length>0){var f={};f[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(a){if(a.error)b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,b),b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,b);else{b.keySystem=b.protectionModel.keySystem,b.keySystem.subscribe(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,b);for(var c=0;c<e.length;c++)if(b.keySystem===e[c].ks){b.createKeySession(e[c].initData,e[c].cdmData);break}}b.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,f)},b.keySystem=null,b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,f),b.protectionExt.autoSelectKeySystem(e,b,b.manifestExt.getCodec_(c),b.manifestExt.getCodec_(a))}else b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,b),b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,b)})})})},teardown:function(){this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,this),this.protectionModel.keySystem&&this.protectionModel.keySystem.unsubscribe(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.keySystem=void 0,this.protectionModel.teardown(),this.protectionModel=void 0},requestKeySystemAccess:function(a){this.protectionModel.requestKeySystemAccess(a)},selectKeySystem:function(a){if(this.protectionModel.keySystem)throw new Error("[DRM] KeySystem already selected!");this.protectionModel.selectKeySystem(a)},createKeySession:function(a,b){var c=MediaPlayer.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,a);if(c)try{this.protectionModel.createKeySession(c,this.sessionType,b)}catch(d){this.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION,"Error creating key session! "+d.message,null))}},updateKeySession:function(a,b){this.protectionModel.updateKeySession(a,b)},loadKeySession:function(a){this.protectionModel.loadKeySession(a)},removeKeySession:function(a){this.protectionModel.removeKeySession(a)},closeKeySession:function(a){this.protectionModel.closeKeySession(a)},setServerCertificate:function(a){this.protectionModel.setServerCertificate(a)},setMediaElement:function(a){this.protectionModel.setMediaElement(a)},setSessionType:function(a){this.sessionType=a},setProtectionData:function(a){this.protectionExt.init(a)}}},MediaPlayer.dependencies.ProtectionController.eventList={ENAME_PROTECTION_ERROR:"protectionError"},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict";this.system=void 0,this.debug=void 0,this.keySystems=[],this.clearkeyKeySystem=void 0},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,setup:function(){var a;a=this.system.getObject("ksPlayReady"),this.keySystems.push(a),a=this.system.getObject("ksWidevine"),this.keySystems.push(a),a=this.system.getObject("ksClearKey"),this.keySystems.push(a),this.clearkeyKeySystem=a},init:function(a){for(var b=(function(b){var c=null;return a&&(c=b in a?a[b]:null),c}),c=0;c<this.keySystems.length;c++){var d=this.keySystems[c];d.init(b(d.systemString))}},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(a){for(var b=0;b<this.keySystems.length;b++)if(this.keySystems[b].systemString===a)return this.keySystems[b];return null},isClearKey:function(a){return a===this.clearkeyKeySystem},initDataEquals:function(a,b){if(a.byteLength===b.byteLength){for(var c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0}return!1},getSupportedKeySystemsFromContentProtection:function(a){var b,c,d,e,f=[];if(a)for(d=0;d<this.keySystems.length;++d)for(c=this.keySystems[d],e=0;e<a.length;++e)if(b=a[e],b.schemeIdUri.toLowerCase()===c.schemeIdURI){var g=c.getInitData(b);g&&f.push({ks:this.keySystems[d],initData:g,cdmData:c.getCDMData()})}return f},getSupportedKeySystems:function(a){var b,c=[],d=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(a);for(b=0;b<this.keySystems.length;++b)this.keySystems[b].uuid in d&&c.push({ks:this.keySystems[b],initData:d[this.keySystems[b].uuid]});return c},autoSelectKeySystem:function(a,b,c,d){if(0===a.length)throw new Error("DRM system for this content not supported by the player!");var e=[],f=[];c&&f.push(new MediaPlayer.vo.protection.MediaCapability(c)),d&&e.push(new MediaPlayer.vo.protection.MediaCapability(d));for(var g=new MediaPlayer.vo.protection.KeySystemConfiguration(e,f),h=[],i=0;i<a.length;i++)h.push({ks:a[i].ks,configs:[g]});!function(a){var b={};b[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(b){if(a.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,this),b.error)a.notify(MediaPlayer.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED,"[DRM] KeySystem Access Denied! -- "+b.error,null));else{var c=b.data;a.selectKeySystem(c)}},a.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,b),a.requestKeySystemAccess(h)}(b)}},MediaPlayer.dependencies.protection.CommonEncryption={findCencContentProtection:function(a){for(var b=null,c=0;c<a.length;++c){var d=a[c];"urn:mpeg:dash:mp4protection:2011"===d.schemeIdUri.toLowerCase()&&"cenc"===d.value.toLowerCase()&&(b=d)}return b},getPSSHData:function(a){return a.slice(32)},getPSSHForKeySystem:function(a,b){var c=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(b);return c.hasOwnProperty(a.uuid.toLowerCase())?c[a.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(a){return"pssh"in a?BASE64.decodeArray(a.pssh.__text).buffer:null},readBytes:function(a,b,c){for(var d=0,e=0;c>e;e++)d<<=8,d+=a[b],b++;return d},parsePSSHList:function(a){if(null===a)return[];var b=a;a.buffer||(b=new Uint8Array(a));for(var c=!1,d={},e=0;!c;){var f,g,h,i,j,k=e;if(e>=b.byteLength)break;if(f=this.readBytes(b,e,4),g=e+f,e+=4,1886614376===this.readBytes(b,e,4))if(e+=4,h=this.readBytes(b,e,1),0===h||1===h){e+=1,e+=3,i="";var l,m;for(l=0;4>l;l++)m=this.readBytes(b,e+l,1).toString(16),i+=1===m.length?"0"+m:m;for(e+=4,i+="-",l=0;2>l;l++)m=this.readBytes(b,e+l,1).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;2>l;l++)m=this.readBytes(b,e+l,1).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;2>l;l++)m=this.readBytes(b,e+l,1).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;6>l;l++)m=this.readBytes(b,e+l,1).toString(16),i+=1===m.length?"0"+m:m;e+=6,i=i.toLowerCase(),j=this.readBytes(b,e,4),e+=4,d[i]=b.subarray(k,g).buffer,e=g}else e=g;else e=g}return d}},MediaPlayer.dependencies.protection.KeySystem={eventList:{ENAME_LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"}},MediaPlayer.dependencies.protection.KeySystem_Access=function(){"use strict"},MediaPlayer.dependencies.protection.KeySystem_Access.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Access},MediaPlayer.dependencies.protection.KeySystem_ClearKey=function(){"use strict";var a,b="org.w3.clearkey",c="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",d=function(b,c){
var d,e=this,f=a&&a.laURL&&""!==a.laURL?a.laURL:null,g=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b)));if(f){for(f+="/?",d=0;d<g.kids.length;d++)f+=g.kids[d]+"&";f=f.substring(0,f.length-1);var h=new XMLHttpRequest;h.onload=function(){if(200==h.status){for(h.response.hasOwnProperty("keys")||e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,"DRM: ClearKey Remote update, Illegal response JSON",null)),d=0;d<h.response.keys.length;d++){var a=h.response.keys[d],b=a.kid.replace(/=/g,"");k=a.k.replace(/=/g,""),i.push(new MediaPlayer.vo.protection.KeyPair(b,k))}var f=new MediaPlayer.vo.protection.LicenseRequestComplete(new MediaPlayer.vo.protection.ClearKeyKeySet(i),c);e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,f)}else e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: ClearKey Remote update, XHR aborted. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,null))},h.onabort=function(){e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ABORTED,'DRM: ClearKey update, XHR aborted. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,null))},h.onerror=function(){e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: ClearKey update, XHR error. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,null))},h.open("GET",f),h.responseType="json",h.send()}else if(a.clearkeys){var i=[];for(d=0;d<g.kids.length;d++){var j=g.kids[d],k=a.clearkeys.hasOwnProperty(j)?a.clearkeys[j]:null;k||this.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_KEY_UNKNOWN,"DRM: ClearKey keyID ("+j+") is not known!",null)),i.push(new MediaPlayer.vo.protection.KeyPair(j,k))}var l=new MediaPlayer.vo.protection.LicenseRequestComplete(new MediaPlayer.vo.protection.ClearKeyKeySet(i),c);this.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,l)}else e.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN,"DRM: ClearKey has no way (URL or protection data) to retrieve keys",null))};return{system:void 0,schemeIdURI:"urn:uuid:"+c,systemString:b,uuid:c,notify:void 0,subscribe:void 0,unsubscribe:void 0,init:function(b){a=b},doLicenseRequest:function(a,b,c){d.call(this,a,c)},getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getCDMData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_ClearKey},MediaPlayer.dependencies.protection.KeySystem_PlayReady=function(){"use strict";var a,b="com.microsoft.playready",c="9a04f079-9840-4286-ab92-e65be0885f95",d='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="true"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>',e=function(b,c,d){var e,f,g,h,i,j,k=null,l={},m=new DOMParser,n=this;if(j=new Uint16Array(b.buffer),i=String.fromCharCode.apply(null,j),h=m.parseFromString(i,"application/xml"),h.getElementsByTagName("Challenge")[0]){var o=h.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;o&&(k=BASE64.decode(o))}else n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NOCHALLENGE,"DRM: playready update, can not find Challenge in keyMessage",null));var p=h.getElementsByTagName("name"),q=h.getElementsByTagName("value");p.length!=q.length&&n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_INVALID_HEADER,"DRM: playready update, invalid header name/value pair in keyMessage",null));for(var r=0;r<p.length;r++)l[p[r].childNodes[0].nodeValue]=q[r].childNodes[0].nodeValue;a&&a.bearerToken&&(l.Authorization=a.bearerToken);var s=new XMLHttpRequest;if(s.onload=function(){if(200==s.status){var a=new MediaPlayer.vo.protection.LicenseRequestComplete(new Uint8Array(s.response),d);n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,a)}else n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: playready update, XHR status is "'+s.statusText+'" ('+s.status+"), expected to be 200. readyState is "+s.readyState,null))},s.onabort=function(){n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ABORTED,'DRM: playready update, XHR aborted. status is "'+s.statusText+'" ('+s.status+"), readyState is "+s.readyState,null))},s.onerror=function(){n.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: playready update, XHR error. status is "'+s.statusText+'" ('+s.status+"), readyState is "+s.readyState,null))},s.open("POST",a&&a.laURL&&""!==a.laURL?a.laURL:c),s.responseType="arraybuffer",g=a?a.httpRequestHeaders:null)for(f in g)l[f]=g[f];for(e in l)"authorization"===e.toLowerCase()&&(s.withCredentials=!0),s.setRequestHeader(e,l[e]);a&&a.withCredentials&&(s.withCredentials=!0),s.send(k)},f=function(a){var b,c,d,e,f,g=0,h=new Uint8Array([112,115,115,104,0,0,0,0]),i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),j=null;if("pro"in a)j=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;j=BASE64.decodeArray(a.prheader.__text)}return b=j.length,c=4+h.length+i.length+4+b,d=new ArrayBuffer(c),e=new Uint8Array(d),f=new DataView(d),f.setUint32(g,c),g+=4,e.set(h,g),g+=h.length,e.set(i,g),g+=i.length,f.setUint32(g,b),g+=4,e.set(j,g),g+=b,e.buffer},g=function(){return!1},h=function(){var b,c,e,f;if(a&&a.customData){for(b=[],f=0;f<a.customData.length;++f)b.push(a.customData.charCodeAt(f)),b.push(0);for(b=String.fromCharCode.apply(null,b),b=BASE64.encode(b),c=d.replace("%CUSTOMDATA%",b),e=[],f=0;f<c.length;++f)e.push(c.charCodeAt(f)),e.push(0);return new Uint8Array(e).buffer}return null};return{schemeIdURI:"urn:uuid:"+c,systemString:b,uuid:c,notify:void 0,subscribe:void 0,unsubscribe:void 0,init:function(b){a=b},doLicenseRequest:e,getInitData:f,initDataEquals:g,getCDMData:h}},MediaPlayer.dependencies.protection.KeySystem_PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_PlayReady},MediaPlayer.dependencies.protection.KeySystem_Widevine=function(){"use strict";var a,b="com.widevine.alpha",c="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",d=function(b,c,d){var e,f,g,h,i=new XMLHttpRequest,j={},k=this;if(h=a&&a.laURL&&""!==a.laURL?a.laURL:c){if(i.open("POST",h,!0),i.responseType="arraybuffer",i.onload=function(){if(200==this.status){var a=new MediaPlayer.vo.protection.LicenseRequestComplete(new Uint8Array(this.response),d);k.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,a)}else k.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: widevine update, XHR status is "'+i.statusText+'" ('+i.status+"), expected to be 200. readyState is "+i.readyState+".  Response is "+(this.response?String.fromCharCode.apply(null,new Uint8Array(this.response)):"NONE"),null))},i.onabort=function(){k.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ABORTED,'DRM: widevine update, XHR aborted. status is "'+i.statusText+'" ('+i.status+"), readyState is "+i.readyState,null))},i.onerror=function(){k.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_XHR_ERROR,'DRM: widevine update, XHR error. status is "'+i.statusText+'" ('+i.status+"), readyState is "+i.readyState,null))},f=a?a.httpRequestHeaders:null)for(e in f)j[e]=f[e];for(g in j)"authorization"===g.toLowerCase()&&(i.withCredentials=!0),i.setRequestHeader(g,j[g]);i.send(b)}else k.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_LICENSE_REQUEST_COMPLETE,null,new MediaPlayer.vo.Error(MediaPlayer.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN,"DRM: No valid Widevine Proxy Server URL specified!",null))},e=function(){return a.pssh?BASE64.decodeArray(a.pssh).buffer:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection()};return{schemeIdURI:"urn:uuid:"+c,systemString:b,uuid:c,notify:void 0,subscribe:void 0,unsubscribe:void 0,init:function(b){a=b},doLicenseRequest:d,getInitData:e,getCDMData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_Widevine.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Widevine},MediaPlayer.vo.protection.KeyMessage=function(a,b,c,d){"use strict";this.sessionToken=a,this.message=b,this.defaultURL=c,this.messageType=d},MediaPlayer.vo.protection.KeyMessage.prototype={constructor:MediaPlayer.vo.protection.KeyMessage},MediaPlayer.vo.protection.LicenseRequestComplete=function(a,b){"use strict";this.message=a,this.requestData=b},MediaPlayer.vo.protection.LicenseRequestComplete.prototype={constructor:MediaPlayer.vo.protection.LicenseRequestComplete},MediaPlayer.vo.protection.NeedKey=function(a,b){this.initData=a,this.initDataType=b},MediaPlayer.vo.protection.NeedKey.prototype={constructor:MediaPlayer.vo.protection.NeedKey},MediaPlayer.vo.protection.ProtectionData=function(a,b,c,d){this.laURL=a,this.httpRequestHeaders=b,this.bearerToken=c,this.clearkeys=d},MediaPlayer.vo.protection.ProtectionData.prototype={constructor:MediaPlayer.vo.protection.ProtectionData},MediaPlayer.vo.protection.KeySystemAccess=function(a,b){this.keySystem=a,this.ksConfiguration=b},MediaPlayer.vo.protection.KeySystemAccess.prototype={constructor:MediaPlayer.vo.protection.KeySystemAccess},MediaPlayer.vo.protection.KeySystemConfiguration=function(a,b,c,d){this.initDataTypes=["cenc"],this.audioCapabilities=a,this.videoCapabilities=b,this.distinctiveIdentifier=c,this.persistentState=d},MediaPlayer.vo.protection.KeySystemConfiguration.prototype={constructor:MediaPlayer.vo.protection.KeySystemConfiguration},MediaPlayer.vo.protection.MediaCapability=function(a,b){this.contentType=a,this.robustness=b},MediaPlayer.vo.protection.MediaCapability.prototype={constructor:MediaPlayer.vo.protection.MediaCapability},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return Q.when(g)}}},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b,c,d,e=3600,f=60,g="http://www.w3.org/2006/10/ttaf1",h="http://www.w3.org/2006/10/ttaf1#parameter",i="http://www.w3.org/2006/10/ttaf1#styling",j="http://www.w3.org/ns/ttml",k="http://www.w3.org/ns/ttml#parameter",l="http://www.w3.org/ns/ttml#styling",m=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,n=/^\d+(\.\d+|)(h|m|s|ms|f)$/,o=function(a){var b,c,g,h;if(m.test(a))return b=a.split(":"),c=parseFloat(b[0])*e+parseFloat(b[1])*f+parseFloat(b[2]),b[3]&&(g=d.tt.frameRate,g&&!isNaN(g)&&(c+=parseFloat(b[3])/g)),c;if(n.test(a)){switch("ms"==a.substr(a.length-2)?(c=parseFloat(a.substr(0,a.length-3)),h=a.substr(a.length-2)):(c=parseFloat(a.substr(0,a.length-2)),h=a.substr(a.length-1)),h){case"h":c=60*c*60;break;case"m":c=60*c;break;case"s":break;case"ms":c=.01*c;break;case"f":if(g=d.tt.frameRate,!g||isNaN(g))return 0/0;c/=g}return c}return 0/0},p=function(){var a=!1,b=d.hasOwnProperty("tt"),c=b?d.tt.hasOwnProperty("head"):!1,e=c?d.tt.head.hasOwnProperty("layout"):!1,f=c?d.tt.head.hasOwnProperty("styling"):!1,g=b?d.tt.hasOwnProperty("body"):!1;return b&&c&&e&&f&&g&&(a=!0),a},q=function(a,b){var c=Object.keys(a).filter(function(c){return"xmlns"===c.split(":")[0]&&a[c]===b}).map(function(a){var b=a.split(":");return b.length>1?a.split(":")[1]+":":""});return 0===c.length&&(c[0]=""),c},r=function(a,b){var c=null;switch(b){case"ttml":c=q(a,g),1===c.length&&""===c[0]&&(c=q(a,j));break;case"style":c=q(a,i),1===c.length&&""===c[0]&&(c=q(a,l));break;case"parameter":c=q(a,k),1===c.length&&""===c[0]&&(c=q(a,h))}return c},s=function(a,b,c){var d=0;if(a)for(d=0;d<a[b].length;d++){var e=a[b][d];if(e["xml:id"]===c)return e}return null},t=function(a,b,c){var d=0;for(d=0;d<b.length;d++)if(a.hasOwnProperty(""===b[d]?c:b[d]+c))return a[b[d]+c];return null},u=function(c,d,e,f,g){var h,i=null,j=e,k=f,l=s(c.head.layout,"region_asArray",t(d,j,"region"));if(l&&(j=r(l,"ttml"),k=r(l,"style"),k=b.concat(k),j=a.concat(j),i=t(l,k,g),!i))for(h=s(c.head.styling,"style_asArray",t(l,j,"style"));!i&&h;)i=t(h,k,g),i||(h=s(c.head.styling,"style_asArray",t(h,j,"style")),j=r(h,"ttml"),k=r(h,"style"),k=b.concat(k),j=a.concat(j));return i},v=function(a,b,c,d,e){var f=null,g=c,h=d;if(f=t(b,h,e),!f){var i=s(a.head.styling,"style_asArray",t(b,g,"style"));i?(f=t(i,h,e),f||(f=u(a,b,g,h,e))):f=u(a,b,g,h,e)}return f},w=function(e){var f,g,h,i,j,k,l,m,n,q=[],s=new X2JS([],"",!1),u={backgroundColor:null,color:null,fontSize:null,fontFamily:null};try{if(d=s.xml_str2json(e),!p())return f="TTML document has incorrect structure",Q.reject(f);a=r(d.tt,"ttml"),c=r(d.tt,"parameter"),b=r(d.tt,"style");var w=t(d.tt,c,"frameRate");if(w&&(d.tt.frameRate=parseInt(w,10)),!d.tt.body.div_asArray)return f="TTML document does not contain any div",Q.reject(f);if(g=d.tt.body.div_asArray[0].p_asArray,!g||0===g.length)return f="TTML document does not contain any cues",Q.reject(f);for(n=0;n<g.length;n+=1){m=null,h=g[n],k=r(h,"ttml"),l=r(h,"style");var x=a.concat(k);i=o(t(h,x,"begin")),j=o(t(h,x,"end"));var y=b.concat(l);if(isNaN(i)||isNaN(j))return f="TTML document has incorrect timing value",Q.reject(f);u.backgroundColor=v(d.tt,h,x,y,"backgroundColor"),u.color=v(d.tt,h,x,y,"color"),u.fontSize=v(d.tt,h,x,y,"fontSize"),u.fontFamily=v(d.tt,h,x,y,"fontFamily");var z=v(d.tt,h,x,y,"extent");"%"===u.fontSize[u.fontSize.length-1]&&z&&(z=z.split(" ")[1],z=parseFloat(z.substr(0,z.length-1)),u.fontSize=parseInt(u.fontSize.substr(0,u.fontSize.length-1))*z/100+"%"),m={start:i,end:j,data:h.__text,line:80,style:u},q.push(m)}return Q.when(q)}catch(A){return f=A.message,Q.reject(f)}};return{parse:w}},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var a;return{eventBus:void 0,setup:function(){a=window.VTTCue||window.TextTrackCue},subtitlesStyleChanged:function(a){this.eventBus.dispatchEvent({type:"subtitlesStyleChanged",data:a})},addTextTrack:function(b,c,d,e,f){var g=null;g=0===b.textTracks.length?b.addTextTrack("subtitles",d,e):b.textTracks[0],g["default"]=f,g.mode="showing";for(var h in c){var i=c[h];g.addCue(new a(i.start,i.end,i.data))}return Q.when(g)},onCueEnter:function(a){this.subtitlesStyleChanged(a.currentTarget.style)},addCues:function(b,c){for(var d in c){var e=c[d],f=new a(e.start,e.end,e.data);f.onenter=this.onCueEnter.bind(this),f.snapToLines=!1,f.line=d>0&&e.start<=c[d-1].end?c[d-1].line+parseFloat(e.style.fontSize.substr(0,e.style.fontSize.length-1))+3:e.line,e.style&&(f.style=e.style),b.addCue(f)}},deleteCues:function(a,b){if(a){var c=a.textTracks[0];if(c){var d=c.cues;if(d)for(var e=d.length-1,f=e;f>=0;f-=1)c.removeCue(d[f]);b&&(c.mode="disabled")}}}}},MediaPlayer.dependencies.TextSourceBuffer=function(){var a,b,c;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(d,e){c=d,a=e.getVideoModel().getElement(),b=e.getData()},append:function(c){var d=this,e=String.fromCharCode.apply(null,new Uint16Array(c));d.getParser().parse(e).then(function(c){var e=b.Representation_asArray[0].id,f=b.lang;d.getTextTrackExtensions().addTextTrack(a,c,e,f,!0).then(function(){d.eventBus.dispatchEvent({type:"updateend"})})},function(a){d.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.CC_ERR_PARSE,a,e)})},abort:function(){this.getTextTrackExtensions().deleteCues(a)},getParser:function(){var a;return"text/vtt"===c?a=this.system.getObject("vttParser"):"application/ttml+xml"===c&&(a=this.system.getObject("ttmlParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.dependencies.TextController=function(){var a,b,c,d,e="LOADING",f="READY",g=!1,h=null,i=f,j=function(a){i=a},k=function(){if(g&&i===f){var a=this;a.indexHandler.getInitRequest(d[0]).then(function(b){a.fragmentLoader.load(b).then(n.bind(a,b),o.bind(a,b)),j.call(a,e)})}},l=function(){k.call(this)},m=function(a,b){var c=this,d=Q.defer(),e=c.manifestModel.getValue();return c.manifestExt.getDataIndex(a,e,b.index).then(function(a){c.manifestExt.getAdaptationsForPeriod(e,b).then(function(b){c.manifestExt.getRepresentationsForAdaptation(e,b[a]).then(function(a){d.resolve(a)})})}),d.promise},n=function(a,b){var d=this;d.fragmentController.process(b.data,a).then(function(a){null!==a&&d.sourceBufferExt.append(c,a,d.videoModel)})},o=function(){};return{videoModel:void 0,fragmentLoader:void 0,fragmentController:void 0,indexHandler:void 0,sourceBufferExt:void 0,manifestModel:void 0,manifestExt:void 0,debug:void 0,initialize:function(a,b,c,d,e){var f=this;f.setVideoModel(d),f.setBuffer(c),f.setMediaSource(e),f.updateData(b,a).then(function(){g=!0,k.call(f)})},setPeriodInfo:function(a){h=a},getPeriodIndex:function(){return h.index},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getData:function(){return b},setData:function(a){b=a},getBuffer:function(){return c},setBuffer:function(a){c=a},setMediaSource:function(b){a=b},updateData:function(a,c){var e=this,g=Q.defer();return b=a,h=c,m.call(e,b,h).then(function(a){d=a,j.call(e,f),k.call(e),g.resolve()}),g.promise},reset:function(b){b||(this.sourceBufferExt.abort(a,c),this.sourceBufferExt.removeSourceBuffer(a,c))},start:l}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextTTMLXMLMP4SourceBuffer=function(){var a,b,c,d,e={length:0,ranges:[],start:function(a){return this.ranges[a].start},end:function(a){return this.ranges[a].end},addRange:function(a,b){this.ranges.push({start:a,end:b}),this.length=this.length+1,this.ranges.sort(function(a,b){return a.start-b.start})},removeRange:function(a,b){for(var c=this.ranges.length-1;c>=0;c--)this.ranges[c].start>=a&&this.ranges[c].end<=b&&this.ranges.splice(c,1);this.length=this.ranges.length},reset:function(){this.length=0,this.ranges=[]}};return{updating:!1,system:void 0,eventBus:void 0,buffered:e,textTrackExtensions:void 0,ttmlParser:void 0,initialize:function(f,g,h){b=f,a=g.getVideoModel().getElement(),e.reset(),c=h.lang,d=h.id},remove:function(b,c){if(0>b||b>=c)throw"INVALID_ACCESS_ERR";this.getTextTrackExtensions().deleteCues(a,!1),this.buffered.removeRange(b,c)},append:function(b){var e=this,f=mp4lib.deserialize(b),g=f.getBoxByType("moov");if(g){var h=g.getBoxByType("mvhd");return e.timescale=h.timescale,void e.textTrackExtensions.addTextTrack(a,[],d,c,!0).then(function(a){e.track=a,e.eventBus.dispatchEvent({type:"updateend"})})}var i=f.getBoxByType("moof");if(i){var j=f.getBoxByType("mdat"),k=i.getBoxByType("traf"),l=k.getBoxByType("tfhd"),m=k.getBoxByType("tfdt"),n=k.getBoxByType("trun"),o=m.baseMediaDecodeTime/e.timescale,p=0;p=256&n.flags?n.samples_table[0].sample_duration/e.timescale:l.default_sample_duration/e.timescale,e.buffered.addRange(o,o+p),e.convertUTF8ToString(j.data).then(function(a){e.ttmlParser.parse(a).then(function(a){var b;if(a){for(b=0;b<a.length;b++)a[b].start=a[b].start+o,a[b].end=a[b].end+o;e.textTrackExtensions.addCues(e.track,a),e.eventBus.dispatchEvent({type:"updateend"})}})})}},convertUTF8ToString:function(a){var b=Q.defer(),c=new Blob([a],{type:"text/xml"}),d=new FileReader;return d.onload=function(a){b.resolve(a.target.result)},d.readAsText(c),b.promise},abort:function(){this.getTextTrackExtensions().deleteCues(a,!0)},getTextTrackExtensions:function(){return this.textTrackExtensions},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c),this.updating||this.eventBus.dispatchEvent({type:"updateend"})},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextTTMLXMLMP4SourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextTTMLXMLMP4SourceBuffer},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],DVRInfo:[],ManifestUpdate:[],RepBoundariesList:[],BandwidthBoundariesList:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;for(var b in this.streamMetrics)this.streamMetrics.hasOwnProperty(b)&&delete this.streamMetrics[b];this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,"TcpConnection",g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=new MediaPlayer.vo.metrics.HTTPRequest;return o.stream=a,o.tcpid=b,o.type=c,o.url=d,o.actualurl=e,o.range=f,o.trequest=g,o.tresponse=h,o.tfinish=i,o.responsecode=j,o.interval=k,o.mediaduration=l,o.startTime=m,o.quality=n,this.getMetricsFor(a).HttpList.push(o),this.getMetricsFor(a).HttpList.length>10&&this.getMetricsFor(a).HttpList.shift(),this.metricAdded(a,"HttpRequest",o),o},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),this.metricUpdated(a.stream,"HttpRequestTrace",a),e},addRepresentationBoundaries:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.RepresentationBoundaries;return e.t=b,e.min=c,e.max=d,this.getMetricsFor(a).RepBoundariesList.push(e),this.metricAdded(a,"RepresentationBoundaries",e),e},addBandwidthBoundaries:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.BandwidthBoundaries;return e.t=b,e.min=c,e.max=d,this.getMetricsFor(a).BandwidthBoundariesList.push(e),this.metricAdded(a,"BandwidthBoundaries",e),e},addRepresentationSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.RepresentationSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,"RepresentationSwitch",f),f},addState:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.State;return e.current=b,e.position=c,e.reason=d,this.metricAdded(a,"State",e),e},addSession:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.Session;return f.uri=b,f.loopMode=c?1:0,f.endTime=d,f.playerType=e,this.metricAdded(a,"Session",f),f},addCondition:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.Condition;return g.isFullScreen=b,g.windowSize=c+"x"+d,g.fps=f,g.droppedFrames=e,this.metricAdded(a,"Condition",g),g},addMetaData:function(){this.metricAdded(null,"ManifestReady",null)},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.getMetricsFor(a).BufferLevel.length>10&&this.getMetricsFor(a).BufferLevel.shift(),this.metricAdded(a,"BufferLevel",d),d},addDVRInfo:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.DVRInfo;return e.time=b,e.range=d,e.mpd=c,this.getMetricsFor(a).DVRInfo.push(e),this.metricAdded(a,"DVRInfo",e),e},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,c.decodedFrameCount=b.totalVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,"DroppedFrames",c),c)},addManifestUpdate:function(a,b,c,d,e,f,g,h,i,j){var k=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return k.streamType=a,k.type=b,k.requestTime=c,k.fetchTime=d,k.availabilityStartTime=e,k.presentationStartTime=f,k.clientTimeOffset=g,k.currentTime=h,k.buffered=i,k.latency=j,l.ManifestUpdate.push(k),this.metricAdded(a,"ManifestUpdate",k),k},updateManifestUpdateInfo:function(a,b){for(var c in b)a[c]=b[c];this.metricUpdated(a.streamType,"ManifestUpdate",a)},addManifestUpdatePeriodInfo:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.ManifestUpdate.PeriodInfo;return f.id=b,f.index=c,f.start=d,f.duration=e,a.periodInfo.push(f),this.metricUpdated(a.streamType,"ManifestUpdatePeriodInfo",a),f},addManifestUpdateRepresentationInfo:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.ManifestUpdate.RepresentationInfo;return i.id=b,i.index=c,i.periodIndex=d,i.streamType=e,i.startNumber=g,i.segmentInfoType=h,i.presentationTimeOffset=f,a.representationInfo.push(i),this.metricUpdated(a.streamType,"ManifestUpdateRepresentationInfo",a),i},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.getMetricsFor(a).PlayList.length>10&&this.getMetricsFor(a).PlayList.shift(),this.metricAdded(a,"PlayList",e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),a.trace.length>10&&a.trace.shift(),this.metricUpdated(a.stream,"PlayListTrace",a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[],this.startTime=null,this.quality=null,this.bytesLength=null},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.streamType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.periodInfo=[],this.representationInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.PeriodInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.RepresentationInfo=function(){"use strict";this.id=null,this.index=null,this.streamType=null,this.periodIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.segmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.PeriodInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.PeriodInfo},MediaPlayer.vo.metrics.ManifestUpdate.RepresentationInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.RepresentationInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection},MediaPlayer.vo.metrics.BandwidthBoundaries=function(){"use strict";this.t=null,this.min=null,this.max=null},MediaPlayer.vo.metrics.BandwidthBoundaries.prototype={
constructor:MediaPlayer.vo.metrics.BandwidthBoundaries},MediaPlayer.vo.metrics.RepresentationBoundaries=function(){"use strict";this.t=null,this.min=null,this.max=null},MediaPlayer.vo.metrics.RepresentationBoundaries.prototype={constructor:MediaPlayer.vo.metrics.RepresentationBoundaries},MediaPlayer.vo.metrics.State=function(){"use strict";this.t=null,this.current=null,this.position=null,this.reason=null},MediaPlayer.vo.metrics.State.prototype={constructor:MediaPlayer.vo.metrics.State},MediaPlayer.vo.metrics.Session=function(){"use strict";this.uri=null,this.loopMode=null,this.endTime=null,this.playerType=null},MediaPlayer.vo.metrics.Session.prototype={constructor:MediaPlayer.vo.metrics.Session},MediaPlayer.vo.metrics.Condition=function(){"use strict";this.isFullScreen=null,this.windowSize=null,this.droppedFrames=null,this.fps=null,this.bandwidth=null},MediaPlayer.vo.metrics.Condition.prototype={constructor:MediaPlayer.vo.metrics.Condition},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapClass("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null,this.liveEdge=0/0},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.availabilityIdx=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},Dash.vo.Event=function(){"use strict";this.duration=0/0,this.presentationTime=0/0,this.id=0/0,this.messageData="",this.eventStream=null,this.presentationTimeDelta=0/0},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=(new Date,null),g=null;try{c=d.xml_str2json(a),f=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),g=new Date}catch(h){var i={};return i.mpdUrl=b,this.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE,"parsing the manifest failed",i),Q.reject(h)}return Q.when(c)};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=null,f=function(a,b){for(;a.length<b;)a="0"+a;return a},g=function(a,b,c){for(var d,e,g,h,i=0,j=0,k=b.length,l="%0",m=l.length;;){if(i=a.indexOf("$"+b),0>i)return a;if(j=a.indexOf("$",i+k),0>j)return a;if(d=a.indexOf(l,i+k),d>i&&j>d)switch(e=a.charAt(j-1),g=parseInt(a.substring(d+m,j-1),10),e){case"d":case"i":case"u":h=f(c.toString(),g);break;case"x":h=f(c.toString(16),g);break;case"X":h=f(c.toString(16),g).toUpperCase();break;case"o":h=f(c.toString(8),g);break;default:return a}else h=c;a=a.substring(0,i)+h+a.substring(j+1)}},h=function(a){return a.split("$$").join("$")},i=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},j=function(a,b){return a.representation.startNumber+b},k=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")||-1!==a.indexOf("https://")?a:d+a},l=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.SegmentRequest;return d=a.adaptation.period,g.streamType=c,g.type="Initialization Segment",g.url=k(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g},m=function(a){var b=Q.defer(),d=null,e=null,f=this;return a?(a.initialization?(d=l.call(f,a,c),b.resolve(d)):(e=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,f.baseURLExt.loadInitialization(e).then(function(g){a.range=g,a.initialization=e,d=l.call(f,a,c),b.resolve(d)},function(a){b.reject(a)})),b.promise):Q.reject("no represenation")},n=function(a){var c,f,g,h=a.adaptation.period,i=!1;return(null===e||e>a.segments[0].availabilityIdx)&&(e=a.segments[0].availabilityIdx),b?i=!1:0>d?i=!1:d<a.availableSegmentsNumber+e?(f=A(d,a),f&&(g=f.presentationStartTime-h.start,c=a.adaptation.period.duration,i=g>=c)):i=!0,Q.when(i)},o=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=j(d,c),d.availabilityIdx=c,d},p=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,t=r.SegmentTimeline,v=b.availableSegmentsNumber>0,w=10,x=[],y=0,z=-1,A=function(a){return u.call(q,b,y,a.d,p,r.media,a.mediaRange,z)};for(p=b.timescale,c=t.S_asArray,k=s.call(q,b),k?(n=k.start,o=k.end):m=q.timelineConverter.calcMediaTimeFromPresentationTime(a||0,b),e=0,f=c.length;f>e;e+=1)if(d=c[e],h=0,d.hasOwnProperty("r")&&(h=d.r),d.hasOwnProperty("t")&&(y=d.t),0>h&&(j=c[e+1],i=j&&j.hasOwnProperty("t")?j.t/p:b.adaptation.period.duration,h=Math.ceil((i-y/p)/(d.d/p))-1),l){if(v)break;z+=h+1}else for(g=0;h>=g;g+=1){if(z+=1,k){if(z>o){if(l=!0,v)break;continue}z>=n&&x.push(A.call(q,d))}else{if(x.length>w){if(l=!0,v)break;continue}y/p>=m-d.d/p&&x.push(A.call(q,d))}y+=d.d}if(!v){var B,C,D=c[0];B=void 0===D.t?0:q.timelineConverter.calcPresentationTimeFromMediaTime(D.t/p,b),C=q.timelineConverter.calcPresentationTimeFromMediaTime((y-d.d)/p,b),b.segmentAvailabilityRange={start:B,end:C},b.availableSegmentsNumber=z+1}return Q.when(x)},q=function(a){var c,d,e,f,h=[],i=this,j=Q.defer(),k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,l=a.segmentDuration,m=null,n=Math.floor(a.adaptation.period.start/l),p=null,q=null;return f=a.startNumber,t.call(i,a).then(function(s){for(a.segmentAvailabilityRange=s,m=r.call(i,a),d=m.start,e=m.end,c=d;e>=c;c+=1)p=o.call(i,a,c-(b?n:0)),p.replacementTime=(f+c-1)*a.segmentDuration,q=k.media,q=g(q,"Number",p.replacementNumber),q=g(q,"Time",p.replacementTime),p.media=q,h.push(p),p=null;a.availableSegmentsNumber=n+Math.ceil((s.end-s.start)/l),j.resolve(h)}),j.promise},r=function(c){var e,f,g,h=this,i=c.adaptation.period.start,j=c.segmentDuration,k=c.adaptation.period.mpd.manifest.minBufferTime,l=c.segmentAvailabilityRange,m=0/0,n=null,o=c.segments,p=2*j,q=Math.max(2*k,10*j);return l||(l=h.timelineConverter.calcSegmentAvailabilityRange(c,b)),b&&!c.adaptation.period.mpd.isClientServerTimeSyncCompleted?(e=Math.floor(l.start/j),f=Math.floor(l.end/j),g={start:e,end:f}):(o?(n=A(d,c),m=n?n.presentationStartTime-i:d>0?d*j:a-i||o[0].presentationStartTime-i):m=d>0?d*j:b?l.end:l.start,e=Math.floor(Math.max(m-p,l.start)/j),f=Math.floor(Math.min(e+q/j,l.end/j)),g={start:e,end:f})},s=function(c){var e,f,g,h=0/0,i=c.segments,j=2,k=10,l=0,m=Number.POSITIVE_INFINITY;if(b&&!c.adaptation.period.mpd.isClientServerTimeSyncCompleted)return g={start:l,end:m};if(!b&&a)return null;if(i){if(0>d)return null;h=d}else h=d>0?d:b?m:l;return e=Math.max(h-j,l),f=Math.min(h+k,m),g={start:e,end:f}},t=function(a){var c,d,e=this,f=Q.defer(),g=function(){c=e.timelineConverter.calcSegmentAvailabilityRange(a,b),c.end>0?f.resolve(c):(d=1e3*Math.abs(c.end),setTimeout(g,d))};return g(),f.promise},u=function(a,c,d,e,f,h,i){var k,l,m,n=this,o=c/e,p=Math.min(d/e,a.adaptation.period.mpd.maxSegmentDuration);return k=n.timelineConverter.calcPresentationTimeFromMediaTime(o,a),k=o,l=k+p,m=new Dash.vo.Segment,m.representation=a,m.duration=p,m.mediaStartTime=o,m.presentationStartTime=k,m.availabilityStartTime=a.adaptation.period.mpd.manifest.mpdLoadedTime,m.availabilityEndTime=n.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(l,a.adaptation.period.mpd,b),m.wallStartTime=n.timelineConverter.calcWallTimeForSegment(m,b),m.replacementTime=c,m.replacementNumber=j(m,i),f=g(f,"Number",m.replacementNumber),f=g(f,"Time",m.replacementTime),m.media=f,m.mediaRange=h,m.availabilityIdx=i,m},v=function(a){var c,d,e,f,g,h=this,i=[],j=Q.defer(),k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=k.SegmentURL_asArray.length,m=0,n=k.SegmentURL_asArray.length;return g=a.startNumber,t.call(h,a).then(function(p){for(b||(f=r.call(h,a),m=f.start,n=f.end),c=m;n>c;c+=1)e=k.SegmentURL_asArray[c],d=o.call(h,a,c),d.replacementTime=(g+c-1)*a.segmentDuration,d.media=e.media,d.mediaRange=e.mediaRange,d.index=e.index,d.indexRange=e.indexRange,e.sequenceNumber&&(d.sequenceNumber=e.sequenceNumber),i.push(d),d=null;a.segmentAvailabilityRange=p,a.availableSegmentsNumber=l,j.resolve(i)}),j.promise},w=function(a){var b,c,d,e,f=this,g=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,h=Q.defer(),i=[],j=0,k=null;return a.indexRange&&(k=a.indexRange),this.baseURLExt.loadSegments(g,k).then(function(g){for(c=0,d=g.length;d>c;c+=1)b=g[c],e=u.call(f,a,b.startTime,b.duration,b.timescale,b.media,b.mediaRange,j),i.push(e),e=null,j+=1;a.segmentAvailabilityRange={start:i[0].presentationStartTime,end:i[d-1].presentationStartTime},a.availableSegmentsNumber=d,h.resolve(i)}),h.promise},x=function(a){var c,d,e=Q.defer(),f=this;return C.call(f,a)?(c="SegmentTimeline"===a.segmentInfoType?p.call(f,a):"SegmentTemplate"===a.segmentInfoType?q.call(f,a):"SegmentList"===a.segmentInfoType?v.call(f,a):w.call(f,a),Q.when(c).then(function(c){if(a.segments=c,d=c.length-1,b&&isNaN(a.adaptation.period.liveEdge)){var g=f.metricsModel.getMetricsFor("stream"),h=c[d].presentationStartTime;a.adaptation.period.liveEdge=h,f.metricsModel.updateManifestUpdateInfo(f.metricsExt.getCurrentManifestUpdate(g),{presentationStartTime:h})}e.resolve(c)}),e.promise):Q.when(a.segments)},y=function(a){var b=this,c=Q.defer();return a.segments=null,x.call(b,a).then(function(b){a.segments=b,c.resolve()}),c.promise},z=function(a,b){var c,d,e,f,g=b.segments,h=g.length-1,i=-1;if(g&&g.length>0)for(f=h;f>=0;f--){if(c=g[f],d=c.presentationStartTime,e=c.duration,a+Dash.dependencies.DashHandler.EPSILON>=d&&a-Dash.dependencies.DashHandler.EPSILON<=d+e){i=c.availabilityIdx;break}if(-1===i&&a-Dash.dependencies.DashHandler.EPSILON>d+e){i=isNaN(b.segmentDuration)?c.availabilityIdx+1:Math.floor((a-b.adaptation.period.start)/b.segmentDuration);break}}return-1===i&&(isNaN(b.segmentDuration)||(i=Math.floor((a-b.adaptation.period.start)/b.segmentDuration))),Q.when(i)},A=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},B=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.sequenceNumber&&c.sequenceNumber===a)return e-1>d?b.segments[d+1]:null;return null},C=function(b){var c,e,f,g=!1,h=b.segments;return h?(e=h[0].availabilityIdx,c=h[h.length-1].availabilityIdx,f=h[h.length-1].presentationStartTime,g=e>d||d>c||a>f):g=!0,g},D=function(a){if(null===a||void 0===a)return Q.when(null);var b,d=new MediaPlayer.vo.SegmentRequest,e=a.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth;return b=k(a.media,e),b=g(b,"Number",a.replacementNumber),b=g(b,"Time",a.replacementTime),b=g(b,"Bandwidth",f),b=i(b,e.id),b=h(b),d.streamType=c,d.type="Media Segment",d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=e.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=e.index,d.index=a.availabilityIdx,a.sequenceNumber&&(d.sequenceNumber=a.sequenceNumber),Q.when(d)},E=function(b,c){var e,f,g,h=this;return b?(a=c,e=Q.defer(),x.call(h,b).then(function(){var a;return a=z.call(h,c,b)}).then(function(a){return d=a,n.call(h,b)}).then(function(a){var c=null;return a?(f=new MediaPlayer.vo.SegmentRequest,f.action=f.ACTION_COMPLETE,f.index=d,e.resolve(f)):(g=A(d,b),c=D.call(h,g)),c}).then(function(a){e.resolve(a)}),e.promise):Q.reject("no represenation")},F=function(b){var c,e,f,g=this;if(!b)return Q.reject("no represenation");if(-1===d)throw"You must call getSegmentRequestForTime first.";return a=null,d+=1,c=Q.defer(),n.call(g,b).then(function(a){a?(e=new MediaPlayer.vo.SegmentRequest,e.action=e.ACTION_COMPLETE,e.index=d,c.resolve(e)):x.call(g,b).then(function(){var a;return f=A(d,b),a=D.call(g,f)}).then(function(a){c.resolve(a)})}),c.promise},G=function(a,b){var c,e,f,g=this;if(!a)return Q.reject("no represenation");if(-1===d)throw"You must call getSegmentRequestForTime first.";return c=Q.defer(),x.call(g,a).then(function(){n.call(g,a).then(function(h){h?(e=new MediaPlayer.vo.SegmentRequest,e.action=e.ACTION_COMPLETE,e.index=d,c.resolve(e)):(f=B(b,a),null===f?c.resolve(null):(d=f.availabilityIdx,D.call(g,f).then(function(a){c.resolve(a)})))})}),c.promise},H=function(a,b,c){var d,e=this,f=Math.max(b-c,0),g=Q.defer(),h=0;return a?(x.call(e,a).then(function(a){d=a[0].duration,h=Math.ceil(f/d),g.resolve(h)},function(){g.resolve(0)}),g.promise):Q.reject("no represenation")},I=function(a){var b,c,e=this,f=Q.defer();return a?(c=d,x.call(e,a).then(function(d){0>c?b=e.timelineConverter.calcPresentationStartTime(a.adaptation.period):(c=c<d[0].availabilityIdx?d[0].availabilityIdx:Math.min(d[d.length-1].availabilityIdx,c),b=A(c,a).presentationStartTime),f.resolve(b)},function(){f.reject()}),f.promise):Q.reject("no represenation")};return{debug:void 0,baseURLExt:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,timelineConverter:void 0,getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},getInitRequest:m,getSegmentRequestForTime:E,getNextSegmentRequest:F,getNextSegmentRequestFromSN:G,getCurrentTime:I,getSegmentCountForDuration:H,updateSegmentList:y}},Dash.dependencies.DashHandler.EPSILON=.003,Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return Q.when(g)},c=function(a,b){for(var d,e,f,g,h,i,j,k,l,m=Q.defer(),n=new DataView(a),o=0,p="",q=0,r=!1,s=this;"moov"!==p&&o<n.byteLength;){for(q=n.getUint32(o),o+=4,p="",i=0;4>i;i+=1)j=n.getInt8(o),p+=String.fromCharCode(j),o+=1;"ftyp"===p&&(d=o-8),"moov"===p&&(e=o-8),"moov"!==p&&(o+=q-8)}return h=n.byteLength-o,"moov"!==p?(b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,k=new XMLHttpRequest,k.onloadend=function(){r||m.reject("Error loading initialization.")},k.onload=function(){r=!0,b.bytesLoaded=b.range.end,c.call(s,k.response).then(function(a){m.resolve(a)})},k.onerror=function(){m.reject("Error loading initialization.")},k.open("GET",s.tokenAuthentication.addTokenAsQueryArg(b.url)),k.responseType="arraybuffer",k.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),k=s.tokenAuthentication.setTokenInRequestHeader(k),k.send(null)):(f=void 0===d?e:d,g=e+q-1,l=f+"-"+g,m.resolve(l)),m.promise},d=function(a){var b=Q.defer(),d=new XMLHttpRequest,e=!0,f=this,g={url:a,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:d};return g.range.start=0,g.range.end=g.bytesToLoad,d.onload=function(){d.status<200||d.status>299||(e=!1,g.bytesLoaded=g.range.end,c.call(f,d.response,g).then(function(a){b.resolve(a)}))},d.onloadend=d.onerror=function(){if(e){e=!1;var a={};a.url=g.url,a.request=d,f.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_INIT,null,a),b.reject(d)}},d.open("GET",f.tokenAuthentication.addTokenAsQueryArg(g.url)),d.responseType="arraybuffer",d.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),d=f.tokenAuthentication.setTokenInRequestHeader(d),d.send(null),b.promise},e=function(a,c){for(var d,f,g,h,i,j,k,l,m=Q.defer(),n=new DataView(a),o=new XMLHttpRequest,p=0,q="",r=0,s=!0,t=!1,u=this;"sidx"!==q&&p<n.byteLength;){for(r=n.getUint32(p),p+=4,q="",i=0;4>i;i+=1)j=n.getInt8(p),q+=String.fromCharCode(j),p+=1;"sidx"!==q&&(p+=r-8)}if(d=n.byteLength-p,"sidx"!==q)m.reject();else if(r-8>d)c.range.start=0,c.range.end=c.bytesLoaded+(r-d),o.onload=function(){o.status<200||o.status>299||(s=!1,c.bytesLoaded=c.range.end,e.call(u,o.response,c).then(function(a){m.resolve(a)}))},o.onloadend=o.onerror=function(){if(s){s=!1;var a={};a.url=c.url,a.request=o,u.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX,null,a),m.reject(o)}},o.open("GET",u.tokenAuthentication.addTokenAsQueryArg(c.url)),o.responseType="arraybuffer",o.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),o=u.tokenAuthentication.setTokenInRequestHeader(o),o.send(null);else if(c.range.start=p-8,c.range.end=c.range.start+r,f=new ArrayBuffer(c.range.end-c.range.start),h=new Uint8Array(f),g=new Uint8Array(a,c.range.start,c.range.end-c.range.start),h.set(g),k=this.parseSIDX.call(this,f,c.range.start),l=k.references,null!==l&&void 0!==l&&l.length>0&&(t=1===l[0].type),t){var v,w,x,y,z,A,B=[];for(v=0,w=l.length;w>v;v+=1)x=l[v].offset,y=l[v].offset+l[v].size-1,z=x+"-"+y,B.push(this.loadSegments.call(u,c.url,z));Q.all(B).then(function(a){for(A=[],v=0,w=a.length;w>v;v+=1)A=A.concat(a[v]);m.resolve(A)},function(a){m.reject(a)})}else b.call(u,f,c.url,c.range.start).then(function(a){m.resolve(a)});return m.promise},f=function(a,c){var d,f=Q.defer(),g=new XMLHttpRequest,h=!0,i=this,j={url:a,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:g};return null===c?(j.searching=!0,j.range.start=0,j.range.end=j.bytesToLoad):(d=c.split("-"),j.range.start=parseFloat(d[0]),j.range.end=parseFloat(d[1])),g.onload=function(){g.status<200||g.status>299||(h=!1,j.searching?(j.bytesLoaded=j.range.end,e.call(i,g.response,j).then(function(a){f.resolve(a)})):b.call(i,g.response,j.url,j.range.start).then(function(a){f.resolve(a)}))},g.onloadend=g.onerror=function(){if(h){h=!1;var a={};a.url=j.url,a.request=g,i.errHandler.sendError(MediaPlayer.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX,null,a),f.reject(g)}},g.open("GET",i.tokenAuthentication.addTokenAsQueryArg(j.url)),g.responseType="arraybuffer",g.setRequestHeader("Range","bytes="+j.range.start+"-"+j.range.end),g=i.tokenAuthentication.setTokenInRequestHeader(g),g.send(null),f.promise};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,loadSegments:f,loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=Q.defer(),i=new DataView(a),j=0;"tfdt"!==e&&j<i.byteLength;){for(d=i.getUint32(j),j+=4,e="",f=0;4>f;f+=1)g=i.getInt8(j),e+=String.fromCharCode(g),j+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(j+=d-8)}if(j===i.byteLength)throw"Error finding live offset.";return c=i.getUint8(j),0===c?(j+=4,b=i.getUint32(j,!1)):(j+=d-16,b=utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1))),h.resolve({version:c,base_media_decode_time:b}),h.promise},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),Q.when({earliestPresentationTime:d,timescale:c})},c=function(b){var c,d,e,f=Q.defer(),g=new XMLHttpRequest,h=!1;return c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.reject(d))},g.onload=function(){h=!0,e=a(g.response),f.resolve(e)},g.onerror=function(){d="Error loading fragment: "+c,f.reject(d)},g.responseType="arraybuffer",g.open("GET",c),g.send(null),f.promise};return{debug:void 0,loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsAudio:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"audio"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("audio"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("audio"),g=!0),b+=1;return f&&(a.type="audio"),Q.when(f)},getIsVideo:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"video"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("video"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("video"),g=!0),b+=1;return f&&(a.type="video"),Q.when(f)},getIsText:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"text"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("vtt")||-1!==a.mimeType.indexOf("ttml"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("vtt")||-1!==d.mimeType.indexOf("ttml"),g=!0),b+=1;return Q.when(f)},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a||"application/ttml+xml+mp4"===a},getIsMain:function(){"use strict";return Q.when(!1)},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getDataForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return Q.when(f[d]);return Q.when(null)},getDataForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return Q.when(d[a])},getDataIndex:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;if(a.id){for(d=0,e=f.length;e>d;d+=1)if(f[d].id&&f[d].id===a.id)return Q.when(d)}else{var g,h=JSON.stringify(a);for(d=0,e=f.length;e>d;d+=1)if(g=JSON.stringify(f[d]),g===h)return Q.when(d)}return Q.when(-1)},getVideoData:function(a,b){"use strict";var c,d,e=a.Period_asArray[b].AdaptationSet_asArray,f=Q.defer(),g=[];for(c=0,d=e.length;d>c;c+=1)g.push(this.getIsVideo(e[c]));return Q.all(g).then(function(a){var b=!1;for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&(b=!0,f.resolve(e[c]));b||f.resolve(null)}),f.promise},getTextDatas:function(a,b){"use strict";var c,d,e=a.Period_asArray[b].AdaptationSet_asArray,f=Q.defer(),g=[];for(c=0,d=e.length;d>c;c+=1)g.push(this.getIsText(e[c]));return Q.all(g).then(function(a){var b=[];for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&b.push(e[c]),f.resolve(b)}),f.promise},getAudioDatas:function(a,b){"use strict";var c,d,e=a.Period_asArray[b].AdaptationSet_asArray,f=Q.defer(),g=[];for(c=0,d=e.length;d>c;c+=1)g.push(this.getIsAudio(e[c]));return Q.all(g).then(function(a){var b=[];for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&b.push(e[c]);f.resolve(b)}),f.promise},getPrimaryAudioData:function(a,b){"use strict";var c,d,e=Q.defer(),f=[],g=this;return this.getAudioDatas(a,b).then(function(a){for(a&&0!==a.length||e.resolve(null),c=0,d=a.length;d>c;c+=1)f.push(g.getIsMain(a[c]));Q.all(f).then(function(b){var f=!1;for(c=0,d=b.length;d>c;c+=1)b[c]===!0&&(f=!0,e.resolve(g.processAdaptation(a[c])));f||e.resolve(a[0])})}),e.promise},getPrimaryTextData:function(a,b){"use strict";var c,d,e=Q.defer(),f=[],g=this;return this.getTextDatas(a,b).then(function(a){for(a&&0!==a.length||e.resolve(null),c=0,d=a.length;d>c;c+=1)f.push(g.getIsMain(a[c]));Q.all(f).then(function(b){var f=!1;for(c=0,d=b.length;d>c;c+=1)b[c]===!0&&(f=!0,e.resolve(g.processAdaptation(a[c])));f||e.resolve(a[0])})}),e.promise},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return Q.when(c)},getCodec_:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return c},getMimeType:function(a){"use strict";return Q.when(a.Representation_asArray[0].mimeType)},getKID:function(a){"use strict";

return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return Q.when(a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null)},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b,Q.when(c)},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),Q.when(b)},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY,Q.when(b)},getBandwidth:function(a){"use strict";return Q.when(a.bandwidth)},getRefreshDelay:function(a){"use strict";var b=0/0,c=2;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=Math.max(parseFloat(a.minimumUpdatePeriod),c)),Q.when(b)},getRepresentationCount:function(a){"use strict";return Q.when(a.Representation_asArray.length)},getRepresentationFor:function(a,b){"use strict";return Q.when(b.Representation_asArray[a])},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g=this,h=g.processAdaptation(a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index]),i=[],j=Q.defer(),k=0;k<h.Representation_asArray.length;k+=1)f=h.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList",c.useCalculatedLiveEdgeTime=!0):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,c.segmentInfoType=e.hasOwnProperty("SegmentTimeline")?"SegmentTimeline":"SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&g.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=g.timelineConverter.calcMSETimeOffset(c),i.push(c);return j.resolve(i),j.promise},getAdaptationsForPeriod:function(a,b){for(var c,d=a.Period_asArray[b.index],e=[],f=0;f<d.AdaptationSet_asArray.length;f+=1)c=new Dash.vo.AdaptationSet,c.index=f,c.period=b,e.push(c);return Q.when(e)},getRegularPeriods:function(a,b){var c,d,e=this,f=Q.defer(),g=[],h=e.getIsDynamic(a),i=null,j=null,k=null,l=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)j=a.Period_asArray[c],j.hasOwnProperty("start")?(l=new Dash.vo.Period,l.start=j.start):null!==i&&j.hasOwnProperty("duration")?(l=new Dash.vo.Period,l.start=k.start+k.duration,l.duration=j.duration):0!==c||h||(l=new Dash.vo.Period,l.start=0),null!==k&&isNaN(k.duration)&&(k.duration=l.start-k.start),null!==l&&j.hasOwnProperty("id")&&(l.id=j.id),null!==l&&j.hasOwnProperty("duration")&&(l.duration=j.duration),null!==l&&(l.index=c,l.mpd=b,g.push(l)),i=j,j=null,k=l,l=null;return 0===g.length?Q.when(g):(e.getCheckTime(a,g[0]).then(function(a){b.checkTime=a,null!==k&&isNaN(k.duration)?e.getEndTimeForLastPeriod(b).then(function(a){k.duration=a-k.start,f.resolve(g)}):f.resolve(g)}),Q.when(f.promise))},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.mpdLoadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),Q.when(b)},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.mpdLoadedTime,b);return Q.when(c)},getCheckTime:function(a,b){var c=this,d=Q.defer(),e=0/0;return a.hasOwnProperty("minimumUpdatePeriod")?c.getFetchTime(a,b).then(function(b){e=b+a.minimumUpdatePeriod,d.resolve(e)}):d.resolve(e),d.promise},getEndTimeForLastPeriod:function(a){var b;if(a.manifest.mediaPresentationDuration)b=a.manifest.mediaPresentationDuration;else{if(isNaN(a.checkTime))return Q.fail(new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period."));b=a.checkTime}return Q.when(b)},getEventsForPeriod:function(a,b){var c=a.Period_asArray,d=c[b.index].EventStream_asArray,e=[];if(d)for(var f=0;f<d.length;f+=1){var g=new Dash.vo.EventStream;if(g.period=b,g.timescale=1,!d[f].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";g.schemeIdUri=d[f].schemeIdUri,d[f].hasOwnProperty("timescale")&&(g.timescale=d[f].timescale),d[f].hasOwnProperty("value")&&(g.value=d[f].value);for(var h=0;h<d[f].Event_asArray.length;h+=1){var i=new Dash.vo.Event;i.presentationTime=0,i.eventStream=g,d[f].Event_asArray[h].hasOwnProperty("presentationTime")&&(i.presentationTime=d[f].Event_asArray[h].presentationTime),d[f].Event_asArray[h].hasOwnProperty("duration")&&(i.duration=d[f].Event_asArray[h].duration),d[f].Event_asArray[h].hasOwnProperty("id")&&(i.id=d[f].Event_asArray[h].id),e.push(i)}}return Q.when(e)},getEventStreamForAdaptationSet:function(a){var b=[],c=a.InbandEventStream_asArray;if(c)for(var d=0;d<c.length;d+=1){var e=new Dash.vo.EventStream;if(e.timescale=1,!c[d].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";e.schemeIdUri=c[d].schemeIdUri,c[d].hasOwnProperty("timescale")&&(e.timescale=c[d].timescale),c[d].hasOwnProperty("value")&&(e.value=c[d].value),b.push(e)}return b},getEventStreamForRepresentation:function(a,b){var c=[],d=a.Representation_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e++){var f=new Dash.vo.EventStream;if(f.timescale=1,f.representation=b,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c},getRepresentationBandwidth:function(a,b){var c=this,d=Q.defer();return c.getRepresentationFor(b,a).then(function(a){c.getBandwidth(a).then(function(a){d.resolve(a)})}),d.promise}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){var c=!1;return"video"===b?(this.manifestExt.getIsVideo(a),"video"===a.type&&(c=!0)):"audio"===b?(this.manifestExt.getIsAudio(a),"audio"===a.type&&(c=!0)):c=!1,c},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>=0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},k=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},l=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},m=function(a){if(null===a)return null;var b,c=a.DVRInfo,d=null;return null===c||c.length<=0?null:(b=c.length-1,d=c[b])},n=function(a){if(null===a)return null;var b,c,d,e=a.ManifestUpdate;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentHttpRequest:j,getHttpRequests:k,getCurrentDroppedFrames:l,getCurrentDVRInfo:m,getCurrentManifestUpdate:n}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.TimelineConverter=function(){"use strict";var a=0,b=function(a,b,c,d){var e=0/0;return e=d?c&&b.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(b.availabilityStartTime.getTime()+1e3*(a+b.timeShiftBufferDepth)):b.availabilityEndTime:c?new Date(b.availabilityStartTime.getTime()+1e3*a):b.availabilityStartTime},c=function(a,c,d){return b.call(this,a,c,d)},d=function(a,c,d){return b.call(this,a,c,d,!0)},e=function(a){var b,c="dynamic"===a.mpd.manifest.type,d=parseInt(this.uriQueryFragModel.getURIFragmentData().s,10);return c?(!isNaN(d)&&d>1262304e3&&(b=d-a.mpd.availabilityStartTime.getTime()/1e3,(b>a.liveEdge||b<a.liveEdge-a.mpd.timeShiftBufferDepth)&&(b=null)),b=b||a.liveEdge):b=!isNaN(d)&&d<a.duration&&d>=0?d:a.start,b},f=function(a,b){return(a.getTime()-b.mpd.availabilityStartTime.getTime())/1e3},g=function(a,b){var c=b.presentationTimeOffset;return a-c},h=function(a,b){var c=b.presentationTimeOffset;return c+a},i=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},j=function(a,b,c){var d,e=this,f=e.calcSegmentAvailabilityRange(a,c);return b>=f.start&&b<=f.end?b:d=Math.max(f.end-2*a.adaptation.period.mpd.manifest.minBufferTime,f.start)},k=function(b,c){var d,e,g=b.segmentDuration,h=0,i=b.adaptation.period.duration,j={start:h,end:i};return c?b.adaptation.period.mpd.isClientServerTimeSyncCompleted&&!isNaN(g)||!b.segmentAvailabilityRange?(d=b.adaptation.period.mpd.checkTime,e=f(new Date((new Date).getTime()+a),b.adaptation.period),h=Math.max(e-b.adaptation.period.mpd.timeShiftBufferDepth,0),d+=a/1e3,i=isNaN(d)?e:Math.min(d,e),j={start:h,end:i}):b.segmentAvailabilityRange:j},l=function(a){var b=a.presentationTimeOffset;return-b};return{system:void 0,debug:void 0,uriQueryFragModel:void 0,setup:function(){},calcAvailabilityStartTimeFromPresentationTime:c,calcAvailabilityEndTimeFromPresentationTime:d,calcPresentationTimeFromWallTime:f,calcPresentationTimeFromMediaTime:g,calcPresentationStartTime:e,calcActualPresentationTime:j,calcMediaTimeFromPresentationTime:h,calcSegmentAvailabilityRange:k,calcWallTimeForSegment:i,calcMSETimeOffset:l}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Mss=function(){"use strict";return{dependencies:{}}}(),Mss.dependencies.MssParser=function(){"use strict";var a=1e7,b=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,c=/^0[xX][A-Fa-f0-9]+$/,d={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},e=[{type:"numeric",test:function(a){return b.test(a)},converter:function(a){return parseFloat(a)}},{type:"hexadecimal",test:function(a){return c.test(a)},converter:function(a){return a.substr(2)}}],f={video:"video/mp4",audio:"audio/mp4",text:"application/ttml+xml+mp4"},g=function(b){var c,d={},e=[];for(d.duration=0===b.Duration?1/0:parseFloat(b.Duration)/a,d.BaseURL=b.BaseURL,c=0;c<b.StreamIndex_asArray.length;c++)b.StreamIndex_asArray[c].BaseURL=d.BaseURL,e.push(h(b.StreamIndex_asArray[c]));return d.AdaptationSet=e.length>1?e:e[0],d.AdaptationSet_asArray=e,d},h=function(a){var b,c,d={},e=[],g={};for(d.id=a.Name,d.lang=a.Language,d.contentType=a.Type,d.mimeType=f[a.Type],d.maxWidth=a.MaxWidth,d.maxHeight=a.MaxHeight,d.BaseURL=a.BaseURL,g=l(a),c=0;c<a.QualityLevel_asArray.length;c++)a.QualityLevel_asArray[c].BaseURL=d.BaseURL,a.QualityLevel_asArray[c].mimeType=d.mimeType,a.QualityLevel_asArray[c].Id=d.id+"_"+a.QualityLevel_asArray[c].Index,b=i(a.QualityLevel_asArray[c]),b.SegmentTemplate=g,e.push(b);return d.Representation=e.length>1?e:e[0],d.Representation_asArray=e,d.SegmentTemplate=g,d},i=function(a){var b={};return b.id=a.Id,b.bandwidth=a.Bitrate,b.mimeType=a.mimeType,b.width=a.MaxWidth,b.height=a.MaxHeight,"H264"===a.FourCC||"AVC1"===a.FourCC?b.codecs=j(a):a.FourCC.indexOf("AAC")>=0&&(b.codecs=k(a)),b.audioSamplingRate=a.SamplingRate,b.audioChannels=a.Channels,b.codecPrivateData=""+a.CodecPrivateData,b.BaseURL=a.BaseURL,b},j=function(a){var b,c,d=a.CodecPrivateData.toString();return b=/00000001[0-9]7/.exec(d),c=b&&b[0]?d.substr(d.indexOf(b[0])+10,6):void 0,"avc1."+c},k=function(a){var b,c,e=0,f=a.CodecPrivateData.toString();if("AACH"===a.FourCC&&(e=5),void 0===f||""===f){e=2;var g=d[a.SamplingRate];if("AACH"===a.FourCC){e=5,f=new Uint8Array(4);var h=d[2*a.SamplingRate];f[0]=e<<3|g>>1,f[1]=g<<7|a.Channels<<3|h>>1,f[2]=h<<7|8,f[3]=0,c=new Uint16Array(2),c[0]=(f[0]<<8)+f[1],c[1]=(f[2]<<8)+f[3],b=c[0].toString(16),b=c[0].toString(16)+c[1].toString(16)}else f=new Uint8Array(2),f[0]=e<<3|g>>1,f[1]=g<<7|a.Channels<<3,c=new Uint16Array(1),c[0]=(f[0]<<8)+f[1],b=c[0].toString(16);f=""+b,f=f.toUpperCase(),a.CodecPrivateData=f}else 0===e&&(e=(248&parseInt(f.substr(0,2),16))>>3);return"mp4a.40."+e},l=function(b){var c,d={};return c=b.Url.replace("{bitrate}","$Bandwidth$"),c=c.replace("{start time}","$Time$"),d.media=c,d.timescale=a,d.SegmentTimeline=m(b),d},m=function(a){var b={},c=a.c_asArray,d=[],e=0;if(c&&c.length>1){for(c[0].t=c[0].t||0,e=1;e<c.length;e++)c[e-1].d=c[e-1].d||c[e].t-c[e-1].t,c[e].t=c[e].t||c[e-1].t+c[e-1].d;for(d.push({d:c[0].d,r:0,t:c[0].t}),e=1;e<c.length;e++)c[e].d===c[e-1].d?++d[d.length-1].r:d.push({d:c[e].d,r:0,t:c[e].t})}return b.S=d,b.S_asArray=d,b},n=function(a){var b,c,d,e;return b=BASE64.decodeArray(a.__text),c=o(b),c=new Uint16Array(c.buffer),c=String.fromCharCode.apply(null,c),d=(new DOMParser).parseFromString(c,"application/xml"),e=d.querySelector("KID").textContent,e=BASE64.decodeArray(e),p(e),e},o=function(a){var b,c,d,e,f,g=0;for(b=(a[g+3]<<24)+(a[g+2]<<16)+(a[g+1]<<8)+a[g],g+=4,c=(a[g+1]<<8)+a[g],g+=2;g<a.length;)if(d=(a[g+1]<<8)+a[g],g+=2,1===d)return e=(a[g+1]<<8)+a[g],g+=2,f=new Uint8Array(e),f.set(a.subarray(g,g+e)),f;return null},p=function(a){q(a,0,3),q(a,1,2),q(a,4,5),q(a,6,7)},q=function(a,b,c){var d=a[b];a[b]=a[c],a[c]=d},r=function(a){{var b,c={},d=this.system.getObject("ksPlayReady");a.SystemID}return b={__text:a.__text,__prefix:"mspr"},c.schemeIdUri=d.schemeIdURI,c.value=2,c.pro=b,c.pro_asArray=b,c},s=function(){var a={},b=this.system.getObject("ksWidevine");return a.schemeIdUri=b.schemeIdURI,a.value=b.systemString,a},t=function(b,c){var d,e,f,h,i,j={},k=[];for(j.profiles="urn:mpeg:dash:profile:isoff-live:2011",j.type=b.IsLive?"dynamic":"static",j.timeShiftBufferDepth=parseFloat(b.DVRWindowLength)/a,j.mediaPresentationDuration=0===b.Duration?1/0:parseFloat(b.Duration)/a,j.BaseURL=b.BaseURL,j.minBufferTime=MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,"dynamic"===j.type&&(j.availabilityStartTime=new Date(c.getTime()-1e3*j.timeShiftBufferDepth)),j.Period=g(b),j.Period_asArray=[j.Period],d=j.Period,d.start=0,void 0!==b.Protection&&(h=n(b.Protection.ProtectionHeader),f=r.call(this,b.Protection.ProtectionHeader),f["cenc:default_KID"]=h,k.push(f),navigator.userAgent.indexOf("Chrome")>=0&&(f=s.call(this,b.Protection.ProtectionHeader),f["cenc:default_KID"]=h,k.push(f)),j.ContentProtection=k.length>1?k:k[0],j.ContentProtection_asArray=k),e=d.AdaptationSet_asArray,i=0;i<e.length;i+=1){if("static"===j.type){var l=e[i].SegmentTemplate.SegmentTimeline.S_asArray[0],m=parseFloat(l.t)/a;d.start=0===d.start?m:Math.max(d.start,m)}void 0!==j.ContentProtection&&(e[i].ContentProtection=j.ContentProtection,e[i].ContentProtection_asArray=j.ContentProtection_asArray)}return delete j.ContentProtection,delete j.ContentProtection_asArray,j},u=function(a,b){var c=null,d=new X2JS(e,"",!0),f=new Date,g=null,h=null;return c=d.xml_str2json(a),g=new Date,null===c?Q.reject("[MssParser] Failed to parse manifest!!"):(c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray&&c.BaseURL_asArray[0]||c.BaseURL,0!==c.BaseURL.indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,c=t.call(this,c,f),h=new Date,Q.when(c))};return{debug:void 0,system:void 0,errHandler:void 0,parse:u}},Mss.dependencies.MssParser.prototype={constructor:Mss.dependencies.MssParser},Mss.dependencies.MssHandler=function(){var a=!1,b=function(a,b){var c=1;return a.audioChannels?c=a.audioChannels:b.audioChannels&&(c=b.audioChannels),c},c=function(a,b){var c=1;return c=a.audioSamplingRate?a.audioSamplingRate:b.audioSamplingRate},d=function(a){if(a){if(!a.initData){var d=e.manifestModel.getValue(),f=a.adaptation,g=d.Period_asArray[f.period.index].AdaptationSet_asArray[f.index],h=g.Representation_asArray[a.index],i=new MediaPlayer.vo.Mp4Track;i.type=e.getType()||"und",i.trackId=f.index+1,i.timescale=a.timescale,i.duration=a.adaptation.period.duration,i.codecs=h.codecs,i.codecPrivateData=h.codecPrivateData,i.bandwidth=h.bandwidth,g.ContentProtection_asArray&&g.ContentProtection_asArray.length>0&&(i.contentProtection=g.ContentProtection_asArray),i.width=h.width||g.maxWidth,i.height=h.height||g.maxHeight,i.language=g.lang?g.lang:"und",i.channels=b(g,h),i.samplingRate=c(g,h),a.initData=e.mp4Processor.generateInitSegment([i])}return a.initData}return null},e=MediaPlayer.utils.copyMethods(Dash.dependencies.DashHandler);return e.mp4Processor=void 0,e.getInitRequest=function(b){var c=null,f=this,g=null,h=Q.defer();c=b.adaptation.period,g=c.start;var i=e.manifestModel.getValue();a=e.manifestExt.getIsDynamic(i);var j=new MediaPlayer.vo.SegmentRequest;j.streamType=e.getType(),j.type="Initialization Segment",j.url=null;try{j.data=d(b)}catch(k){return h.reject(k),h.promise}return j.range=b.range,j.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(g,b.adaptation.period.mpd,a),j.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g+c.duration,c.mpd,a),j.quality=b.index,h.resolve(j),h.promise},e},Mss.dependencies.MssHandler.prototype={constructor:Mss.dependencies.MssHandler},Mss.dependencies.MssFragmentController=function(){"use strict";var a=function(a,b){var c,d,e=b.Period_asArray;for(c=0;c<e.length;c+=1){var f=e[c].AdaptationSet_asArray;for(d=0;d<f.length;d+=1)if(f[d]===a)return d}return-1},b=function(a,b){for(var c=d.manifestModel.getValue(),e=!1,f=b.SegmentTemplate.SegmentTimeline.S,g=a.entry,h=0,i=0,j=null,k=0,l=0,m=0,n=null;m<g.length;)h=g[m].fragment_absolute_time,i=g[m].fragment_duration,j=f[f.length-1],k=void 0===j.r?0:j.r,l=j.t+j.d*k,h>l&&(i===j.d?j.r=k+1:f.push({t:h,d:i}),e=!0),m+=1;if(e)for(j=f[f.length-1],k=void 0===j.r?0:j.r,l=j.t+j.d*k,n=l-1e7*c.timeShiftBufferDepth,j=f[0];j.t<n;)void 0!==j.r&&j.r>0?(j.t+=j.d,j.r-=1):f.splice(0,1),j=f[0]},c=function(c,e,f){var g=0,h=d.manifestModel.getValue(),i=a(f,h)+1,j=mp4lib.deserialize(c);if(!j)return null;var k,l=j.getBoxByType("moof"),m=j.getBoxByType("mdat"),n=l.getBoxByType("traf"),o=n.getBoxByType("trun"),p=n.getBoxByType("tfhd"),q=n.getBoxByType("sepiff");if(null!==q){q.boxtype="senc",q.extended_type=void 0,k=new mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox,k.version=0,k.flags=0,k.entry_count=1,k.offset=[];var r=new mp4lib.boxes.SampleAuxiliaryInformationSizesBox;r.version=0,r.flags=0,r.sample_count=q.sample_count,r.default_sample_info_size=0,r.sample_info_size=[];var s=!1;if(2&q.flags){for(g=0;g<q.sample_count;g++)r.sample_info_size[g]=8+6*q.entry[g].NumberOfEntries+2,g>0&&r.sample_info_size[g]!=r.sample_info_size[g-1]&&(s=!0);s===!1&&(r.default_sample_info_size=r.sample_info_size[0],r.sample_info_size=[])}else r.default_sample_info_size=8;n.boxes.push(r),n.boxes.push(k)}p.track_ID=i,n.removeBoxByType("tfxd");var t=n.getBoxByType("tfdt");if(null===t){t=new mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox,t.version=1,t.flags=0,t.baseMediaDecodeTime=Math.floor(e.startTime*e.timescale);var u=n.getBoxIndexByType("tfhd");n.boxes.splice(u+1,0,t)}var v=n.getBoxesByType("tfrf");if(0!==v.length)for(g=0;g<v.length;g++)b(v[g],f),n.removeBoxByType("tfrf");p.flags&=16777214,p.flags|=131072,o.flags|=1,o.data_offset=0;var w=j.getLength();if(o.data_offset=w-m.size+8,null!==q){var x=j.getBoxOffsetByType("moof"),y=l.getBoxOffsetByType("traf"),z=n.getBoxOffsetByType("senc");k.offset[0]=x+y+z+16}if(navigator.userAgent.indexOf("Chrome")>=0&&"dynamic"===h.type)for(t.baseMediaDecodeTime/=1e3,g=0;g<o.samples_table.length;g++)o.samples_table[g].sample_composition_time_offset>0&&(o.samples_table[g].sample_composition_time_offset/=1e3),o.samples_table[g].sample_duration>0&&(o.samples_table[g].sample_duration/=1e3);var A=mp4lib.serialize(j);return A},d=MediaPlayer.utils.copyMethods(MediaPlayer.dependencies.FragmentController);return d.manifestModel=void 0,d.mp4Processor=void 0,d.process=function(a,b,d){var e=null,f=this.manifestModel.getValue();if(!(null!==a&&void 0!==a&&a.byteLength>0))return Q.when(null);if(e=new Uint8Array(a),b&&"Media Segment"===b.type&&d&&d.length>0){var g=f.Period_asArray[d[0].adaptation.period.index].AdaptationSet_asArray[d[0].adaptation.index];if(e=c(e,b,g),!e)return Q.when(null)}if(void 0===b&&navigator.userAgent.indexOf("Chrome")>=0&&"dynamic"===f.type){var h=mp4lib.deserialize(e),i=h.getBoxByType("moov"),j=i.getBoxByType("mvhd"),k=i.getBoxByType("trak"),l=k.getBoxByType("mdia"),m=l.getBoxByType("mdhd");j.timescale/=1e3,m.timescale/=1e3,e=mp4lib.serialize(h)}return Q.when(e)},d},Mss.dependencies.MssFragmentController.prototype={constructor:Mss.dependencies.MssFragmentController},Hls=function(){"use strict";return{dependencies:{}}}(),Hls.dependencies.HlsDemux=function(){"use strict";var a=function(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);return c.set(a,0),c.set(b,a.byteLength),c},b=null,c=null,d=[],e=[],f=-1,g=-1,h=function(a,b,c,d){for(var e=b;e<a.length;){var f=new mpegts.ts.TsPacket;if(f.parse(a.subarray(e,e+mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE)),f.getPid()===c&&(void 0===d||f.getPusi()===d))return{offset:e,packet:f};e+=mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE}return null},i=function(a){var c=h.call(this,a,0,mpegts.ts.TsPacket.prototype.PAT_PID);return null===c?null:(b=new mpegts.si.PAT,b.parse(c.packet.getPayload()),b)},j=function(a,b){var f=h.call(this,a,0,b);if(null===f)return null;c=new mpegts.si.PMT,c.parse(f.packet.getPayload());for(var g=1,i=0;i<c.m_listOfComponents.length;i++){var j=c.m_listOfComponents[i],k=new MediaPlayer.vo.Mp4Track,l=c.gStreamTypes[j.m_stream_type];if(null!==l)switch(k.streamType=l.name,l.value){case 224:k.type="video";break;case 192:k.type="audio";break;case 252:k.type="data";break;default:k.type="und"}k.timescale=mpegts.Pts.prototype.SYSTEM_CLOCK_FREQUENCY,k.pid=j.m_elementary_PID,k.trackId=g,d[j.m_elementary_PID]=g,e.push(k),g++}return c},k=function(a){var b,c,h,i,j=null,k=null;if(b=new mpegts.ts.TsPacket,b.parse(a),!b.hasAdaptationFieldOnly()&&(c=b.getPid(),h=d[c],void 0!==h))if(i=e[h-1],b.getPusi()){var l=new mpegts.pes.PesPacket;l.parse(b.getPayload()),j=new MediaPlayer.vo.Mp4Track.Sample,j.cts=l.getPts().getValue(),j.dts=null!==l.getDts()?l.getDts().getValue():j.cts,j.size=0,j.duration=0,j.subSamples=[],-1===f&&(f=j.dts),j.dts-=f,j.cts-=f,j.dts+=g,j.cts+=g,k=l.getPayload(),j.subSamples.push(k),i.samples.push(j)}else i.samples.length>0&&(j=i.samples[i.samples.length-1]),j.subSamples.push(b.getPayload())},l=function(a){var b,c,d,e,f=0,g=0;for(d=0;d<a.samples.length;d++){for(c=0,b=a.samples[d],e=0;e<b.subSamples.length;e++)c+=b.subSamples[e].length;d>0&&(a.samples[d-1].duration=a.samples[d].dts-a.samples[d-1].dts),b.size=c,f+=c}for(a.samples[a.samples.length-1].duration=a.samples[a.samples.length-2].duration,a.data=new Uint8Array(f),d=0;d<a.samples.length;d++)for(b=a.samples[d],e=0;e<b.subSamples.length;e++)a.data.set(b.subSamples[e],g),g+=b.subSamples[e].length;-1!==a.streamType.search("H.264")&&mpegts.h264.bytestreamToMp4(a.data),-1!==a.streamType.search("ADTS")&&m(a)},m=function(a){var b,c,d,e,f,g,h,i,j=[];for(b=mpegts.aac.parseADTS(a.data),c=0,i=0;i<b.length;i++)c+=b[i].length;for(e=new Uint8Array(c),g=a.samples[0].cts,h=1024*a.timescale/a.samplingRate,d=0,i=0;i<b.length;i++)f=new MediaPlayer.vo.Mp4Track.Sample,f.cts=f.dts=g,f.size=b[i].length,f.duration=h,j.push(f),e.set(a.data.subarray(b[i].offset,b[i].offset+b[i].length),d),d+=b[i].length;a.data=e,a.samples=j},n=function(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);d.length<2&&(d="0"+d),b+=d}return b},o=function(a){b=null,c=null,e=[],-1===g&&(g=a)},p=function(b,c){var d,e,f;if(""!==c.codecs)return c;if(d=h.call(this,b,0,c.pid,!0),null===d)return null;if(e=new mpegts.pes.PesPacket,e.parse(d.packet.getPayload()),f=e.getPayload(),-1!==c.streamType.search("H.264")){for(var g=mpegts.h264.getSequenceHeader(f);null===g;)d=h.call(this,b,d.offset+mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE,c.pid,!1),f=a(f,d.packet.getPayload()),g=mpegts.h264.getSequenceHeader(f);c.codecPrivateData=n(g.bytes),c.codecs="avc1.";var i=/00000001[0-9]7/.exec(c.codecPrivateData);i&&i[0]&&(c.codecs+=c.codecPrivateData.substr(c.codecPrivateData.indexOf(i[0])+10,6)),c.width=g.width,c.height=g.height}if(-1!==c.streamType.search("AAC")){var j=mpegts.aac.getAudioSpecificConfig(f),k=(248&j[0])>>3;c.codecPrivateData=n(j),c.codecs="mp4a.40."+k;var l=(7&j[0])<<1|(128&j[1])>>7;c.samplingRate=mpegts.aac.SAMPLING_FREQUENCY[l],c.channels=(120&j[1])>>3,c.bandwidth=0}return c},q=function(a){if(!(null===b&&(b=i.call(this,a),null===b)||null===c&&(c=j.call(this,a,b.getPmtPid()),null===c))){for(var d=e.length-1;d>=0;d--)p.call(this,a,e[d]),""===e[d].codecs&&e.splice(d,1);return e}},r=function(a){var b=(a.length/mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE,0);if(null===q.call(this,a))return null;if(null===c)return e;for(b=0;b<e.length;b++)e[b].samples=[],e[b].data=null;for(b=0;b<a.length;)k.call(this,a.subarray(b,b+mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE)),b+=mpegts.ts.TsPacket.prototype.TS_PACKET_SIZE;for(b=0;b<e.length;b++)l.call(this,e[b]);return e};return{debug:void 0,reset:o,getTracks:q,demux:r}},Hls.dependencies.HlsDemux.prototype={constructor:Hls.dependencies.HlsDemux},Hls.dependencies.HlsParser=function(){var a="#EXTM3U",b="#EXTINF",c="#EXT-X-VERSION",d="#EXT-X-TARGETDURATION",e="#EXT-X-MEDIA-SEQUENCE",f="#EXT-X-STREAM-INF",g="#EXT-X-ENDLIST",h="BANDWIDTH",i="PROGRAM-ID",j="AUDIO",k="SUBTITLES",l="RESOLUTION",m="CODECS",n=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)(""===a[b]||" "===a[b])&&(a.splice(b,1),b--);return a},o=function(a,b){return a.indexOf(b)>-1},p=function(a,b){return a.substring(b.length+1,a.length)},q=function(a){return a.substring(a.indexOf(":")+1).split(",")},r=function(a){return 0===a.indexOf("http://")||0===a.indexOf("https://")},s=function(a){var b,c={programId:"",bandwidth:0,resolution:"0x0",codecs:""},d="",e="",f=q(a[0]);for(b=f.length-1;b>=0;b--)if(-1===f[b].indexOf("=")&&b>0)f[b-1]+=","+f[b];else switch(d=f[b].trim().split("=")[0],e=f[b].trim().split("=")[1],d){case i:c.programId=e;break;case h:c.bandwidth=parseInt(e,10);break;case l:c.resolution=e;break;case m:c.codecs=e.replace(/"/g,"");break;case j:c.audioId=e;break;case k:c.subtitlesId=e}return c.uri=a[1],c},t=function(a){var b={},c=q(a[0]);return b.duration=parseInt(c[0],10),b.title=c[1],b.uri=a[1],b},u=function(a){for(var b=[],c=0;c<a.length;c++)o(a[c],f)&&b.push(s([a[c],a[c+1]]));return b},v=function(f,h,i){var j,k,l,m,q,s,u,v=0,w=0;if(h=n(h),h&&h.length&&h[0].trim()!==a)return void f.resolve();for(j={name:"SegmentList",isRoot:!1,isArray:!1,duration:0,startNumber:0,timescale:1,BaseURL:i.BaseURL,SegmentURL_asArray:[]},i[j.name]=j,k=j.SegmentURL_asArray,i.duration=1/0,u=1;u<h.length;u++)o(h[u],c)?q=p(h[u],c):o(h[u],d)?j.duration=parseInt(p(h[u],d),10):o(h[u],e)?j.startNumber=parseInt(p(h[u],e),10):o(h[u],b)?(s=t([h[u],h[u+1]]),l={name:"SegmentURL",isRoot:!1,isArray:!0,media:r(s.uri)?s.uri:j.BaseURL+s.uri,sequenceNumber:j.startNumber+w,time:0===k.length?0:k[k.length-1].time+k[k.length-1].duration,duration:s.duration},k.push(l),v+=s.duration,w++):o(h[u],g)&&(i.duration=v);m={name:"Initialization",sourceURL:i.SegmentList.SegmentURL_asArray[0].media},i.SegmentList.Initialization=m,f.resolve()},w=function(a,b){var c=Q.defer(),d=a.Period_asArray[0],e=d.AdaptationSet_asArray[0],f=e.Representation_asArray[b],g=new MediaPlayer.vo.SegmentRequest,h=this;d.start=0,e.duration=f.duration,d.duration=f.duration,f.duration!==1/0&&(a.mediaPresentationDuration=f.duration),a.type=f.duration===1/0?"dynamic":"static";var i=f.SegmentList.duration*f.SegmentList.SegmentURL_asArray.length;if("dynamic"===a.type){var j=new Date;a.availabilityStartTime=new Date(j.getTime()-1e3*i),a.timeShiftBufferDepth=i-f.SegmentList.duration}a.minBufferTime=2*f.SegmentList.duration,f=e.Representation_asArray[b],g.type="Initialization Segment",g.url=f.SegmentList.Initialization.sourceURL;var k=function(a,b){var d=this.hlsDemux.getTracks(new Uint8Array(b.data));a.codecs="";for(var e=0;e<d.length;e++)a.codecs+=d[e].codecs,e<d.length-1&&(a.codecs+=",");c.resolve()},l=function(){c.resolve()};return""===f.codecs?h.fragmentLoader.load(g).then(k.bind(h,f),l.bind(h)):c.resolve(),c.promise},x=function(a){var b=null;return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},y=function(b,c){var d,e,f,g,h,i=Q.defer(),j=[],k=[],l=0,m=[],n=this;if(!b||b.length<=0||b[0].trim()!==a)return i.reject(new Error("Can't parse manifest")),i.promise;d={},d.name="M3U",d.isRoot=!0,d.isArray=!0,d.parent=null,d.BaseURL=c,d.profiles="urn:mpeg:dash:profile:isoff-live:2011",d.type="static",e={},e.name="Period",e.isRoot=!1,e.isArray=!1,e.parent=d,e.duration=0,e.BaseURL=d.BaseURL,d.Period=e,d.Period_asArray=[e],j=[],e.AdaptationSet=j,e.AdaptationSet_asArray=j,m=u(b.slice(1)),m.sort(function(a,b){return a.bandwidth-b.bandwidth}),f={name:"AdaptationSet",isRoot:!1,isArray:!0,id:"video",lang:"",contentType:"video",mimeType:"video/mp4",maxWidth:0,maxHeight:0,BaseURL:e.BaseURL,Representation:k,Representation_asArray:k};for(var o=0;o<m.length;o++)h=m[o],h.bandwidth>64e3&&(g={name:"Representation",isRoot:!1,isArray:!0,id:l.toString(),mimeType:"video/mp4",codecs:h.codecs,bandwidth:h.bandwidth,width:parseInt(h.resolution.split("x")[0],10),height:parseInt(h.resolution.split("x")[1],10),url:r(h.uri)?h.uri:f.BaseURL+h.uri},g.BaseURL=x(g.url),k.push(g),l++);return 0===m.length?(i.reject(),i.promise):(j.push(f),n.abrController.getPlaybackQuality("video",f).then(function(a){g=f.Representation_asArray[a.quality],A.call(n,g).then(function(){w.call(n,d,a.quality).then(function(){i.resolve(d)})})}),i.promise)},z=function(a,b){return y.call(this,n(a),b)},A=function(a){return MediaPlayer.utils.doRequestWithPromise.call(this,a.url,v,a)};return{debug:void 0,manifestModel:void 0,fragmentLoader:void 0,abrController:void 0,
hlsDemux:void 0,parse:z,updatePlaylist:A}},Hls.dependencies.HlsParser.prototype={constructor:Hls.dependencies.HlsParser},Hls.dependencies.HlsHandler=function(){var a=function(a){var c=null,d=this,e=null,f=Q.defer();c=a.adaptation.period,e=c.start;var g=b.manifestModel.getValue(),h=b.manifestExt.getIsDynamic(g),i=new MediaPlayer.vo.SegmentRequest;return i.streamType=b.getType(),i.type="Initialization Segment",i.url=null,i.data=1,i.range=a.range,i.availabilityStartTime=d.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,h),i.availabilityEndTime=d.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+c.duration,c.mpd,h),i.quality=a.index,f.resolve(i),f.promise},b=MediaPlayer.utils.copyMethods(Dash.dependencies.DashHandler);return b.getInitRequest=a,b},Hls.dependencies.HlsHandler.prototype={constructor:Hls.dependencies.HlsHandler},Hls.dependencies.HlsFragmentController=function(){"use strict";var a=null,b=function(a){for(var b=d.manifestModel.getValue(),c=d.hlsDemux.getTracks(new Uint8Array(a)),e=0;e<c.length;e++)c[e].duration=b.mediaPresentationDuration;return d.mp4Processor.generateInitSegment(c)},c=function(a){var b=d.hlsDemux.demux(new Uint8Array(a));return d.mp4Processor.generateMediaSegment(b,d.sequenceNumber)},d=MediaPlayer.utils.copyMethods(MediaPlayer.dependencies.FragmentController);return d.manifestModel=void 0,d.hlsDemux=void 0,d.mp4Processor=void 0,d.sequenceNumber=1,d.process=function(e,f,g){var h=null,i=null;if(null===e||void 0===e||0===e.byteLength)return Q.when(e);if(f&&"Media Segment"===f.type&&g&&g.length>0){if((null===a||a!==f.quality)&&(d.hlsDemux.reset(9e4*f.startTime),i=b(e),f.index=void 0,a=f.quality),h=c(e),null!==i){var j=new Uint8Array(i.length+h.length);j.set(i,0),j.set(h,i.length),h=j}d.sequenceNumber++}return Q.when(h)},d},Hls.dependencies.HlsFragmentController.prototype={constructor:Hls.dependencies.HlsFragmentController},MediaPlayer.utils.copyMethods=function(a){var b=new a;b.parent={};for(var c in b)b.parent[c]=b[c];return b.setup=function(){for(var a in this.parent)void 0===this.parent[a]&&(this.parent[a]=this[a])},b},MediaPlayer.utils.ObjectIron=function(a){var b;b=[];for(var c=0,d=a.length;d>c;c+=1)b.push(a[c].isRoot?"root":a[c].name);var e=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},f=function(a,b,c){var d,f,g,h,i;if(null!==a&&0!==a.length)for(d=0,f=a.length;f>d;d+=1)g=a[d],b.hasOwnProperty(g.name)&&(c.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=c[g.name],"object"==typeof h&&"object"==typeof i?e(h,i):c[g.name]=null!==g.mergeFunction?g.mergeFunction(h,i):h+i):c[g.name]=b[g.name])},g=function(a,b){var c,d,e,h,i,j,k,l=a;if(a.transformFunc&&(b=a.transformFunc(b)),null===l.children||0===l.children.length)return b;for(c=0,d=l.children.length;d>c;c+=1){j=l.children[c];var m=null;if(b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],e=0,h=i.length;h>e;e+=1)k=i[e],f(l.properties,b,k),m=g(j,k),b[j.name+"_asArray"][e]=m,b[j.name][e]=m;else k=b[j.name],f(l.properties,b,k),m=g(j,k),b[j.name]=m,b[j.name+"_asArray"]=[m]}return b},h=function(c){var d,e,f,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,e=b.length;e>d;d+=1)"root"===b[d]&&(j=a[d],k=c,c=g(j,k));for(i in c)if(c.hasOwnProperty(i)){if(f=b.indexOf(i),-1!==f)if(j=a[f],j.isArray)for(l=c[i+"_asArray"],d=0,e=l.length;e>d;d+=1)k=l[d],c[i][d]=g(j,k),c[i+"_asArray"][d]=g(j,k);else k=c[i],c[i]=g(j,k),c[i+"_asArray"]=[g(j,k)];c[i]=h(c[i])}return c};return{run:h}},MediaPlayer.utils.getXMLHttpRequest=function(){var a=null;if(!window.XMLHttpRequest&&!window.ActiveXObject)return alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest..."),null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a},MediaPlayer.utils.doRequestWithPromise=function(a,b,c){var d=Q.defer(),e=MediaPlayer.utils.getXMLHttpRequest(),f=this;return e.onreadystatechange=function(){4!==e.readyState||200!==e.status&&0!==e.status||b.call(f,d,e.response,c)},e.open("GET",a,!0),e.send(null),d.promise};var _paq=_paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="//tv-has.orange-labs.fr/piwik/";_paq.push(["setTrackerUrl",a+"piwik.php"]),_paq.push(["setSiteId",1]);var b=document,c=b.createElement("script"),d=b.getElementsByTagName("script")[0];c.type="text/javascript",c.async=!0,c.defer=!0,c.src=a+"piwik.js",d.parentNode.insertBefore(c,d)}();